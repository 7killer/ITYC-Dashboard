{"version":3,"file":"app.js","sources":["../../src/dashboard/app/memoData.js","../../src/dashboard/ui/header.js","../../src/dashboard/ui/raceStatus.js","../../src/dashboard/ui/raceLog.js","../../src/dashboard/app/sortManager.js","../../src/dashboard/ui/raceFleet.js","../../src/dashboard/ui/raceBook.js","../../src/dashboard/ui/map/map-core.js","../../src/dashboard/ui/map/map-shortcuts.js","../../src/dashboard/ui/map/map-utils.js","../../src/dashboard/ui/map/map-proj.js","../../src/dashboard/ui/map/map-race.js","../../src/dashboard/app/tab.js","../../src/dashboard/app/clickManager.js","../../src/dashboard/app/binding.js","../../src/dashboard/main.js"],"sourcesContent":["\r\nimport {getData,getAllData,getLatestEntriesPerUser,getEntriesForTriplet,getLegPlayersOptionsByRaceLeg,getLegPlayersTracksByType} from '../../common/dbOpes.js';\r\n\r\nlet connectedPlayerId;\r\nlet connectedPlayerInfos = [];\r\nlet openedRaceId ={raceId : null, legNum : null, polarId :null};\r\nlet openedRaceIdHistory = [];\r\nlet raceInfo = [];\r\nlet legListUpdate = 0;\r\nlet raceList = [];\r\nlet playersUpdate = 0;\r\nlet playersList = [];\r\nlet teamsUpdate = 0;\r\nlet teamList = [];\r\nlet polarsUpdate = 0;\r\nlet polar = [];\r\nlet legFleetInfosUpdate = 0;\r\nlet legFleetInfos = [];\r\nlet legPlayersInfosUpdate = 0;\r\nlet legPlayerInfos = [];\r\nlet legPlayerInfosHistory = [];\r\nlet legPlayersOptionsUpdate = 0;\r\nlet legPlayersOptions = [];\r\nlet paramStamina = [];\r\nlet legPlayersOrderUpdate = 0;\r\nlet legPlayersOrder = [];\r\nlet legSelectedPlayers = [];\r\nlet legPlayersTracksUpdate = 0;\r\nlet legPlayersTracks = [];\r\n\r\n\r\nexport async function initMemo()\r\n{\r\n    const currentId = await getData('internal', 'lastLoggedUser');\r\n    const currentRace = await getData('internal', 'lastOpennedRace');\r\n\r\n    if(currentId) connectedPlayerId = currentId.loggedUser; else connectedPlayerId = null; \r\n\r\n    await updatePlayersList();\r\n    await updateTeamsList();\r\n    await updateConnectedPlayerInfos();\r\n\r\n    if(currentRace && currentRace.raceId && currentRace.legNum)\r\n    {\r\n        openedRaceId.raceId = currentRace.raceId;\r\n        openedRaceId.legNum = currentRace.legNum;\r\n        await updateOpenedRaceId()\r\n        await updatePolar();\r\n        await updateLegFleetInfos();\r\n        await updateLegPlayerInfos();\r\n        await updateLegPlayersOrder();\r\n        await updateLegPlayersOptions();\r\n    } else\r\n    {\r\n        raceList = [];\r\n        raceInfo = [];\r\n        polar = [];\r\n        legFleetInfos = [];\r\n        legPlayerInfos = [];\r\n        legPlayerInfosHistory = [];\r\n        legPlayersOptions = [];\r\n    }\r\n    openedRaceIdHistory = [];\r\n    legPlayerInfosHistory = [];\r\n    legSelectedPlayers = [];\r\n    \r\n    paramStamina = [];\r\n    await updateParamStamina();\r\n    legListUpdate = await getData('internal', 'legListUpdate');\r\n    playersUpdate = await getData('internal', 'playersUpdate');\r\n    teamsUpdate = await getData('internal', 'teamsUpdate');\r\n    polarsUpdate = await getData('internal', 'polarsUpdate');\r\n    legFleetInfosUpdate = await getData('internal', 'legFleetInfosDashUpdate');\r\n    legPlayersInfosUpdate = await getData('internal', 'legPlayersInfosDashUpdate');\r\n    legPlayersOptionsUpdate = await getData('internal', 'legPlayersOptionsUpdate');\r\n}\r\n\r\nasync function updateParamStamina() {\r\n    const setting = await getData(\"internal\",\"paramStamina\")    .catch(error => {\r\n        console.error(\"getParamstamina error :\", error);\r\n    }); \r\n    if(setting?.paramStamina)\r\n        paramStamina = setting.paramStamina;     \r\n}\r\nexport function getRaceInfo(){\r\n    return raceInfo;\r\n}\r\nexport function getParamStamina(){\r\n    return paramStamina;\r\n}\r\n\r\nexport function setLegSelectedPlayers(uid,selected)\r\n{\r\n    legSelectedPlayers[uid] = selected;\r\n}\r\n\r\nexport function getLegSelectedPlayersState(uid)\r\n{\r\n    if(legSelectedPlayers[uid]) return true;\r\n    else return false;\r\n}\r\n\r\n\r\nexport function getOpenedRaceHistory() \r\n{\r\n    return openedRaceIdHistory;\r\n}\r\nexport function getLegPlayerInfosHistory() \r\n{\r\n    return legPlayerInfosHistory;\r\n}\r\n\r\nexport function getLegListUpdate()\r\n{\r\n    return legListUpdate;\r\n}\r\nexport function setLegListUpdate(ts)\r\n{\r\n    legListUpdate = ts;\r\n}\r\n\r\nexport function getLegList()\r\n{\r\n    return raceList; \r\n}\r\nexport async function updateLegList() {\r\n  try {\r\n    const oneWeekAgo = new Date();\r\n    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\r\n\r\n    const legList = await getAllData('legList');\r\n\r\n    if (!Array.isArray(legList) || legList.length === 0) {\r\n      /*if (cfg.debugDB)*/ console.warn('[updateLegList] legList vide ou non-tableau:', legList);\r\n      raceList = {};            // objet, pas tableau\r\n      raceInfo = null;\r\n      return { raceList, raceInfo };\r\n    }\r\n\r\n    // Exclure les courses finies depuis > 1 semaine\r\n    const filtered = legList.filter(leg => {\r\n      const endDate = leg?.end?.date ? new Date(leg.end.date) : null;\r\n      const isFinishedOld =\r\n        leg?.status === 'finished' &&\r\n        endDate instanceof Date &&\r\n        !Number.isNaN(endDate.valueOf()) &&\r\n        endDate < oneWeekAgo;\r\n\r\n      return !isFinishedOld && leg?.id !== 'update';\r\n    });\r\n\r\n    // Tri par date de d√©part croissante\r\n    filtered.sort((a, b) => {\r\n      const da = new Date(a?.start?.date || 0);\r\n      const db = new Date(b?.start?.date || 0);\r\n      return da - db;\r\n    });\r\n\r\n    // Construire la map des courses\r\n    const map = Object.create(null);\r\n    let foundRaceInfo = null;\r\n\r\n    for (const leg of filtered) {\r\n      const fullRaceId = `${leg.raceId}-${leg.legNum}`;\r\n      map[fullRaceId] = {\r\n        raceId: leg.raceId,\r\n        legNum: leg.legNum,\r\n        name: leg.legName,\r\n      };\r\n\r\n      if (\r\n        openedRaceId?.raceId != null &&\r\n        openedRaceId?.legNum != null &&\r\n        openedRaceId.raceId === leg.raceId &&\r\n        openedRaceId.legNum === leg.legNum\r\n      ) {\r\n        foundRaceInfo = leg;\r\n      }\r\n    }\r\n\r\n    raceList = map;     // ‚úÖ objet associatif\r\n    raceInfo = foundRaceInfo ?? null;\r\n\r\n    /*if (cfg.debugDB) */console.log('[updateLegList] races:', Object.keys(raceList).length, 'raceInfo:', !!raceInfo);\r\n    return { raceList, raceInfo };\r\n  } catch (error) {\r\n    console.error('[updateLegList] error:', error);\r\n    // √Ä toi de voir si tu veux r√©initialiser ou pr√©server l‚Äôancien √©tat\r\n    raceList = raceList ?? {};\r\n    raceInfo = raceInfo ?? null;\r\n    return { raceList, raceInfo };\r\n  }\r\n}\r\n\r\n/*\r\nexport async function updateLegList()\r\n{\r\n    const oneWeekAgo = new Date();\r\n    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\r\n\r\n    const legList = await getAllData(\"legList\")\r\n    .catch(error => {\r\n        console.error(\"getLegList error :\", error);\r\n    });\r\n    // Filtrage : exclusion des courses termin√©es depuis + d'une semaine\r\n    const filtered = legList.filter(leg => {\r\n    const endDate = leg.end?.date ? new Date(leg.end.date) : null;\r\n    const isFinishedOld =\r\n        leg.status === \"finished\" &&\r\n        endDate &&\r\n        endDate < oneWeekAgo;\r\n        return !isFinishedOld && leg.id !== \"update\";\r\n    });\r\n\r\n    // Tri par date de d√©part croissante\r\n    filtered.sort((a, b) => {\r\n        const da = new Date(a.start?.date || 0);\r\n        const db = new Date(b.start?.date || 0);\r\n        return da - db;\r\n    });\r\n\r\n    raceList = [];\r\n    if (filtered.length !== 0) {\r\n        filtered.forEach(leg => {\r\n            const raceListItem = {raceId : leg.raceId, legNum:leg.legNum,name : leg.legName};\r\n            const fullRaceId = leg.raceId + '-' + leg.legNum;\r\n            raceList[fullRaceId] = raceListItem;\r\n\r\n            if(openedRaceId?.raceId && openedRaceId?.legNum\r\n                && openedRaceId.raceId == leg.raceId && openedRaceId.legNum == leg.legNum \r\n            ) {\r\n                raceInfo = leg;\r\n            }\r\n        });\r\n    }\r\n}\r\n*/\r\nexport function getPlayersUpdate()\r\n{\r\n    return playersUpdate;\r\n}\r\nexport function setPlayersUpdate(ts)\r\n{\r\n    playersUpdate = ts;\r\n}\r\n\r\nexport function getPlayersList()\r\n{\r\n    return playersList;\r\n}\r\n\r\nexport async function updatePlayersList()\r\n{\r\n    const playersDatas = await getAllData(\"players\").catch(error => {\r\n        console.error(\"getplayerList error :\", error);\r\n    }); \r\n    playersList = [];\r\n    if (playersDatas.length !== 0) {\r\n        playersDatas.forEach(player => {\r\n            playersList[player.id] = player;\r\n            if(player.id == connectedPlayerId)\r\n            {\r\n                connectedPlayerInfos = player;\r\n            }\r\n        });\r\n    }         \r\n}\r\n\r\nexport function getTeamsUpdate()\r\n{\r\n    return teamsUpdate;\r\n}\r\nexport function setTeamsUpdate(ts)\r\n{\r\n    teamsUpdate = ts;\r\n}\r\n\r\nexport function getTeamsList()\r\n{\r\n    return teamList;\r\n}\r\n\r\nexport async function updateTeamsList()\r\n{\r\n    const teamsDatas = await getAllData(\"teams\")\r\n    .catch(error => {\r\n        console.error(\"getTeamsList error :\", error);\r\n    });\r\n    teamList = [];\r\n    if (teamsDatas.length !== 0) {\r\n        teamsDatas.forEach(team => {\r\n            teamList[team.id] = team;\r\n        });\r\n    }\r\n   \r\n}\r\n\r\nexport function getPolarsUpdate()\r\n{\r\n    return polarsUpdate;\r\n}\r\nexport function setPolarsUpdate(ts)\r\n{\r\n    polarsUpdate = ts;\r\n}\r\nexport function getPolar()\r\n{\r\n    return polar;\r\n}\r\n\r\nexport async function updatePolar()\r\n{\r\n    if(raceInfo?.polarId)\r\n    {\r\n        const polarData = await getData(\"polars\",raceInfo.polarId)\r\n                        .catch(error => {console.error(\"getPolar error :\", error);});\r\n        polar = [];\r\n        if(polarData)\r\n            polar = polarData;    \r\n    }\r\n}\r\n\r\nexport function getLegFleetInfosUpdate()\r\n{\r\n    return legFleetInfosUpdate;\r\n}\r\nexport function setLegFleetInfosUpdate(ts)\r\n{\r\n    legFleetInfosUpdate = ts;\r\n}\r\nexport function getLegFleetInfos()\r\n{\r\n    return legFleetInfos;\r\n}\r\n\r\nexport async function updateLegFleetInfos()\r\n{\r\n    if(raceInfo?.raceId && raceInfo?.legNum)\r\n    { \r\n        const now = Date.now();\r\n        const fifteenMinutesAgo = now - 15 * 60 * 1000;\r\n        const raceId = raceInfo.raceId;\r\n        const legNum = raceInfo.legNum;\r\n\r\n        const { items, meta } = await getLatestEntriesPerUser(raceId, legNum, {\r\n            since: fifteenMinutesAgo,\r\n            until: now,\r\n            timeout: 4000,\r\n            storeName: 'legFleetInfos'\r\n        });\r\n        if(!items || items?.length == 0) return; \r\n\r\n        legFleetInfos = [];\r\n        for (const item of Object.entries(items)) {\r\n            if(!'userId' in item[1]) continue;\r\n            const userId = item[1].userId;\r\n\r\n            const playerOptionRace = legPlayersOptions[userId]?legPlayersOptions[userId]:{options:[],guessOptions:0};\r\n            const playerInfo = playersList[userId];\r\n            const teamInfo = playerInfo?.teamId?(teamList[playerInfo.teamId]?teamList[playerInfo.teamId]:{id:null,name:\"\"}):{id:null,name:\"\"};\r\n            const itePlayer = {\r\n                ite :item[1],             // ‚Üê ton tableau d‚Äôentr√©es\r\n                info: playerInfo,\r\n                team : teamInfo,\r\n                options: playerOptionRace,\r\n            };\r\n            \r\n            legFleetInfos[userId] = itePlayer; \r\n\r\n            if(item[1].choice) legSelectedPlayers[userId] = true;\r\n        }\r\n    } else\r\n        legFleetInfos = [];\r\n}\r\n\r\n\r\nexport function getLegPlayersInfosUpdate()\r\n{\r\n    return legPlayersInfosUpdate;\r\n}\r\nexport function setLegPlayersInfosUpdate(ts)\r\n{\r\n    legPlayersInfosUpdate = ts;\r\n}\r\nexport function getLegPlayerInfos()\r\n{\r\n    return legPlayerInfos;\r\n}\r\nexport async function updateLegPlayerInfos()\r\n{\r\n    if(raceInfo?.raceId && raceInfo?.legNum && connectedPlayerId)\r\n    { \r\n        const raceId = raceInfo.raceId;\r\n        const legNum = raceInfo.legNum;\r\n        const { items, meta } = await getEntriesForTriplet(    raceId,legNum,connectedPlayerId,{limit:24*10*60,since:Date.now() - 10*24*60 * 60 * 1000, });\r\n        if(meta.timeout || !items || items.length == 0) return;\r\n        const playerInfo = playersList[connectedPlayerId];\r\n        const teamInfo = playerInfo?.teamId?(teamList[playerInfo.teamId]?teamList[playerInfo.teamId]:{id:null,name:\"\"}):{id:null,name:\"\"};\r\n        const playerOptionRace = legPlayersOptions[connectedPlayerId]?legPlayersOptions[connectedPlayerId]:{options:[],guessOptions:0};\r\n        const legPlayerIte = {\r\n            ites : items,             // ‚Üê ton tableau d‚Äôentr√©es\r\n            info: playerInfo,\r\n            team : teamInfo,\r\n            options: playerOptionRace,\r\n        };\r\n        legPlayerInfos = legPlayerIte;\r\n    } else\r\n        legPlayerInfos = [];\r\n}\r\n\r\n\r\nexport function getLegPlayersOrderUpdate()\r\n{\r\n    return legPlayersOrderUpdate;\r\n}\r\nexport function setLegPlayersOrderUpdate(ts)\r\n{\r\n    legPlayersOrderUpdate = ts;\r\n}\r\nexport function getLegPlayersOrder()\r\n{\r\n    return legPlayersOrder;\r\n}\r\nexport async function updateLegPlayersOrder()\r\n{\r\n    if(raceInfo?.raceId && raceInfo?.legNum && connectedPlayerId)\r\n    { \r\n        const raceId = raceInfo.raceId;\r\n        const legNum = raceInfo.legNum;\r\n        const { items, meta } = await getEntriesForTriplet(    raceId,legNum,connectedPlayerId,{    storeName : 'legPlayersOrder',limit:24*10*60,since:Date.now() - 10*24*60 * 60 * 1000, });\r\n        if(meta.timeout || !items || items.length == 0) return;\r\n        \r\n        legPlayersOrder = items;\r\n    } else\r\n        legPlayersOrder = [];\r\n}\r\n\r\nexport function getLegPlayersOptionsUpdate()\r\n{\r\n    return legPlayersOptionsUpdate;\r\n}\r\nexport function setLegPlayersOptionsUpdate(ts)\r\n{\r\n    legPlayersOptionsUpdate = ts;\r\n}\r\n\r\n\r\nexport function getLegPlayersOptions()\r\n{\r\n    return legPlayersOptions;\r\n}\r\n\r\nexport async function updateLegPlayersOptions()\r\n{\r\n    if(raceInfo?.raceId && raceInfo?.legNum && connectedPlayerId)\r\n    { \r\n        const raceId = raceInfo.raceId;\r\n        const legNum = raceInfo.legNum;\r\n\r\n        const playersOptList = await getLegPlayersOptionsByRaceLeg(raceId,legNum)\r\n                        .catch(error => {console.error(\"getlayersOptions error :\", error);});\r\n        legPlayersOptions = (playersOptList && playersOptList.length !=0)?playersOptList:[]; \r\n    }\r\n}\r\n\r\n\r\nexport function getLegPlayerTracksUpdate()\r\n{\r\n    return legPlayersTracksUpdate;\r\n}\r\nexport function setLegPlayersTracksUpdate(ts)\r\n{\r\n    legPlayersTracksUpdate = ts;\r\n}\r\n\r\n\r\nexport function getLegPlayersTracksFleet()\r\n{\r\n    return legPlayersTracks.fleet?legPlayersTracks.fleet:[];\r\n}\r\n\r\nexport function getLegPlayersTrackLeader()\r\n{\r\n    return legPlayersTracks.leader?legPlayersTracks.leader:[];\r\n}\r\n\r\n\r\nexport function getLegPlayersTracksGhost()\r\n{\r\n    if(!connectedPlayerId || !legPlayersTracks.ghosts \r\n        || legPlayersTracks.ghosts.lenght == 0 \r\n        || legPlayersTracks.ghosts[connectedPlayerId] == 0)\r\n         return [];\r\n    return legPlayersTracks.ghosts[connectedPlayerId];\r\n}\r\n\r\nexport async function updateLegPlayerTracks()\r\n{\r\n    if(raceInfo?.raceId && raceInfo?.legNum)\r\n    { \r\n        const raceId = raceInfo.raceId;\r\n        const legNum = raceInfo.legNum;\r\n\r\n        legPlayersTracks = {};\r\n        const { items, meta } = await getLegPlayersTracksByType(    raceId,legNum,'fleet',{ asMap: true });\r\n        if(meta.timeout || !items || items.length == 0) legPlayersTracks.fleet = [];\r\n        else legPlayersTracks.fleet = items;\r\n\r\n        const { items2, meta2 } = await getLegPlayersTracksByType(    raceId,legNum,'leader');\r\n        if(meta2.timeout || !items2 || items2.length == 0) legPlayersTracks.leader = [];\r\n        else legPlayersTracks.leader = items2;\r\n\r\n        const { items3, meta3 } = await getLegPlayersTracksByType(    raceId,legNum,'ghost');\r\n        if(meta3.timeout || !items3 || items3.length == 0) legPlayersTracks.ghosts = [];\r\n        else legPlayersTracks.ghosts = items3;\r\n    }\r\n}\r\n\r\n\r\nexport function getConnectedPlayerId()\r\n{\r\n    return connectedPlayerId;\r\n}\r\nexport function setConnectedPlayerId(uid)\r\n{\r\n    connectedPlayerId = uid;\r\n    /* update connecterPlayerInfos */\r\n}\r\nexport function getConnectedPlayerInfos()\r\n{\r\n    return connectedPlayerInfos;\r\n}\r\nexport async function updateConnectedPlayerInfos()\r\n{\r\n    if(playersList[connectedPlayerId])\r\n    {\r\n        const playerInfo = playersList[connectedPlayerId];\r\n        const teamInfo = playerInfo?.teamId?(teamList[playerInfo.teamId]?teamList[playerInfo.teamId]:{id:null,name:\"\"}):{id:null,name:\"\"};\r\n        connectedPlayerInfos = {...playerInfo,team:teamInfo};\r\n        legSelectedPlayers[connectedPlayerId] = true;\r\n    } else\r\n        connectedPlayerInfos  = [];\r\n}\r\n\r\nexport function getOpenedRaceId()\r\n{\r\n    return openedRaceId;\r\n}\r\n\r\nexport async function updateOpenedRaceId()\r\n{\r\n    await updateLegList();\r\n    openedRaceId.polarId = raceInfo.polar_id;\r\n    legSelectedPlayers = [];\r\n    if(connectedPlayerId) legSelectedPlayers[connectedPlayerId] = true;\r\n}\r\n\r\nexport function setOpenedRaceId(rid, legNum) {\r\n\r\n\r\n    if (!openedRaceIdHistory) openedRaceIdHistory = {};\r\n    if (!legPlayerInfosHistory) legPlayerInfosHistory = {};\r\n\r\n    if(openedRaceId?.raceId && openedRaceId?.legNum)\r\n    {\r\n        const key = `${openedRaceId.raceId}-${openedRaceId.legNum}`;\r\n\r\n        if (!openedRaceIdHistory[key]) {\r\n            openedRaceIdHistory[key] = { raceId: openedRaceId.raceId, legNum : openedRaceId.legNum };\r\n            console.log(`[setOpenedRaceId] Ajout√© √† l'historique : ${key}`);\r\n        }\r\n\r\n        if (legPlayersInfos) {\r\n            legPlayerInfosHistory[key] = structuredClone(legPlayersInfos);\r\n            console.log(`[setOpenedRaceId] Copie legPlayersInfos -> legPlayerInfosHistory[${key}]`);\r\n        } else if (!legPlayerInfosHistory[key]) {\r\n            legPlayerInfosHistory[key] = {};\r\n            console.log(`[setOpenedRaceId] Initialisation legPlayerInfosHistory[${key}] vide`);\r\n        }\r\n    }\r\n    openedRaceId.raceId = rid;\r\n    openedRaceId.legNum = legNum;\r\n\r\n    updateParamStamina();\r\n\r\n}","\r\nimport {getConnectedPlayerInfos, getLegList, getRaceInfo} from '../app/memoData.js';\r\n\r\nfunction setText(id, value) {\r\n    const el = document.getElementById(id);\r\n    if (el) el.textContent = value;\r\n}\r\n\r\nfunction updateVIPTag(isVIP) {\r\n    const vipTag = document.getElementById(\"lb_boatvip\");\r\n    if (!vipTag) return;\r\n\r\n    if (isVIP) {\r\n        vipTag.textContent = \"¬†VIP¬†\";\r\n        vipTag.style.backgroundColor = '#f7da03';\r\n        vipTag.style.color = 'black';\r\n    } else {\r\n        vipTag.textContent = \"\";\r\n        vipTag.style.backgroundColor = getComputedStyle(document.body).backgroundColor;\r\n        vipTag.style.color = '';\r\n    }\r\n}\r\nexport function onPlayerConnect() {\r\n\r\n  const playerInfo = getConnectedPlayerInfos();\r\n  if(playerInfo.length == 0) return;\r\n  setText(\"lb_boatname\", playerInfo.name);\r\n  setText(\"lb_credits\", playerInfo.credits);\r\n  updateVIPTag(playerInfo.isVIP);\r\n  if(playerInfo.team.length !=0)\r\n  {\r\n    setText(\"lb_teamname\", playerInfo.team.name);\r\n  }\r\n}\r\nexport function onRaceOpen() {\r\n  const raceInfo = getRaceInfo();\r\n  if(raceInfo?.raceId == null || raceInfo?.legNum == null) return;\r\n\r\n  const raceKey = raceInfo.raceId + '-' + raceInfo.legNum; \r\n  document.getElementById(\"sel_race\").value = raceKey\r\n}\r\n\r\nexport function updateRaceListDisplay() {\r\n  const raceList = getLegList();\r\n  \r\n  const sel = document.getElementById(\"sel_race\");\r\n  // Supprime les options dynamiques existantes\r\n  [...sel.options].forEach(opt => {\r\n    if (opt.dataset.dynamic === \"true\") sel.removeChild(opt);\r\n  });\r\n  \r\n  if (Object.keys(raceList).length === 0) {\r\n    const opt = document.createElement(\"option\");\r\n    opt.textContent = \"Aucune course disponible\";\r\n    opt.disabled = true;\r\n    opt.selected = true;\r\n    opt.dataset.dynamic = \"true\";\r\n    sel.appendChild(opt);\r\n  } else {\r\n    Object.values(raceList).forEach(leg => {\r\n      const opt = document.createElement(\"option\");\r\n      const raceKey = leg.raceId + '-' + leg.legNum; \r\n      opt.value = raceKey;\r\n      opt.textContent = `${leg.name} (${raceKey})`;\r\n      opt.dataset.dynamic = \"true\";\r\n      sel.appendChild(opt);\r\n    });\r\n    onRaceOpen();\r\n  }\r\n}\r\n\r\n  ","   \r\nimport { \r\n    roundTo\r\n} from '../../common/utils.js';\r\nimport {formatHM,formatTimeNotif,raceTableLines,infoSail,raceTableHeaders} from './common.js'\r\n\r\nimport {getConnectedPlayerId,\r\ngetRaceInfo,\r\ngetOpenedRaceId,\r\ngetLegList,\r\ngetParamStamina,\r\ngetOpenedRaceHistory,\r\ngetLegPlayerInfosHistory,\r\ngetLegPlayerInfos\r\n} from '../app/memoData.js'\r\n\r\n\r\nimport {getUserPrefs} from '../../common/userPrefs.js'\r\n\r\nexport function buildRaceStatusHtml()\r\n{\r\n    const userPrefs = getUserPrefs(); \r\n    const connectedRace = getOpenedRaceId();\r\n    const raceInfo = getRaceInfo();\r\n    const raceItes = getLegPlayerInfos();\r\n    const raceList = getLegList();\r\n\r\n    if(!raceInfo || raceInfo?.length == 0 \r\n      ||  !raceItes ) return;\r\n    \r\n    let raceStatusHeader = '<tr>'\r\n        + '<th title=\"Call Router\" colspan=\"2\">' + \"RT\" + '</th>'\r\n        + '<th title=\"Call Polars\">' + \"PL\" + '</th>'\r\n        + '<th title=\"Call WindInfo\">' + \"WI\" + '</th>'\r\n        + '<th title=\"Call ITYC\">' + \"ITYC\" + '</th>'\r\n        + '<th title=\"Open compass\">' + \"C\" + '</th>'\r\n        + '<th>' + \"Race\" + '</th>'\r\n        + '<th>' + \"Time\" + '</th>'\r\n        + raceTableHeaders()\r\n        + '<th title=\"Auto Sail time remaining\">' + \"aSail\" + '</th>'\r\n        + '<th title=\"Boat speed\">' + \"Speed\" + '</th>'\r\n        + '<th title=\"Boat VMG\">' + \"VMG\" + '</th>'\r\n        + '<th>' + \"Best VMG\" + '</th>'\r\n        + '<th>' + \"Best speed\" + '</th>'\r\n        + '<th title=\"Stamina\">' + \"Stamina\" + '</th>';\r\n    if(userPrefs.lang ==  \"fr\") {\r\n        raceStatusHeader += '<th title=\"Temps de manoeuvre th√©orique\">' + \"Virement\" + '</th>'\r\n                        + '<th title=\"Temps de manoeuvre th√©orique\">' + \"Empannage\" + '</th>'\r\n                        + '<th title=\"Temps de manoeuvre th√©orique\">' + \"Voile\" + '</th>';\r\n    } else\r\n    {\r\n        raceStatusHeader += '<th title=\"Approximated manoeuvring loose\">' + \"Tack\" + '</th>'\r\n                        + '<th title=\"Approximated manoeuvring loose\">' + \"Gybe\" + '</th>'\r\n                        + '<th title=\"Approximated manoeuvring loose\">' + \"Sail\" + '</th>';\r\n    }\r\n    raceStatusHeader += '<th title=\"Boat is aground\">' + \"Agnd\" + '</th>'\r\n        + '<th title=\"Boat is maneuvering, half speed\">' + \"Mnvr\" + '</th>';\r\n    if(userPrefs.raceData.lastCmd)  \r\n        raceStatusHeader += '<th >' + \"Last Command\" + '</th>';\r\n    raceStatusHeader += '<th title=\"ITYC option Status\">' + \"Co\" + '</th>'\r\n        \r\n    raceStatusHeader += '</tr>';\r\n    \r\n    let tableContent = buildRaceStatusHtmlLine(raceInfo ,raceItes.ites[0]);\r\n\r\n    const openedRaceIdHistory = getOpenedRaceHistory();\r\n    const legPlayerInfosHistory =getLegPlayerInfosHistory();\r\n\r\n    for (const legId of Object.entries(openedRaceIdHistory)) {\r\n        if(connectedRace.raceId != legId.raceId || connectedRace.legNum != legId.legNum)\r\n        {\r\n            const key = `${legId.raceId}-${legId.legNum}`;\r\n            const legIte = legPlayerInfosHistory[key];\r\n            const legInfo = raceList[key];\r\n            if(legIte?.ites && legInfo) tableContent += buildRaceStatusHtmlLine(legInfo ,legIte.ites[0]);\r\n        }\r\n    }\r\n    \r\n    const tablecontainer = document.getElementById(\"raceStatus\");\r\n    tablecontainer.innerHTML =  '<table id=\"raceStatusTable\">'\r\n        + '<thead>'\r\n        + raceStatusHeader\r\n        + '</thead>'\r\n        + '<tbody>'\r\n        + tableContent\r\n        + '</tbody>'\r\n        + '</table>';\r\n\r\n}\r\n\r\nfunction buildRaceStatusHtmlLine(raceInfo ,raceIte)\r\n{\r\n    if(!raceIte || !raceInfo) return \"\";\r\n    const userPrefs = getUserPrefs(); \r\n    let lastCommand = \"-\";\r\n    let lastCommandBG = \"\";\r\n    let agroundBG = raceIte.aground ? \"LightRed\" : \"lightgreen\";\r\n    let mnvrBG = raceIte.metaDash?.manoeuvering ? \"LightRed\" : \"lightgreen\";\r\n    \r\n    if(userPrefs.theme =='dark') {\r\n        agroundBG = raceIte.aground ? \"darkred\" : \"darkgreen\";\r\n        mnvrBG = raceIte.metaDash?.manoeuvering ? \"darkred\" : \"darkgreen\";\r\n    }\r\n\r\n    /* todo handle boat action\r\n    if (r.lastCommand != undefined) {\r\n        // ToDo: error handling; multiple commands; expiring?\r\n        var lcTime = formatTime(r.lastCommand.request.ts);\r\n        lastCommand = printLastCommand(r.lastCommand.request.actions);\r\n        lastCommand = \"T:\" + lcTime + \" Actions:\" + lastCommand;\r\n        if (r.lastCommand.rc != \"ok\") {\r\n            lastCommandBG = (drawTheme =='background-color:dark; ')?\"background-color:darkred; \":\"LightRed\";\r\n        }\r\n    }\r\n    */\r\n\r\n    let info = \"-\";\r\n    if (raceInfo.raceType === \"leg\") {\r\n        info = '<span>' + raceInfo.legName + '</span>';\r\n    } else if (raceInfo.raceType === \"record\") {\r\n        if (raceInfo.record) {\r\n            info = '<span>Record, Attempt ' + parseInt(raceInfo.record.attemptCounter) + '</span>';\r\n        } else {\r\n            info = '<span>-</span>'\r\n        }\r\n    }\r\n    if (raceInfo.record?.lastRankingGateName) {\r\n        info += '<br/><span>@ ' + r.record.lastRankingGateName + '</span>';\r\n    }\r\n\r\n    let trstyle = \"hov\";\r\n    const raceIdFull = getOpenedRaceId();\r\n    if (raceInfo.id === raceIdFull.raceId || raceInfo.legNum === raceIdFull.legNum) trstyle += \" sel\";\r\n\r\n    const best = raceIte.metaDash?.bVmg;\r\n    const bestVMGString = best?(best.twaUp + '<span class=\"textMini\">¬∞</span> | ' + best.twaDown + '<span class=\"textMini\">¬∞</span>'):'-';\r\n    const bestVMGTilte = best?(roundTo(best.vmgUp, 3) + '<span class=\"textMini\"> kts</span> | ' + roundTo(Math.abs(best.vmgDown), 3) + '<span class=\"textMini\"> kts</span>'):'-';\r\n    const bspeedTitle = best?(roundTo(best.bspeed, 3) + ' <span class=\"textMini\">kts</span><br>' + best.btwa + '<span class=\"textMini\">¬∞</span>'):'-';\r\n\r\n    let lastCalcStyle = \"\"\r\n    if(raceIte.metaDash?.deltaReceiveCompute > 900000) {\r\n        lastCalcStyle = 'style=\"background-color: red;'\r\n        lastCalcStyle += (userPrefs.theme =='dark')?' color:black;\"':'\"';\r\n    }\r\n\r\n    const manoeuver = raceIte.metaDash?.manoeuver;\r\n    const tack = manoeuver?(\"<p>-\" +  manoeuver.tack.pena.dist + \"nm | \" + manoeuver.tack.pena.time + \"s</p>\"\r\n             +  \"<p>-\" + manoeuver.tack.energyLoose + \"% | \" + manoeuver.tack.energyRecovery + \"min</p>\"):'-';\r\n    const gybe =  manoeuver?(\"<p>-\" + manoeuver.gybe.pena.dist + \"nm | \" + manoeuver.gybe.pena.time + \"s</p>\" \r\n             + \"<p>-\"+manoeuver.gybe.energyLoose + \"% | \" + manoeuver.gybe.energyRecovery + \"min</p>\"):'-';\r\n    const sail =  manoeuver?(\"<p>-\" + manoeuver.sail.pena.dist + \"nm | \" + manoeuver.sail.pena.time + \"s</p>\" \r\n             + \"<p>-\"+manoeuver.sail.energyLoose + \"% | \" + manoeuver.sail.energyRecovery + \"min</p>\"):'-';    \r\n    let staminaStyle = \"\";\r\n    let staminaTxt = \"-\";\r\n\r\n    const stamina = raceIte.metaDash?.realStamina;\r\n    const paramStamina = getParamStamina();\r\n    if(stamina)\r\n    {\r\n        if (stamina < paramStamina?.tiredness[0]) \r\n            staminaStyle = 'style=\"color:red\"';\r\n        else if (stamina < paramStamina?.tiredness[1]) \r\n            staminaStyle = 'style=\"color:orange\"';\r\n        else \r\n            staminaStyle = 'style=\"color:green\"';   \r\n\r\n        staminaTxt = roundTo(stamina , 2) + \"%\";\r\n        staminaTxt += \" (x\" + roundTo(manoeuver.staminaFactor , 2)+\")\" ;\r\n    }\r\n\r\n    let fullStamina = '<td class=\"stamina\" ';\r\n\r\n    if(raceIte.metaDash?.coffeeBoost != 0 || raceIte.metaDash?.chocoBoost != 0)\r\n    {\r\n        \r\n        fullStamina += '><div class=\"textMini\">';\r\n        if(raceIte.metaDash.chocoBoost != 0) {\r\n            fullStamina += 'üç´+'+ roundTo(raceIte.metaDash.chocoBoost, 2)+'%';\r\n            fullStamina += ' ‚åö'+ formatHM(raceIte.metaDash.chocoExp-Date.now());\r\n        }\r\n        fullStamina += '</div>';\r\n\r\n        fullStamina += '<div ' + staminaStyle +'>';\r\n        fullStamina += staminaTxt;\r\n        fullStamina += '</div>';\r\n        fullStamina += '<div class=\"textMini\">';\r\n        if(raceIte.metaDash.coffeeBoost != 0) {\r\n            fullStamina += '‚òï+'+ roundTo(raceIte.metaDash.coffeeBoost, 2)+'%';\r\n            fullStamina += ' ‚åö'+ formatHM(raceIte.metaDash.coffeeExp-Date.now());\r\n        }\r\n        fullStamina += '</div>';\r\n        fullStamina += '</td>';\r\n    \r\n        //üç¥\r\n    } else\r\n    {\r\n        fullStamina += staminaStyle + '>' + staminaTxt  + '</td>';\r\n    }\r\n\r\n    let itycLedColor = \"LightGrey\";\r\n/*\r\n                \r\n                if(document.getElementById(\"ITYC_record\").checked)\r\n                {\r\n                    if(r.optITYCStatus) itycLedColor = \"LimeGreen\";\r\n                    else  itycLedColor = \"Red\";\r\n                }\r\n*/\r\n    const rid = raceInfo.raceId+\"-\"+raceInfo.legNum;\r\n    \r\n    const zezoUrl = raceInfo.zezoUrl?raceInfo.zezoUrl:null; \r\n    let returnVal = '<tr class=\"' + trstyle + '\" id=\"rs:' + rid + '\">'\r\n    returnVal += (zezoUrl ? ('<td class=\"tdc\"><span id=\"rt:' + rid + '\">&#x2388;</span></td>') : '<td>&nbsp;</td>')\r\n    returnVal +=  '<td class=\"tdc\"><span id=\"vrz:' + rid + '\">&#x262F;</span></td>'\r\n    returnVal += '<td class=\"tdc\"><span id=\"pl:' + rid + '\">&#x26F5;</span></td>'\r\n    returnVal += '<td class=\"tdc\"><span id=\"wi:' + rid + '\"><img class=\"icon\" src=\"./img/wind.svg\"/></span></td>'\r\n    returnVal += '<td class=\"tdc\"><span id=\"ityc:' + rid + '\">&#x2620;</span></td>'\r\n    returnVal += '<td class=\"tdc\"><span id=\"cp:' + rid + '\"><img class=\"icon\" src=\"./img/compass.svg\"/></span></td>'\r\n    returnVal += '<td class=\"name\">' + raceInfo.legName + '</td>'\r\n    returnVal +='<td class=\"time\" ' + lastCalcStyle + '>' + formatTimeNotif(raceIte.iteDate) + '</td>'\r\n    returnVal += raceTableLines(raceIte,best)\r\n    returnVal += infoSail(raceIte,false)\r\n    returnVal += '<td class=\"speed1\">' + roundTo(raceIte.speed, 3) + '</td>'\r\n    returnVal += '<td class=\"speed2\">' + (raceIte.metaDash?.vmg?roundTo(raceIte.metaDash.vmg, 3):'-') + '</td>'\r\n    returnVal += '<td class=\"bvmg\"><p>' + bestVMGString + '</p>';\r\n        if(userPrefs.raceData.VMGSpeed) \r\n            returnVal += '<p>(' + bestVMGTilte + ')</p>';\r\n    returnVal += '</td>'\r\n    returnVal += '<td class=\"bspeed\">' + bspeedTitle +'</td>'\r\n    returnVal += fullStamina\r\n    returnVal += '<td class=\"tack\">' + tack + '</td>'\r\n    returnVal += '<td class=\"gybe\">' + gybe + '</td>'\r\n    returnVal += '<td class=\"sailPenalties\">' + sail + '</td>'\r\n    returnVal += '<td class=\"agrd\" style=\"background-color:' + agroundBG + ';\">' + (raceIte.aground ? \"AGROUND\" : \"No\") + '</td>'\r\n    returnVal += '<td class=\"man\" style=\"background-color:' + mnvrBG + ';\">' + (raceIte.metaDash?.manoeuvering ? \"Yes\" : \"No\") + '</td>';\r\n\r\n    if(userPrefs.raceData.lastCmd)   \r\n        returnVal += '<td ' + lastCommandBG + '\">' + lastCommand + '</td>';\r\n\r\n    returnVal += '<td><span style=\"color:'+itycLedColor+';font-size:16px;\"><b>&#9679</b></span></td>';\r\n    returnVal += '</tr>';\r\n    return returnVal;\r\n}\r\n   \r\n  ","   \r\nimport { \r\n    roundTo\r\n} from '../../common/utils.js';\r\nimport {raceTableLines,raceTableHeaders,\r\n    genthRacelog,gentdRacelog,\r\n    infoSail,getxFactorStyle,\r\n    dateUTCSmall,DateUTC,formatPosition,formatSeconds,getBG\r\n} from './common.js';\r\n\r\nimport {sailNames,sailColors} from \"./constant.js\"\r\n\r\nimport {getConnectedPlayerId,\r\ngetRaceInfo,\r\ngetOpenedRaceId,\r\ngetLegList,\r\ngetParamStamina,\r\ngetOpenedRaceHistory,\r\ngetLegPlayerInfosHistory,\r\ngetLegPlayerInfos,\r\ngetLegPlayersOrder\r\n} from '../app/memoData.js'\r\n\r\n\r\nimport {getUserPrefs} from '../../common/userPrefs.js'\r\n\r\nexport function buildRaceLogHtml() {\r\n    const userPrefs = getUserPrefs();\r\n    const raceInfo = getRaceInfo();\r\n    const racePlayerInfos = getLegPlayerInfos();\r\n    const raceOrder = getLegPlayersOrder();\r\n\r\n    if(!raceInfo || raceInfo?.length == 0 \r\n      ||  !racePlayerInfos?.ites) return;\r\n    let raceItes = racePlayerInfos.ites;\r\n    if(raceOrder?.length) {\r\n        raceItes = [...raceItes, ...raceOrder].sort((a, b) => b.iteDate - a.iteDate);\r\n    }\r\n    const raceLogTableHeader = '<tr>'\r\n        + genthRacelog(\"th_rl_date\", \"dateTime\", \"Time\" + dateUTCSmall())\r\n        + raceTableHeaders()\r\n        + genthRacelog(\"th_rl_aSail\", \"aSail\", \"aSail\", \"Auto Sail time remaining\")\r\n        + genthRacelog(\"th_rl_reportedSpeed\", \"reportedSpeed\", \"vR (kn)\", \"Reported speed\")\r\n        + genthRacelog(\"th_rl_calcSpeed\", \"calcSpeed\", \"vC (kn)\", \"Calculated speed (Œîd/Œît)\")\r\n        + genthRacelog(\"th_rl_foils\", \"foils\", \"Foils\", \"Foiling factor\")\r\n        + genthRacelog(\"th_rl_factor\", \"factor\", \"Factor\", \"Speed factor\")\r\n        + genthRacelog(\"th_rl_stamina\", \"stamina\", \"Stamina\", \"Stamina Value. (penalities factor)\")\r\n        + genthRacelog(\"th_rl_deltaDistance\", \"deltaDistance\", \"Œîd (nm)\", \"Calculated distance\")\r\n        + genthRacelog(\"th_rl_deltaTime\", \"deltaTime\", \"Œît (s)\", \"Time between positions\")\r\n        + genthRacelog(\"th_rl_psn\", \"position\", \"Position\")\r\n        + genthRacelog(\"th_rl_sail\", \"sail\", \"Sail\", \"Sail change time remaining\")\r\n        + genthRacelog(\"th_rl_gybe\", \"gybe\", \"Gybe\", \"Gybing time remaining\")\r\n        + genthRacelog(\"th_rl_tack\", \"tack\", \"Tack\", \"Tacking time remaining\")\r\n        + '</tr>';\r\n\r\n        let raceLogContent = \"\";\r\n        if(raceItes.length == 0) return; //TODO display empty raceLog\r\n        for(let idx=0;idx<raceItes.length;idx++)\r\n        {\r\n            const raceLogLine = raceItes[idx];\r\n            if('action' in raceLogLine)\r\n            {\r\n                raceLogContent += buildRaceLogLineCmd(raceLogLine);\r\n            } else {\r\n                raceLogContent += buildRaceLogLine(raceLogLine);\r\n            }\r\n            \r\n\r\n        }\r\n        Object.keys(raceItes).forEach(key => {\r\n            if(key!=\"info\" && key!=\"options\" && key!=\"team\")\r\n            {\r\n                const raceLogLine = raceItes[key];\r\n                if('action' in raceLogLine)\r\n                {\r\n                    raceLogContent += buildRaceLogLineCmd(raceLogLine);\r\n                } else {\r\n                    raceLogContent += buildRaceLogLine(raceLogLine);\r\n                }\r\n            }\r\n        });\r\n\r\n        \r\n    const utcStyle = userPrefs.global.localTime ? 'display: none;' : '';\r\n    const utcLocalStyle = userPrefs.global.localTime ? '' : 'display: none;';\r\n\r\n    const logTxt = `\r\n        <style>\r\n            #UTC { ${utcStyle} }\r\n            #UTCLocal { ${utcLocalStyle} }\r\n        </style>\r\n        <table>\r\n            <thead class=\"sticky\">${raceLogTableHeader}</thead>\r\n            <tbody>${raceLogContent}</tbody>\r\n        </table>`;\r\n    document.getElementById(\"recordlog\").innerHTML = logTxt;\r\n    updateToggleRaceLogCommandsLines();\r\n}\r\n\r\n\r\nfunction buildRaceLogLineCmd(raceLogLine) {\r\n    if(!raceLogLine.action) return\"\";\r\n    return '<tr class=\"commandLine hovred\">'\r\n    + '<td class=\"time\">' + DateUTC(raceLogLine.iteDate, 1) + '</td>'\r\n    + '<td colspan=\"19\"><b>Command @ ' + (raceLogLine.serverTs ? DateUTC(raceLogLine.serverTs, 2) : DateUTC(raceLogLine.iteDate))\r\n    + '</b> ‚Ä¢ <b>Actions</b> ‚Üí ' + printLastCommand(raceLogLine.action) + '</td>'\r\n    + '</tr>';\r\n}\r\nfunction printLastCommand(order) {\r\n    let lastCommand = \"\";\r\n    const action = order.action\r\n    if (order.type == \"order\") {\r\n        lastCommand += \"<span class='lastCommandOrder'>\" + (action.autoTwa ? \" TWA\" : \" HDG\") + \" \" + roundTo(action.deg, 0) + \"¬∞</span> ‚Ä¢ \";\r\n    } else if (order.type == \"sail\") {\r\n        lastCommand += \" Sail <span class='lastCommandOrder'>\" + sailNames[action.sailId] + \"</span>\";\r\n    } else if (order.type == \"prog\") {\r\n        action.map(function (progCmd) {\r\n            const progTime = DateUTC(progCmd.timestamp, 1);\r\n            lastCommand += \"<span class='lastCommandOrder'>\" + (progCmd.autoTwa ? \" TWA\" : \" HDG\") + \" \" + roundTo(progCmd.deg, 0) + \"¬∞</span> @ \" + progTime + \" ‚Ä¢ \";\r\n        });\r\n    } else if (order.type == \"wp\") {\r\n        action.map(function (waypoint) {\r\n            lastCommand += \" WP <span class='lastCommandOrder'>\" + formatPosition(waypoint.lat, waypoint.lon) + \"</span> ‚Ä¢ \";\r\n        });\r\n    }\r\n    lastCommand = lastCommand.replace(/ \\‚Ä¢([^‚Ä¢]*)$/, \"\");\r\n    return lastCommand;\r\n}\r\nfunction buildRaceLogLine(raceIte)\r\n{\r\n    function isDifferingSpeed(realSpeed, calculatedSpeed) {\r\n        return Math.abs(1 - realSpeed / calculatedSpeed) > 0.01;\r\n    }\r\n\r\n\r\n\r\n\r\n    const iteDash= raceIte.metaDash;\r\n    const userPrefs = getUserPrefs();\r\n    const darkTheme = userPrefs.theme==\"dark\";\r\n    if(!raceIte.tws || !iteDash ) return\"\";\r\n\r\n    let speedCStyle = \"\";\r\n    let speedTStyle = \"\";\r\n    let deltaDist = \"\";\r\n\r\n    if(\"deltaD\" in iteDash\r\n        && \"speedC\" in iteDash\r\n        && \"deltaD_T\" in iteDash) {\r\n        deltaDist = roundTo(iteDash.deltaD, 3);\r\n        if (isDifferingSpeed(raceIte.speed,iteDash.speedC)) {\r\n            speedCStyle = 'style=\"background-color: yellow;';\r\n            speedCStyle += darkTheme?' color:black;\"':'\"';\r\n\r\n        } else if (iteDash.speedT && isDifferingSpeed(raceIte.speed)) {\r\n            // Speed differs but not due to penalty - assume \"Bad Sail\" and display theoretical delta\r\n            speedTStyle = 'style=\"background-color: ' + (darkTheme?\"darkred\":\"LightRed\") + ';\"';\r\n            deltaDist = deltaDist + \" (\" + roundTo(iteDash.deltaD_T, 3) + \")\";\r\n        }\r\n    }\r\n    if (iteDash.manoeuvering) {\r\n        speedCStyle = 'style=\"background-color: ' + (darkTheme?\"darkred\":\"LightRed\") + ';\"';\r\n    }\r\n\r\n    const sailChange = formatSeconds(raceIte.tsEndOfSailChange - raceIte.iteDate);\r\n    const gybing = formatSeconds(raceIte.tsEndOfGybe - raceIte.iteDate);\r\n    const tacking = formatSeconds(raceIte.tsEndOfTack - raceIte.iteDate);\r\n\r\n    let staminaStyle = \"\";\r\n    let staminaTxt = \"-\";\r\n\r\n    const stamina = iteDash.realStamina;\r\n    const paramStamina = getParamStamina();\r\n    if(stamina)\r\n    {\r\n        if (stamina < paramStamina?.tiredness[0]) \r\n            staminaStyle = 'style=\"color:red\"';\r\n        else if (stamina < paramStamina?.tiredness[1]) \r\n            staminaStyle = 'style=\"color:orange\"';\r\n        else \r\n            staminaStyle = 'style=\"color:green\"';   \r\n\r\n        staminaTxt = roundTo(stamina , 2) + \"%\";\r\n        staminaTxt += iteDash.manoeuver.staminaFactor?(\" (x\" + roundTo(iteDash.manoeuver.staminaFactor , 2)+\")\"):\"\" ;\r\n    }\r\n\r\n    const xfactorStyle = getxFactorStyle(raceIte);\r\n\r\n    let xfactorTxt = roundTo(iteDash.xfactor, 4);\r\n    if(iteDash.sailCoverage != 0 && iteDash.xplained) {\r\n        xfactorTxt += \" \" + iteDash.sailCoverage +\"%\";\r\n    }\r\n    const foilTxt = iteDash.realFoilFactor==null?\"-\":(roundTo(iteDash.realFoilFactor,0) + \"%\");\r\n    return '<tr class=\"hovred\">'\r\n        + gentdRacelog(\"time\", \"time\", null, \"Time\", DateUTC(raceIte.iteDate, 1))\r\n        + raceTableLines(raceIte,iteDash.bVmg)\r\n        + infoSail(raceIte,false,false)\r\n        + gentdRacelog(\"speed1\", \"reportedSpeed\", null, \"vR (kn)\", roundTo(raceIte.speed, 3))\r\n        + gentdRacelog(\"speed2\", \"calcSpeed\", speedCStyle, \"vC (kn)\", (roundTo(iteDash.speedC, 3) + \" (\" + sailNames[(raceIte.sail % 10)] + \")\"))\r\n        + gentdRacelog(\"foils\", \"foils\", null, \"Foils\",foilTxt)\r\n        + gentdRacelog(\"xfactor\", \"factor\", xfactorStyle, \"Factor\", xfactorTxt)\r\n        + gentdRacelog(\"stamina\", \"stamina\", staminaStyle, \"Stamina\", (stamina ? roundTo(stamina , 2) + \"%\": \"-\"))\r\n        + gentdRacelog(\"deltaD\", \"deltaDistance\", speedTStyle, \"Œîd (nm)\", deltaDist)\r\n        + gentdRacelog(\"deltaT\", \"deltaTime\", null, \"Œît (s)\", roundTo(iteDash.deltaT, 0))\r\n        + gentdRacelog(\"position\", \"position\", null, \"Position\", formatPosition(raceIte.pos.lat, raceIte.pos.lon))\r\n        + '<td class=\"sailPenalties\" ' + getBG(iteDash.tsEndOfSailChange,raceIte.metaDash.previousIteDate) + '>' + sailChange + '</td>'\r\n        + '<td class=\"gybe\" ' + getBG(iteDash.tsEndOfGybe,iteDash.previousIteDate) + '>' + gybing + '</td>'\r\n        + '<td class=\"tack\" ' + getBG(iteDash.tsEndOfTack,iteDash.previousIteDate) + '>' + tacking + '</td>'\r\n        + '</tr>';\r\n\r\n\r\n}\r\n\r\n\r\n\r\nfunction updateToggleRaceLogCommandsLines() {\r\n    const userPrefs = getUserPrefs();\r\n    const commandLines = document.querySelectorAll('tr.commandLine');\r\n    commandLines.forEach(function(line, index) {\r\n        if (userPrefs.raceLog.hideLastCmd) {\r\n            if ( index > 4) {\r\n                line.style.display = 'none';\r\n            }\r\n        } else {\r\n            line.style.display = '';\r\n        }\r\n    });\r\n}\r\n\r\n","\r\nimport {getUserPrefs} from \"../../common/userPrefs.js\"\r\nimport cfg from '@/config.json';\r\nlet sortOrder = 0;\r\nlet sortField = \"none\";\r\n\r\n\r\nexport const FLEET_SORT_KEY_BY_TH_ID = {\r\n    th_lu:      \"lastCalcDate\",\r\n    th_name:    \"displayName\",\r\n    th_teamname:\"teamname\",\r\n    th_rank:    \"rank\",\r\n    th_racetime:\"raceTime\",\r\n    th_dtu:     \"distanceToUs\",\r\n    th_dtf:     \"dtf\",\r\n    th_twd:     \"twd\",\r\n    th_tws:     \"tws\",\r\n    th_twa:     \"twa\",\r\n    th_hdg:     \"heading\",\r\n    th_speed:   \"speed\",\r\n    th_vmg:     \"vmg\",\r\n    th_sail:    \"sail\",\r\n    th_factor:  \"xfactor\",\r\n    th_foils:   \"xoption_foils\",\r\n    th_sd:      \"startDate\",\r\n    th_eRT:     \"eRT\",\r\n    th_avgS:    \"avgSpeed\",\r\n    th_options: \"xoption_options\",\r\n    th_state:   \"state\",\r\n    // pas de tri pour: th_rt, th_psn, th_remove\r\n};\r\n\r\nexport function setSortField(value)\r\n{\r\n    sortField = value;\r\n}\r\n\r\nexport function setSortOrder(value)\r\n{\r\n    sortOrder = value;\r\n}\r\n\r\nexport function getSortField()\r\n{\r\n    return sortField;\r\n}\r\n\r\nexport function getSortOrder()\r\n{\r\n    return sortOrder;\r\n}\r\n\r\nexport function isDisplayEnabled(playerIte, userId, connectPlayerId) {\r\n    const userPrefs = getUserPrefs();\r\n    const userFilters = userPrefs.filters;\r\n\r\n    if(cfg.debugFilter1)\r\n    {\r\n        console.groupCollapsed(`[isDisplayEnabled] Check for user ${userId}`);\r\n        console.log(\"‚Üí connectPlayerId :\", connectPlayerId);\r\n        console.log(\"‚Üí playerIte :\", playerIte);\r\n        console.log(\"‚Üí userFilters :\", userFilters);\r\n    }\r\n    const conditions = {\r\n        self: (userId === connectPlayerId),\r\n        followed: (playerIte.type2 === \"followed\" && userFilters.friends),\r\n        team: (playerIte.type2 === \"team\" && userFilters.team),\r\n        normal: (playerIte.type2 === \"normal\" && userFilters.opponents),\r\n        top: ((playerIte.type === \"top\" || playerIte.type2 === \"top\") && userFilters.top),\r\n        certified: (playerIte.type2 === \"certified\" && userFilters.certified),\r\n        real: (playerIte.type2 === \"real\" && userFilters.real),\r\n        sponsor: ((playerIte.type === \"sponsor\" || playerIte.type2 === \"sponsor\") && userFilters.sponsors),\r\n        selected: (playerIte.choice === true && userFilters.selected),\r\n        inRace: (playerIte.state === \"racing\" && userFilters.inRace)\r\n    };\r\n\r\n    const result = Object.values(conditions).some(Boolean);\r\n    if(cfg.debugFilter1)\r\n    {\r\n\r\n        // Log des r√©sultats de chaque condition\r\n        Object.entries(conditions).forEach(([key, value]) => {\r\n            console.log(`  ${key.padEnd(10)}:`, value);\r\n        });\r\n\r\n        console.log(\"‚úÖ Result :\", result);\r\n        console.groupEnd();\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nfunction getFleetSortValue(pInfos, sortField) {\r\n    const ite     = pInfos?.ite;\r\n    const iteDash = ite?.metaDash;\r\n\r\n    switch (sortField) {\r\n        case \"lastCalcDate\":   // Date\r\n            return ite?.dateIte ?? 0;\r\n\r\n        case \"displayName\":    // Skipper\r\n            return pInfos.info?.name ?? \"\";\r\n\r\n        case \"teamname\":       // Team\r\n            return pInfos.team?.name ?? \"\";\r\n\r\n        case \"rank\":\r\n            return ite?.rank ?? Number.POSITIVE_INFINITY;\r\n\r\n        case \"raceTime\":\r\n            return iteDash?.raceTime ?? Number.POSITIVE_INFINITY;\r\n\r\n        case \"distanceToUs\":   // DTU\r\n            return iteDash?.DTU ?? Number.POSITIVE_INFINITY;\r\n\r\n        case \"dtf\":\r\n            return iteDash?.dtf ?? Number.POSITIVE_INFINITY;\r\n\r\n        case \"twd\":\r\n            return (ite?.twd ?? iteDash?.twd ?? 0);\r\n\r\n        case \"tws\":\r\n            return ite?.tws ?? 0;\r\n\r\n        case \"twa\":\r\n            return Math.abs(ite?.twa ?? 0);\r\n\r\n        case \"heading\":\r\n            return ite?.hdg ?? 0;\r\n\r\n        case \"speed\":\r\n            return ite?.speed ?? 0;\r\n\r\n        case \"vmg\":\r\n            return iteDash?.vmg ?? 0;\r\n\r\n        case \"sail\":\r\n            return ite?.sail ?? 0;\r\n\r\n        case \"xfactor\":\r\n            return iteDash?.xfactor ?? 0;\r\n\r\n        case \"xoption_foils\":\r\n            return iteDash?.realFoilFactor ?? 0;\r\n\r\n        case \"startDate\":\r\n            return ite?.startDate ?? 0;\r\n\r\n        case \"eRT\":\r\n            return iteDash?.eRT ?? Number.POSITIVE_INFINITY;\r\n\r\n        case \"avgSpeed\":\r\n            return iteDash?.avgSpeed ?? 0;\r\n\r\n        case \"xoption_options\":\r\n            // ex : nombre d‚Äôoptions activ√©es\r\n            return pInfos.options ? Object.keys(pInfos.options).length : 0;\r\n\r\n        case \"state\":\r\n            // ordre custom des √©tats\r\n            const order = {\r\n                racing: 1,\r\n                waiting: 2,\r\n                staying: 3,\r\n                arrived: 4\r\n            };\r\n            return order[ite?.state] ?? 999;\r\n\r\n        default:\r\n            return 0;\r\n    }\r\n}\r\n\r\nexport function compareFleetPlayers(pA, pB, sortField, sortAsc) {\r\n    const A = getFleetSortValue(pA, sortField);\r\n    const B = getFleetSortValue(pB, sortField);\r\n\r\n    const aNull = (A === null || A === undefined);\r\n    const bNull = (B === null || B === undefined);\r\n    if (aNull && !bNull) return 1;\r\n    if (!aNull && bNull) return -1;\r\n    if (aNull && bNull)  return 0;\r\n\r\n    let cmp;\r\n    if (typeof A === \"string\" || typeof B === \"string\") {\r\n        cmp = String(A).localeCompare(String(B));\r\n    } else {\r\n        cmp = (A < B) ? -1 : (A > B) ? 1 : 0;\r\n    }\r\n\r\n    return sortAsc ? cmp : -cmp;\r\n}\r\n\r\n","   \r\nimport { \r\n    roundTo,isBitSet,guessOptionBits,\r\n} from '../../common/utils.js';\r\nimport {genth,gentd,getxFactorStyle,formatDHMS,\r\n    dateUTCSmall,formatPosition,formatTime,formatShortDate\r\n} from './common.js';\r\n\r\nimport {sailNames,sailColors,categoryStyle, categoryStyleDark,category} from \"./constant.js\"\r\n\r\nimport {getConnectedPlayerId,\r\n        getRaceInfo,\r\n        getLegPlayerInfos,\r\n        getLegFleetInfos,\r\n        getLegSelectedPlayersState,\r\n        setLegSelectedPlayers\r\n} from '../app/memoData.js'\r\n\r\nimport {getUserPrefs} from '../../common/userPrefs.js'\r\n\r\nimport {getSortField, getSortOrder,setSortOrder,setSortField,isDisplayEnabled,compareFleetPlayers,FLEET_SORT_KEY_BY_TH_ID} from '../app/sortManager.js'\r\n\r\n\r\nexport function buildRaceFleetHtml() {\r\n    const raceInfo         = getRaceInfo();\r\n    const raceItes         = getLegPlayerInfos();\r\n    const raceItesFleet    = getLegFleetInfos();\r\n    const connectedPlayerId = getConnectedPlayerId();\r\n\r\n    if (!raceInfo || raceInfo?.length === 0) return;\r\n\r\n    // pas de flotte\r\n    if (!raceItesFleet || Object.keys(raceItesFleet).length === 0) {\r\n        document.getElementById(\"friendList\").innerHTML = `\r\n            <table id=\"raceidTable\">\r\n            <thead><tr><th>No friend positions received yet. Please enter a race.</th></tr></thead>\r\n            </table>`;\r\n        return;\r\n    }\r\n\r\n    // on prend l‚Äôite courante pour le joueur connect√©\r\n    if (raceItes && raceItes.ites && raceItes.ites.length > 0) {\r\n        raceItes.ite = raceItes.ites[0];\r\n    }\r\n\r\n    const sortField = getSortField();   // ex: \"dtf\", \"speed\", \"displayName\", ...\r\n    const sortAsc   = getSortOrder();   // bool√©en, utilis√© d√©j√† par genth()\r\n\r\n    // HEADER\r\n    let raceFleetTableHeader = '<tr>'\r\n        + genth(\"th_rt\", \"RT\", \"Call Router\", undefined)\r\n        + genth(\"th_lu\", \"Date\" + dateUTCSmall(), undefined,      sortField == \"lastCalcDate\",   sortAsc)\r\n        + genth(\"th_name\", \"Skipper\", undefined,                   sortField == \"displayName\",    sortAsc)\r\n        + genth(\"th_teamname\", \"Team\", undefined,                  sortField == \"teamname\",       sortAsc)\r\n        + genth(\"th_rank\", \"Rank\", undefined,                      sortField == \"rank\",           sortAsc)\r\n        + ((raceInfo.type !== \"record\")\r\n            ? genth(\"th_racetime\", \"RaceTime\", \"Current Race Time\", sortField == \"raceTime\",     sortAsc)\r\n            : \"\")\r\n        + genth(\"th_dtu\", \"DTU\", \"Distance to Us\",                 sortField == \"distanceToUs\",  sortAsc)\r\n        + genth(\"th_dtf\", \"DTF\", \"Distance to Finish\",             sortField == \"dtf\",           sortAsc)\r\n        + genth(\"th_twd\", \"TWD\", \"True Wind Direction\",            sortField == \"twd\",           sortAsc)\r\n        + genth(\"th_tws\", \"TWS\", \"True Wind Speed\",                sortField == \"tws\",           sortAsc)\r\n        + genth(\"th_twa\", \"TWA\", \"True Wind Angle\",                sortField == \"twa\",           sortAsc)\r\n        + genth(\"th_hdg\", \"HDG\", \"Heading\",                        sortField == \"heading\",       sortAsc)\r\n        + genth(\"th_speed\",\"Speed\",\"Boat Speed\",                   sortField == \"speed\",         sortAsc)\r\n        + genth(\"th_vmg\",\"VMG\",\"Velocity Made Good\",               sortField == \"vmg\",           sortAsc)\r\n        + genth(\"th_sail\", \"Sail\", \"Sail Used\",                    sortField == \"sail\",          sortAsc)\r\n        + genth(\"th_factor\", \"Factor\", \"Speed factor over no-options boat\", sortField == \"xfactor\", sortAsc)\r\n        + genth(\"th_foils\", \"Foils\", \"Boat assumed to have Foils. Unknown if no foiling conditions\", sortField == \"xoption_foils\", sortAsc);\r\n\r\n    if (raceInfo.type === \"record\") {\r\n        raceFleetTableHeader +=\r\n              genth(\"th_sd\",\"Race Time\", \"Current Race Time\",       sortField == \"startDate\",     sortAsc)\r\n            + genth(\"th_eRT\",\"ERT\", \"Estimated Total Race Time\",    sortField == \"eRT\",           sortAsc)\r\n            + genth(\"th_avgS\",\"avgS\", \"Average Speed\",              sortField == \"avgSpeed\",      sortAsc);\r\n    }\r\n\r\n    raceFleetTableHeader +=\r\n          genth(\"th_psn\", \"Position\", undefined)\r\n        + genth(\"th_options\", \"Options\", \"Options according to Usercard\",  sortField == \"xoption_options\", sortAsc)\r\n        + genth(\"th_state\", \"State\", \"Waiting or Staying, Racing, Arrived, Aground or Bad TWA\", sortField == \"state\", sortAsc)\r\n        + genth(\"th_remove\", \"\", \"Remove selected boats from the fleet list\", undefined)\r\n        + '</tr>';\r\n\r\n    const rows = Object.entries(raceItesFleet).map(([userId, entry]) => {\r\n        const pInfos = (userId == connectedPlayerId) ? raceItes : entry;\r\n        return { userId, pInfos };\r\n    });\r\n\r\n    rows.sort((a, b) => {\r\n        const isAme = a.userId === connectedPlayerId;\r\n        const isBme = b.userId === connectedPlayerId;\r\n\r\n        if (isAme && !isBme) return -1;\r\n        if (!isAme && isBme) return  1;\r\n\r\n        return compareFleetPlayers(a.pInfos, b.pInfos, sortField, sortAsc);\r\n    });\r\n\r\n    let raceFleetLines = \"\";\r\n    for (const { userId, pInfos } of rows) {\r\n        raceFleetLines += buildRaceFleetLine(pInfos, raceInfo, connectedPlayerId);\r\n    }\r\n\r\n    const fleetHTML =\r\n        '<table>'\r\n        + '<thead class=\"sticky\">'\r\n        + raceFleetTableHeader\r\n        + '</thead>'\r\n        + '<tbody>'\r\n        + raceFleetLines\r\n        + '</tbody>'\r\n        + '</table>';\r\n\r\n    document.getElementById(\"friendList\").innerHTML = fleetHTML;\r\n\r\n    addEventListenersToRemoveSelectedBoatButtons();\r\n    addEventListenersToSelectedLine();\r\n    addEventListenersFleetSort();\r\n}\r\n    \r\n\r\n\r\nfunction buildRaceFleetLine(playerFleetInfos,raceInfo,connectedPlayerId) {\r\n\r\n\r\n    if(!playerFleetInfos || !raceInfo) \r\n        return \"\";\r\n    const playerIte = playerFleetInfos.ite;\r\n    if(!playerIte) \r\n        return \"\";\r\n    const iteDash= playerIte.metaDash;\r\n    if(!iteDash) \r\n        return \"\";\r\n    const userPrefs = getUserPrefs();\r\n    const darkTheme = userPrefs.theme==\"dark\";\r\n\r\n    const userId = playerIte.userId;\r\n\r\n    const isDisplay = isDisplayEnabled(playerIte, userId,connectedPlayerId) &&  ( !userPrefs.filters.inRace|| r.state == \"racing\" );\r\n    if(!isDisplay) \r\n        return \"\";\r\n\r\n    let iconState = \"\";\r\n    let txtTitle=\"\";\r\n    if (playerIte.state == null) {\r\n        iconState = '';\r\n    } else if (playerIte.state == \"racing\" && playerIte.speed == 0 && playerIte.twa != 0) {\r\n        iconState = '<span style=\"color:Red;\">&#x2B24;</span>';\r\n        txtTitle = \"AGROUND !\";\r\n    } else if (playerIte.state == \"racing\" && playerIte.speed != 0) {\r\n        iconState = '<span style=\"color:DodgerBlue;\">&#x2B24;</span>';\r\n        txtTitle = \"Racing\";\r\n    } else if (playerIte.state == \"arrived\") {\r\n        iconState = '<span style=\"color:Lime;\">&#x2B24;</span>';\r\n        txtTitle = \"Arrived\";\r\n    } else if (playerIte.state == \"waiting\") {\r\n        iconState = '<span style=\"color:DimGray;\">&#x2a02;</span>';\r\n        txtTitle = \"Waiting\";\r\n    } else if (playerIte.state == \"staying\") {\r\n        iconState = '<span style=\"color:DimGray;\">&#x2a02;</span>';\r\n        txtTitle = \"Staying\";\r\n    } else {\r\n        iconState = \"-\";\r\n    }\r\n\r\n    let bull = \"\";\r\n    if (getLegSelectedPlayersState(userId)) {\r\n        bull = '<span style=\"color:HotPink;font-size:16px;\"><b>&#9679;</b></span>';\r\n    }\r\n\r\n    if (playerIte.team == true) {\r\n        bull += '<span style=\"color:Red;font-size:16px;\"><b>&#9679;</b></span>';\r\n    }\r\n    if (playerIte.followed == true || playerIte.isFollowed == true) {\r\n        bull += '<span style=\"color:LimeGreen;font-size:16px;\"><b>&#9679</b></span>';\r\n    } else if (playerIte.type == \"real\") {\r\n        bull = '<span style=\"color:Chocolate;font-size:16px;\"><b>&#9679;</b></span>';\r\n    } else {\r\n        bull += '<span style=\"color:LightGrey;font-size:16px;\"><b>&#9679;</b></span>';\r\n    }\r\n    \r\n    if ( playerIte.type == \"top\") {\r\n        bull += '<span style=\"color:GoldenRod;font-size:16px;\"><b>&#9679;</b></span>';\r\n    }\r\n    if ( playerIte.type == \"certified\") {\r\n        bull += '<span style=\"color:DodgerBlue;font-size:16px;\"><b>&#9679;</b></span>';\r\n    }\r\n    if ( playerIte.type == \"sponsor\") {\r\n        bull += '<span style=\"color:DarkSlateBlue;font-size:16px;\"><b>&#9679;</b></span>';\r\n    }\r\n    \r\n    if (userId == connectedPlayerId) {\r\n        bull = '<span>&#11088</span>';\r\n    }\r\n\r\n    const teamName = playerFleetInfos.team?.id?playerFleetInfos.team.name:\"\";\r\n\r\n    const xfactorStyle = iteDash?getxFactorStyle(playerIte):\"\";\r\n    let xfactorTxt = \"-\";\r\n    if(iteDash) {\r\n        xfactorTxt = roundTo(iteDash.xfactor, 4);\r\n        if(iteDash.sailCoverage != 0 && iteDash.xplained) {\r\n            xfactorTxt += \" \" + iteDash.sailCoverage +\"%\";\r\n        }\r\n    }\r\n    const isTWAMode = playerIte.isRegulated;\r\n    let lock = \"\";\r\n    if(isTWAMode == false)\r\n        lock = \"<span title='TWA Unlocked' class='cursorHelp'>&#x25EF;</span>\";\r\n    else if(isTWAMode == true)\r\n        lock =  \"<span title='TWA Locked' class='cursorHelp'>&#x24B6;</span>\";\r\n    \r\n    const twaFG = 'style=\"color: ' + ((playerIte.twa < 0) ? \"red\" : \"green\") + ';\"'\r\n\r\n    const hdgFG = isTWAMode ? (darkTheme?\"white\":\"black\") : (darkTheme?\"darkcyan\":\"blue\");\r\n    const hdgBold = isTWAMode ? \"font-weight: normal;\" : \"font-weight: bold;\";\r\n\r\n    const {optionsTxt,optionsTitle,optionsStyle,foilsType} = drawOptions(playerFleetInfos.options);\r\n\r\n    let routerIcon = '&nbsp;';\r\n    if(userPrefs.router.sel = \"zezo\")\r\n        if(raceInfo.zezoUrl) routerIcon = '<span id=\"rt:' + userId + '\">&#x2388;</span>';\r\n    else routerIcon = '<span id=\"vrz:' + userId + '\">&#x262F;</span>';\r\n    \r\n    const nameClass = (userId == connectedPlayerId)?'highlightMe':\"\";\r\n    const categoryIdx = category.indexOf(playerIte.type);\r\n    const nameStyle = (userId == connectedPlayerId)?\"color: #b86dff; font-weight: bold; \"\r\n                    :(darkTheme?categoryStyleDark[categoryIdx]:categoryStyle[categoryIdx]);\r\n    const autoSail = (playerIte.sail > 10 ? \"<span title='Auto Sails' class='cursorHelp'>&#x24B6;</span>\" : \"\")\r\n   \r\n    const name = (playerIte.type == \"sponsor\")?\r\n                    (playerIte.branding?.name?(playerFleetInfos.info.name + \"(\" + playerIte.branding.name + \")\"):playerFleetInfos.info.name):playerFleetInfos.info.name;\r\n    \r\n    const sailStyle = sailColors[playerIte.sail];\r\n    const sailName = sailNames[playerIte.sail%10] || \"-\";\r\n    const foils = iteDash?.realFoilFactor==null?(foilsType?\"no\":\"?\"):(roundTo(iteDash.realFoilFactor,1)+\"%\")\r\n    \r\n\r\n    return '<tr class=\"' + nameClass + ' hovred\" id=\"ui:' + userId + '\">'\r\n        + '<td class=\"tdc\">' + routerIcon + '</td>'\r\n        + gentd(\"Time\",\"\",null, formatTime(playerIte.dateIte, 1))\r\n        + '<td class=\"Skipper\" style=\"' + nameStyle + '\"><div class=\"bull\">' + bull + \"</div> \" + name + '</td>'\r\n        + gentd(\"Team\",\"\",null, teamName )\r\n        + gentd(\"Rank\",\"\",null, (playerIte.rank ? playerIte.rank : \"-\"))\r\n        + ((raceInfo.type !== \"record\")?gentd(\"RaceTime\",\"\",null, (iteDash.raceTime ? formatDHMS(iteDash.raceTime) : \"-\")):\"\")\r\n        + gentd(\"DTU\",\"\",null, (iteDash.DTU ? roundTo(iteDash.DTU, 3) : '-') )\r\n        + gentd(\"DTF\",\"\",null, ((iteDash.dtf==iteDash.dtfC)?\"(\" + roundTo(iteDash.dtfC,3) + \")\":roundTo(iteDash.dtf,3)) )\r\n        + gentd(\"TWD\",\"\",null, roundTo(playerIte.twd?playerIte.twd:iteDash.twd, 3) )\r\n        + gentd(\"TWS\",\"\",null, roundTo(playerIte.tws, 3) )\r\n        + gentd(\"TWA\", twaFG,null, roundTo(Math.abs(playerIte.twa), 3) )\r\n        + gentd(\"TWAIcon\", 'style=\"color:grey; align:center; text-align:center;\"', null, lock)\r\n        + gentd(\"HDG\", 'style=\"color:' + hdgFG + '\";\"' + hdgBold ,null, roundTo(playerIte.hdg, 3) )\r\n        + gentd(\"Speed\",\"\",null, roundTo(playerIte.speed, 3) )\r\n        + gentd(\"VMG\",\"\",null, roundTo(iteDash.vmg, 3))\r\n    //                        + Util.gentd(\"Sail\",\"\",null, '<span ' + bi.sailStyle + '>&#x25e2&#x25e3  </span>' + bi.sail )\r\n        + gentd(\"Sail\",\"\",null, '<span ' + sailStyle + '>&#x25e2&#x25e3  </span>' + sailName )\r\n        + gentd(\"SailIcon\", 'style=\"color:grey; align:center; text-align:center;\"', null, autoSail)\r\n        + gentd(\"Factor\", xfactorStyle,null, xfactorTxt )\r\n        + gentd(\"Foils\", \"\", null, foils)\r\n        + recordRaceFields(raceInfo, playerIte)\r\n        + gentd(\"Position\",\"\",null, (playerIte.pos ? formatPosition(playerIte.pos.lat, playerIte.pos.lon) : \"-\") )\r\n        + gentd(\"Options\",optionsStyle,optionsTitle, optionsTxt)\r\n        + gentd(\"State\", \"\", txtTitle, iconState)\r\n        + gentd(\"Remove\", \"\", null, (getLegSelectedPlayersState(userId) && userId != connectedPlayerId ? '<span class=\"removeSelectedBoat\" data-id=\"' + userId + '\" title=\"Remove this boat: ' + name + '\">‚ùå</span>' : \"\"))\r\n        + '</tr>';\r\n}\r\n\r\nfunction recordRaceFields (raceInfo, playerIte) {\r\n    const userPrefs = getUserPrefs();\r\n    if (raceInfo.type === \"record\") {\r\n        const localTimes = userPrefs.global.localTime;\r\n        if (playerIte.state === \"racing\" && playerIte.distanceToEnd) {\r\n            let t ;\r\n            if(iteDash.eRT) t = '<td class=\"eRT\" title= \"End : ' + formatShortDate(iteDash.eRT,undefined,localTimes) + '\">' + formatDHMS(iteDash.eRT, 2) + '</td>';\r\n            else t = '<td class=\"eRT\" title= \"End : unknow\"></td>';\r\n            return '<td class=\"eRT\" title= \"Start : ' + formatShortDate(playerIte.startDate,undefined,localTimes) + '\">' + formatDHMS(raceTime) + '</td>'\r\n                + t\r\n                + '<td class=\"avg\">' + roundTo(iteDash.avgSpeed, 2) + '</td>';\r\n        } else {\r\n            if(playerIte.startDate && playerIte.state === \"racing\" && playerIte.startDate!=\"-\") {\r\n                //r.dtf can replace \r\n                let retVal = '<td class=\"eRT\" title= \"Start : ' + formatShortDate(playerIte.startDate,undefined,localTimes) + '\">' + formatDHMS(raceTime) + '</td>';\r\n        \r\n                /* if(r.dtf)\r\n                {\r\n                    var distanceFromStart = calcCrow(r.pos, {lat: race.legdata.start.lat, lon:race.legdata.start.lon});\r\n                    var estimatedSpeed = distanceFromStart / (raceTime / 3600000);\r\n                    var eTtF = (r.dtf / estimatedSpeed) * 3600000;\r\n                    r.avgSpeed = estimatedSpeed;\r\n                    r.eRT = raceTime + eTtF;\r\n                    retVal += '<td class=\"eRT\" title= \"End : ' + Util.formatShortDate(r.eRT,undefined,cbLocalTime.checked) + '\">' + Util.formatDHMS(r.eRT, 2) + '</td>'\r\n                    + '<td class=\"avg\">' + Util.roundTo(r.avgSpeed, 2) + '</td>';                            \r\n                } else*/\r\n                    retVal += '<td class=\"eRT\"> - </td>'\r\n                        + '<td class=\"avg\"> - </td>'; \r\n                return retVal;\r\n            }\r\n            else\r\n                return '<td class=\"eRT\"> - </td>'                                                                    // Modif Class\r\n                + '<td class=\"eRT\"> - </td>'\r\n                + '<td class=\"avg\"> - </td>';\r\n        }\r\n    } else {\r\n        return \"\";\r\n    }\r\n}\r\n\r\nfunction drawOptions(playerOptions) {\r\n    const userPrefs = getUserPrefs();\r\n    let optionsTxt = \"\";\r\n    let optionsStyle = \"\";\r\n    let optionsTitle = \"\";\r\n    let foilsType = false;\r\n\r\n    if(!playerOptions)\r\n        return {optionsTxt:\"\",optionsTitle:\"\",optionsStyle:\"\",foilsType:false};\r\n\r\n    let optSail = \"\";\r\n    let optPerf = \"\";\r\n    if(playerOptions.options) \r\n    {\r\n        const pOptions = playerOptions.options;\r\n        \r\n        if(pOptions.light || pOptions.reach || pOptions.heavy)\r\n            optSail = \"[\";\r\n        if(pOptions.reach) optSail += \"reach,\";\r\n        if(pOptions.light) optSail += \"light,\";\r\n        if(pOptions.heavy) optSail += \"heavy,\";\r\n\r\n        if(pOptions.foil || pOptions.winch || pOptions.hull\r\n            || pOptions.comfortLoungePug || pOptions.magicFurler || pOptions.vrtexJacket\r\n        )\r\n            optPerf = \"[\";\r\n        if(pOptions.winch) optPerf += \"winch,\";\r\n        if(pOptions.foil) {optPerf += \"foil,\";foilsType = true;}\r\n        if(pOptions.hull) optPerf += \"hull,\";\r\n        if(pOptions.comfortLoungePug) optPerf += \"comfortLoungePug,\";\r\n        if(pOptions.magicFurler) optPerf += \"magicFurler,\";\r\n        if(pOptions.vrtexJacket) optPerf += \"vrtexJacket,\";\r\n\r\n    } else if(playerOptions.guessOptions  && playerOptions.guessOptions!= 0)\r\n    {\r\n        const pOptions = playerOptions.guessOptions;\r\n        if(isBitSet(pOptions,guessOptionBits[\"reach\"])\r\n        || isBitSet(pOptions,guessOptionBits[\"light\"])\r\n        || isBitSet(pOptions,guessOptionBits[\"heavy\"]))\r\n            optSail =\"[\";\r\n        \r\n        if(isBitSet(pOptions,guessOptionBits[\"reach\"])) optSail += \"reach,\";\r\n        if(isBitSet(pOptions,guessOptionBits[\"light\"])) optSail += \"light,\";\r\n        if(isBitSet(pOptions,guessOptionBits[\"heavy\"])) optSail += \"heavy,\";\r\n\r\n        if((isBitSet(pOptions,guessOptionBits[\"winchDetected\"]) && isBitSet(pOptions,guessOptionBits[\"winch\"]))\r\n        || (isBitSet(pOptions,guessOptionBits[\"foilDetected\"]) && isBitSet(pOptions,guessOptionBits[\"foil\"]))\r\n        || (isBitSet(pOptions,guessOptionBits[\"hullDetected\"]) && isBitSet(pOptions,guessOptionBits[\"hull\"])))\r\n            optPerf =\"[\";\r\n\r\n        if(isBitSet(pOptions,guessOptionBits[\"winchDetected\"]) && isBitSet(pOptions,guessOptionBits[\"winch\"]))\r\n            optPerf += \"winch,\";\r\n        if(isBitSet(pOptions,guessOptionBits[\"foilDetected\"]) && isBitSet(pOptions,guessOptionBits[\"foil\"]))\r\n        {    optPerf += \"foil,\";foilsType = true;}\r\n        if(isBitSet(pOptions,guessOptionBits[\"hullDetected\"]) && isBitSet(pOptions,guessOptionBits[\"hull\"]))\r\n            optPerf += \"hull,\";\r\n        optionsStyle = 'style=\"font-style: italic;\"';\r\n\r\n    }\r\n    \r\n    if(optSail.length !=0) \r\n    {\r\n        optSail = optSail.substring(0,optSail.length-1);\r\n        optSail += \"]\";\r\n    }\r\n    if(optPerf.length !=0) \r\n    {\r\n        optPerf = optPerf.substring(0,optPerf.length-1);\r\n        optPerf += \"]\";\r\n    }\r\n\r\n    if(optSail.length !=0 && optPerf.length !=0)\r\n        optionsTxt = optSail + \" \" + optPerf ;\r\n    else if(optSail.length !=0 && optPerf.length ==0)\r\n        optionsTxt = optSail;\r\n    else if(optSail.length ==0 && optPerf.length !=0)\r\n        optionsTxt = optPerf ;\r\n    else if(!playerOptions.guessOptions  || playerOptions.guessOptions == 0)\r\n        optionsTxt = \"?\";\r\n\r\n    optionsTitle = optionsTxt;\r\n    if(userPrefs.fleet.shortOption)\r\n    {\r\n        optionsTxt = optionsTxt.replace(\"All Options\",\"AO\");\r\n        optionsTxt = optionsTxt.replace(\"Full Pack\",\"FP\");\r\n        optionsTxt = optionsTxt.replace(\"reach\",\"R\");\r\n        optionsTxt = optionsTxt.replace(\"light\",\"L\");\r\n        optionsTxt = optionsTxt.replace(\"heavy\",\"H\");\r\n        optionsTxt = optionsTxt.replace(\"winch\",\"W\");\r\n        optionsTxt = optionsTxt.replace(\"foil\",\"F\");\r\n        optionsTxt = optionsTxt.replace(\"hull\",\"h\");\r\n        optionsTxt = optionsTxt.replace(\"magicFurler\",\"M\");\r\n        optionsTxt = optionsTxt.replace(\"vrtexJacket\",\"J\");\r\n        optionsTxt = optionsTxt.replace(\"comfortLoungePug\",\"C\");\r\n    }\r\n    return {optionsTxt:optionsTxt,optionsTitle:optionsTitle,optionsStyle:optionsStyle,foilsType : foilsType};\r\n\r\n}\r\n\r\nfunction addEventListenersToRemoveSelectedBoatButtons() {\r\n    document.querySelectorAll('.removeSelectedBoat').forEach(function(e) {\r\n        e.addEventListener('click', function() {\r\n            const boatId = this.getAttribute('data-id');\r\n            setLegSelectedPlayers(boatId,false);\r\n            buildRaceFleetHtml()\r\n        });\r\n    });\r\n}\r\n\r\nfunction addEventListenersToSelectedLine() {\r\n    document.querySelectorAll(\"tr.hovred\").forEach(function(row) {\r\n        row.addEventListener(\"click\", function() {\r\n            row.classList.add(\"selectedLine\");\r\n            let siblings = Array.from(row.parentNode.children).filter(function(child) {\r\n                return child !== row && child.classList.contains(\"hovred\");\r\n            });\r\n            siblings.forEach(function(sibling) {\r\n                sibling.classList.remove(\"selectedLine\");\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nfunction addEventListenersFleetSort() {\r\n    const friendList = document.getElementById(\"friendList\");\r\n    if (!friendList) return;\r\n\r\n    const header = friendList.querySelector(\"thead\");\r\n    if (!header) return;\r\n\r\n    header.addEventListener(\"click\", (event) => {\r\n        const th = event.target.closest(\"th\");\r\n        if (!th || !th.id) return;\r\n\r\n        const sortKey = FLEET_SORT_KEY_BY_TH_ID[th.id];\r\n        if (!sortKey) {\r\n            return;\r\n        }\r\n\r\n        if (getSortField() === sortKey) {\r\n            setSortOrder(!getSortOrder());\r\n        } else {\r\n            setSortField(sortKey);\r\n            setSortOrder(true);\r\n        }\r\n        buildRaceFleetHtml();\r\n    });\r\n}\r\n\r\n\r\n","import {DateUTC,formatPosition, getRankingCategory\r\n} from './common.js';\r\n\r\nimport {getRaceInfo,getLegPlayerInfos} from '../app/memoData.js'\r\n\r\nimport {getUserPrefs, saveUserPrefs} from \"../../common/userPrefs.js\"\r\nimport {creditsMaxAwardedByPriceLevel} from './constant.js'\r\n/***** helpers DOM tr√®s compacts *****/\r\nfunction h(tag, props = {}, ...children) {\r\n  const el = document.createElement(tag);\r\n  // props: { class, dataset, style, on: {click: fn}, ...attributes }\r\n  for (const [k, v] of Object.entries(props || {})) {\r\n    if (k === 'class') el.className = v;\r\n    else if (k === 'dataset') Object.assign(el.dataset, v);\r\n    else if (k === 'style') Object.assign(el.style, v);\r\n    else if (k === 'on') for (const [ev, fn] of Object.entries(v)) el.addEventListener(ev, fn);\r\n    else if (v !== undefined && v !== null) el.setAttribute(k, v);\r\n  }\r\n  for (const c of children.flat()) {\r\n    el.append(c instanceof Node ? c : document.createTextNode(c ?? ''));\r\n  }\r\n  return el;\r\n}\r\nconst frag = (...nodes) => nodes.reduce((f, n) => (f.append(n), f), document.createDocumentFragment());\r\n\r\n\r\n\r\n/***** petites aides *****/\r\nconst optionKeys = [\r\n  ['foil','Foils'],\r\n  ['winch','Winch'],\r\n  ['hull','Hull'],\r\n  ['light','Light'],\r\n  ['reach','Reach'],\r\n  ['heavy','Heavy'],\r\n  ['radio','Radio'],\r\n  ['magicFurler','Magic Furler'],\r\n  ['comfortLoungePug','Comfort Lounge'],\r\n  ['vrtexJacket','VRTex Jacket'],\r\n];\r\n\r\nfunction isTaken(playerOptions, key) {\r\n    return !!(playerOptions && playerOptions[key] === true);\r\n}\r\nfunction totalOptionCredits(raceInfo,playerOptions) {\r\n  let sum = 0;\r\n  if (!raceInfo?.optionPrices) return sum;\r\n  for (const [k] of optionKeys) if (isTaken(playerOptions, k)) sum += raceInfo.optionPrices[k] || 0;\r\n  return sum;\r\n}\r\n\r\n/***** blocs UI *****/\r\nfunction card(title, bodyNodes, {icon=null} = {}) {\r\n  return h('section', {class:'card'},\r\n    h('div', {class:'card-header'},\r\n      icon ? h('span', {class:'badge'}, icon) : null,\r\n      h('h3', null, title)\r\n    ),\r\n    h('div', {class:'card-body'}, ...(Array.isArray(bodyNodes) ? bodyNodes : [bodyNodes]))\r\n  );\r\n}\r\n\r\nfunction tableModern({head=[], rows=[]}) {\r\n  const thead = h('thead', null, h('tr', null, ...head.map(t => h('th', null, t))));\r\n  const tbody = h('tbody', null, ...rows.map(r => h('tr', null, ...r.map((c,i) => h('td', {class: i.className || ''}, c)))));\r\n  return h('div', {class:'table-wrap'}, h('table', {class:'table-modern'}, thead, tbody));\r\n}\r\n\r\n/***** sections *****/\r\nfunction viewIdentity(raceInfo,playerOptions) {\r\n  const rid = raceInfo.raceId+\"_\"+raceInfo.legNum;\r\n  const img = h('img', {src:`https://static.virtualregatta.com/offshore/leg/${rid}.jpg`, style: { height: '48px', borderRadius: '8px' }});\r\n  const badge = h('span', {class:'badge'}, img, 'Race');\r\n  const grid = h('div', {class:'kv'},\r\n    h('div', {class:'k'}, 'Race Name (Id)'), h('div', {class:'v'}, `${raceInfo.legName} (${rid})`),\r\n    h('div', {class:'k'}, 'Boat Name'), h('div', {class:'v'}, raceInfo.boatName ?? '-'),\r\n    h('div', {class:'k'}, 'Wind Model'), h('div', {class:'v'}, `GFS ${(raceInfo.fineWinds ? '0.25' : '1.0')}¬∞`),\r\n    h('div', {class:'k'}, 'VSR Level'), h('div', {class:'v'}, `VSR${raceInfo.vsrLevel}`),\r\n    h('div', {class:'k'}, 'Price'), h('div', {class:'v'}, `Cat. ${raceInfo.priceLevel}`),\r\n    h('div', {class:'k'}, 'Category'), h('div', {class:'v'}, getRankingCategory(playerOptions?.options)),\r\n  );\r\n  return card('Race Details', [h('div', {class:'chips'}, badge), grid]);\r\n}\r\n\r\nfunction viewCredits(raceInfo,playerIte) {\r\n\r\n  const awarded = (playerIte?.rank > 0)\r\n    ? Math.round(creditsMaxAwardedByPriceLevel[raceInfo.priceLevel-1] / (Math.pow(playerIte.rank, 0.4)))\r\n    : '-';\r\n\r\n  const head = ['Game Credits','Free Credits','Current Race Credits (Total Options)','Gains',\r\n    ...optionKeys.map(([,label]) => label)\r\n  ];\r\n  const takenTotal = totalOptionCredits(raceInfo,playerIte?.options?.options);\r\n  const takenCells = optionKeys.map(([k]) => {\r\n    const takenStyle = isTaken(playerIte?.options?.options,k) ? {outline:'2px solid #25d366'} : {};\r\n    return h('span', {class: 'chip', style: takenStyle}, String(raceInfo?.optionPrices[k] ?? '-'))\r\n  });\r\n  const rows = [[\r\n    String(playerIte?.info?.credits ?? '-'),\r\n    String(raceInfo.freeCredits ?? '-'),\r\n    `${(playerIte?.info?.credits || playerIte?.info?.credits===0) ? playerIte.info.credits : '???'}  `,\r\n    String(awarded),\r\n    ...takenCells\r\n  ]];\r\n\r\n  // insert the (-total) info visuellement √† c√¥t√©\r\n  rows[0][2] = frag(\r\n    h('span', null, rows[0][2]),\r\n    ' ',\r\n    h('span', {class:'chip', style:{borderColor:'tomato', color:'tomato'}}, `(-${takenTotal})`)\r\n  );\r\n\r\n  return card('Credits (Option √©quip√©e)', tableModern({head, rows}));\r\n}\r\n\r\nfunction viewStages(raceInfo, playerIte) {\r\n  const userPrefs = getUserPrefs();\r\n  const head = ['Type','Name','Id','Position','Position2','Status'];\r\n\r\n  const rows = [];\r\n\r\n  // Start\r\n  rows.push([\r\n    'üö© Start',\r\n    raceInfo.start?.name ?? '-',\r\n    'Start',\r\n    formatPosition(raceInfo.start.lat, raceInfo.start.lon),!!\r\n    ' - ',\r\n    frag('Date : ', h('span',{class:'pill pill--muted'}, DateUTC(raceInfo.start.date,1,userPrefs.global.localTime ?3:4)))\r\n  ]);\r\n\r\n  // Checkpoints\r\n  if (Array.isArray(raceInfo.checkpoints)) {\r\n    for (const cp of raceInfo.checkpoints) {\r\n      let cpName = (cp.display && cp.display !== 'none') ? cp.display : 'Invisible';\r\n      cpName = cpName.charAt(0).toUpperCase() + cpName.slice(1);\r\n      if (cpName === 'Buoy') cpName = 'üè≥Ô∏è ' + cpName;\r\n\r\n      const passed = (playerIte?.ites[0]?.gateGroupCounters && playerIte.ites[0].gateGroupCounters[cp.group - 1]) ? h('span',{class:'pill pill--ok'},'Passed') : ' - ';\r\n\r\n      rows.push([\r\n        cpName,\r\n        cp.name ?? '',\r\n        `${cp.group}.${cp.id}`,\r\n        formatPosition(cp.start.lat, cp.start.lon),\r\n        (cp.end ? formatPosition(cp.end.lat, cp.end.lon) : ' - '),\r\n        passed\r\n      ]);\r\n    }\r\n  }\r\n\r\n  // End\r\n  rows.push([\r\n    'üèÅ End',\r\n    raceInfo.end?.name ?? '-',\r\n    'End',\r\n    formatPosition(raceInfo.end.lat, raceInfo.end.lon),\r\n    (raceInfo.end?.radius ? `Radius : ${raceInfo.end.radius} mn` : ' - '),\r\n    frag('Date : ', h('span',{class:'pill pill--muted'}, DateUTC(raceInfo.end.date,1,userPrefs.global.localTime ?3:4)))\r\n  ]);\r\n\r\n  return card('Race Stages', tableModern({head, rows}));\r\n}\r\n\r\nfunction viewIceLimits(raceInfo) {\r\n  const south = raceInfo?.ice_limits?.south;\r\n  if (!Array.isArray(south) || south.length === 0) return null;\r\n\r\n  // ignore dummy pattern (m√™me logique que ton code)\r\n  const isDummy = (south.length === 5\r\n    && south[0].lat === -90 && south[0].lon === -180\r\n    && south[2].lat === -90 && south[2].lon === 0\r\n    && south[4].lat === -90 && south[4].lon === 180);\r\n  if (isDummy) return null;\r\n\r\n  const head = ['Section', 'Position', 'Position2'];\r\n  const rows = [];\r\n\r\n  for (let i=1; i<south.length; i++) {\r\n    rows.push([\r\n      `Section ${i+1}`,\r\n      formatPosition(south[i-1].lat, south[i-1].lon),\r\n      formatPosition(south[i].lat, south[i].lon),\r\n    ]);\r\n  }\r\n\r\n  return card('Limites des glaces', tableModern({head, rows}));\r\n}\r\n\r\nfunction viewRestrictedZones(raceInfo) {\r\n  const rz = raceInfo?.restrictedZones;\r\n  if (!Array.isArray(rz) || rz.length === 0) return null;\r\n\r\n  // transforme en lignes: une ligne par coordonn√©e, nom r√©p√©t√© par rowspan visuel (on s‚Äôaffranchit du rowspan pour responsive)\r\n  const head = ['Nom','Position'];\r\n  const rows = [];\r\n  for (const z of rz) {\r\n    const name = z.name ?? '‚Äî';\r\n    for (const p of (z.vertices || [])) {\r\n      rows.push([name, formatPosition(p.lat, p.lon)]);\r\n    }\r\n  }\r\n  return card('Zones interdites', tableModern({head, rows}));\r\n}\r\n\r\n/***** rendu principal *****/\r\nexport function buildRaceBookHtml() {\r\n    const host = document.getElementById('raceBook');\r\n    if (!host) return;\r\n    const raceInfo = getRaceInfo();\r\n    const playerIte = getLegPlayerInfos();\r\n\r\n\r\n    if(!raceInfo || raceInfo?.length == 0 ) {\r\n        host.replaceChildren(\r\n          card('Race Details', h('div', {class:'centered'}, 'No data available. Please enter a race.'))\r\n        );\r\n        return;\r\n    }\r\n    const identity = viewIdentity(raceInfo,playerIte?.options?.options);\r\n    const credits  = viewCredits(raceInfo,playerIte);\r\n    const stages   = viewStages(raceInfo,playerIte);\r\n    const ice      = viewIceLimits(raceInfo,playerIte);\r\n    const rz       = viewRestrictedZones(raceInfo,playerIte);\r\n    // grille principale : identit√© + cr√©dits c√¥te √† c√¥te quand large\r\n    const gridTop = h('div', {class:'rb-grid'}, identity, credits);\r\n\r\n    host.replaceChildren(\r\n    gridTop,\r\n    stages,\r\n    ice || document.createComment('no ice limits'),\r\n    rz  || document.createComment('no restricted zones'),\r\n    );\r\n}\r\n","\r\n\r\nfunction ensureLayerControlClickable(ctrl) {\r\n  const c = ctrl && ctrl._container;\r\n  if (!c) return;\r\n  c.style.zIndex = '10050';\r\n  c.style.pointerEvents = 'auto';\r\n\r\n  if (!document.getElementById('leaflet-layercontrol-pointer-patch')) {\r\n    const style = document.createElement('style');\r\n    style.id = 'leaflet-layercontrol-pointer-patch';\r\n    style.textContent = `\r\n      .leaflet-top.leaflet-right { pointer-events: none; }\r\n      .leaflet-top.leaflet-right .leaflet-control { pointer-events: auto; }\r\n      .leaflet-control-layers { z-index: 10050 !important; }\r\n    `;\r\n    document.head.appendChild(style);\r\n  }\r\n\r\n  c.addEventListener('click', (ev) => {\r\n    const label = ev.target.closest('label');\r\n    if (!label) return;\r\n    const input = label.querySelector('input.leaflet-control-layers-selector');\r\n    if (!input) return;\r\n    if (!input.checked) {\r\n      input.checked = true;\r\n      if (typeof ctrl._onInputClick === 'function') {\r\n        ctrl._onInputClick();\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nwindow.POLAR = window.POLAR || {\r\n  enabled: false,\r\n  crs: null,\r\n  wmsLayer: null,\r\n};\r\n\r\nfunction hasProj4Leaflet() {\r\n  return (\r\n    typeof window !== 'undefined' &&\r\n    window.L &&\r\n    L.Proj &&                              \r\n    typeof window.proj4 === 'function'     \r\n  );\r\n}\r\n\r\nexport function buildPolarCRS() {\r\n  if (!hasProj4Leaflet()) return null;\r\n  return new L.Proj.CRS(\r\n    'EPSG:3413',\r\n    '+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs',\r\n    {\r\n      resolutions: [8192, 4096, 2048, 1024, 512, 256, 128, 64, 32, 16, 8, 4, 2, 1],\r\n      origin: [-4194304, 4194304],\r\n      bounds: L.bounds([-4194304, -4194304], [4194304, 4194304]),\r\n    }\r\n  );\r\n}\r\n\r\nexport function createArcticWMS() {\r\n  if (!hasProj4Leaflet()) return null;\r\n  if (!POLAR.crs) POLAR.crs = buildPolarCRS();\r\n  return L.tileLayer.wms('https://gibs.earthdata.nasa.gov/wms/epsg3413/best/wms.cgi', {\r\n    layers: 'BlueMarble_ShadedRelief_Bathymetry',\r\n    format: 'image/png',\r\n    transparent: false,\r\n    version: '1.1.1',\r\n    crs: POLAR.crs,\r\n    attribution: '&copy; NASA GIBS',\r\n  });\r\n}\r\nlet mercatorDragHandler = null;\r\nlet mercatorDragHandlerMapId = null;\r\n\r\nexport function applyBoundsForCurrentMode(map) {\r\n  if (\r\n    mercatorDragHandler &&\r\n    mercatorDragHandlerMapId &&\r\n    map &&\r\n    map._leaflet_id === mercatorDragHandlerMapId\r\n  ) {\r\n    map.off('drag', mercatorDragHandler);\r\n    mercatorDragHandler = null;\r\n    mercatorDragHandlerMapId = null;\r\n  }\r\n\r\n  if (!POLAR.enabled) {\r\n    const bounds = [\r\n      [-89.98155760646617, -270],\r\n      [ 89.99346179538875,  270]\r\n    ];\r\n    map.setMaxBounds(bounds);\r\n    mercatorDragHandler = function () {\r\n      map.panInsideBounds(bounds, { animate: false });\r\n    };\r\n    map.on('drag', mercatorDragHandler);\r\n    mercatorDragHandlerMapId = map._leaflet_id;\r\n\r\n  } else {\r\n    map.setMaxBounds(null);\r\n  }\r\n}\r\n\r\nexport function computeComfortView(isArctic, prevCenter, prevZoom) {\r\n  const prevLat = (prevCenter && Number.isFinite(prevCenter.lat)) ? prevCenter.lat : 0;\r\n  const prevLng = (prevCenter && Number.isFinite(prevCenter.lng)) ? prevCenter.lng : 0;\r\n\r\n  const normLng = ((prevLng + 540) % 360) - 180;\r\n\r\n  if (isArctic) {\r\n    const THRESHOLD_NORTH = 60;\r\n    const alreadyInArctic = prevLat >= THRESHOLD_NORTH;\r\n    const targetLat = alreadyInArctic ? prevLat : 85;\r\n    const targetLng = normLng;\r\n    const targetZoom = alreadyInArctic ? (prevZoom ?? 3) : 3;\r\n\r\n    return { center: L.latLng(targetLat, targetLng), zoom: targetZoom };\r\n  }\r\n  const clampedLat = Math.max(-85, Math.min(85, prevLat));\r\n  return { center: L.latLng(clampedLat, normLng), zoom: prevZoom ?? 3 };\r\n}\r\n\r\n","\r\nexport function initButtonToCenterViewMap(lat, lon, map) {\r\n    let recenterButton = document.querySelector(\"#lMap\" + \" #recenterButton\");\r\n    if (recenterButton) {\r\n        updateCoordinatesToCenterViewMap(lat, lon);\r\n    }\r\n    else {\r\n        // HTML\r\n        let buttonHTML = `\r\n        <div id=\"lMapControls\" class=\"leaflet-control-custom leaflet-control leaflet-bar\">\r\n            <a id=\"recenterButton\" title=\"Centrer\" href=\"#\">üéØ</a>\r\n        </div>`;\r\n        let mapContainer = document.querySelector(\"#lMap\" +  \" .leaflet-top.leaflet-left\");\r\n        mapContainer.insertAdjacentHTML('afterbegin', buttonHTML);\r\n        recenterButton = document.querySelector(\"#lMap\" +  \" #recenterButton\");\r\n        recenterButton.setAttribute('data-lat', lat);\r\n        recenterButton.setAttribute('data-lon', lon);\r\n        // Control\r\n        recenterButton.addEventListener('click', function (e) {\r\n            e.preventDefault();\r\n            let defaultZoom = 10;\r\n            if (map.getZoom() >= defaultZoom) defaultZoom = map.getZoom();\r\n            let lat = parseFloat(recenterButton.getAttribute('data-lat'));\r\n            let lon = parseFloat(recenterButton.getAttribute('data-lon'));\r\n            map.setView([lat, lon], defaultZoom);\r\n        });\r\n    }\r\n}\r\nfunction updateCoordinatesToCenterViewMap(lat, lon) {\r\n    let recenterButton = document.querySelector(\"#lMap\" + \" #recenterButton\");\r\n    if (recenterButton) {\r\n        recenterButton.setAttribute('data-lat', lat);\r\n        recenterButton.setAttribute('data-lon', lon);\r\n    }\r\n}\r\n\r\nexport function enableCoordinateCopyingWithShortcut() {\r\n    const coordinatesDisplay = document.querySelector(\".leaflet-control-coordinates\");\r\n\r\n    if (coordinatesDisplay) {\r\n        document.addEventListener(\"keydown\", function (event) {\r\n            const isCtrlOrCmd = event.ctrlKey || event.metaKey; // Ctrl (Windows) ou Cmd (Mac)\r\n            const isKeyC = event.key === \"b\" || event.key === \"B\"; // \"b/B\" on keyboard\r\n\r\n            if (isCtrlOrCmd && isKeyC) {\r\n                event.preventDefault();\r\n                let coordinatesText = coordinatesDisplay.innerText.trim();\r\n                coordinatesText = coordinatesText.replace(/\\s+/g, '').replace(/([NS])(?=\\d)/, '$1 ');\r\n                coordinatesText && navigator.clipboard.writeText(coordinatesText).catch(console.error);\r\n            }\r\n        });\r\n    }\r\n}\r\n","\r\nexport const greenRRIcon = L.icon({\r\n    iconUrl: '../img/greenIcon.png',\r\n    shadowUrl: '../img/RRIconShadowNok.png',\r\n    iconSize:     [20, 35], // size of the icon\r\n    shadowSize:   [53, 51], // size of the shadow\r\n    iconAnchor:   [10, 35], // point of the icon which will correspond to marker's location\r\n    shadowAnchor: [27, 45],  // the same for the shadow\r\n    popupAnchor:  [0, -42] // point from which the popup should open relative to the iconAnchor\r\n});\r\nexport const redRLIcon = L.icon({\r\n    iconUrl: '../img/redIcon.png',\r\n    shadowUrl: '../img/RLIconShadowNok.png',\r\n    iconSize:     [20, 35],\r\n    shadowSize:   [53, 51],\r\n    iconAnchor:   [10, 35],\r\n    shadowAnchor: [27, 45],\r\n    popupAnchor:  [0, -42]\r\n});\r\nexport const greenRRIconP = L.icon({\r\n    iconUrl: '../img/greenIcon.png',\r\n    shadowUrl: '../img/RRIconShadowOK.png',\r\n    iconSize:     [20, 35],\r\n    shadowSize:   [53, 51],\r\n    iconAnchor:   [10, 35],\r\n    shadowAnchor: [27, 45],\r\n    popupAnchor:  [0, -42]\r\n});\r\nexport const redRLIconP = L.icon({\r\n    iconUrl: '../img/redIcon.png',\r\n    shadowUrl: '../img/RLIconShadowOK.png',\r\n    iconSize:     [20, 35],\r\n    shadowSize:   [53, 51],\r\n    iconAnchor:   [10, 35],\r\n    shadowAnchor: [27, 45],\r\n    popupAnchor:  [0, -42]\r\n});\r\nexport const yellowRRIcon = L.icon({\r\n    iconUrl: '../img/yellowIcon.png',\r\n    shadowUrl: '../img/RRIconShadowNok.png',\r\n    iconSize:     [20, 35],\r\n    shadowSize:   [53, 51],\r\n    iconAnchor:   [10, 35],\r\n    shadowAnchor: [27, 45],\r\n    popupAnchor:  [0, -42]\r\n});\r\nexport const yellowRLIcon = L.icon({\r\n    iconUrl: '../img/yellowIcon.png',\r\n    shadowUrl: '../img/RLIconShadowNok.png',\r\n    iconSize:     [20, 35],\r\n    shadowSize:   [53, 51],\r\n    iconAnchor:   [10, 35],\r\n    shadowAnchor: [27, 45],\r\n    popupAnchor:  [0, -42]\r\n});\r\nexport const yellowRRIconP = L.icon({\r\n    iconUrl: '../img/yellowIcon.png',\r\n    shadowUrl: '../img/RRIconShadowOK.png',\r\n    iconSize:     [20, 35],\r\n    shadowSize:   [53, 51],\r\n    iconAnchor:   [10, 35],\r\n    shadowAnchor: [27, 45],\r\n    popupAnchor:  [0, -42]\r\n});\r\nexport const yellowRLIconP = L.icon({\r\n    iconUrl: '../img/yellowIcon.png',\r\n    shadowUrl: '../img/RLIconShadowOK.png',\r\n    iconSize:     [20, 35],\r\n    shadowSize:   [53, 51],\r\n    iconAnchor:   [10, 35],\r\n    shadowAnchor: [27, 45],\r\n    popupAnchor:  [0, -42]\r\n});\r\n\r\nexport function buildMarker( pos, layer, icond,title, zi, op,heading)\r\n{ \r\n    let ret = [];\r\n    for(let i=0;i<pos.length;i++)\r\n    {\r\n        if(!heading) heading=0;\r\n        if(heading == 180) heading = 179.9; //or boat icon are drawn at 0¬∞ when 180¬∞ :s\r\n        const marker1 = L.marker(pos[i],{icon:icond,rotationAngle: heading/2});\r\n        if(op) marker1.opacity = op;\r\n        if(zi)  marker1.zIndexOffset = zi;\r\n        if(title)\r\n        {\r\n    \r\n            marker1.bindPopup(title);    \r\n            marker1.on('mouseover', function(e){\r\n                e.target.bindPopup(title).openPopup();\r\n            \r\n                });        \r\n            marker1.on('mouseout', function(e){  \r\n                e.target.closePopup();\r\n            \r\n            });\r\n        }\r\n        marker1.addTo(layer);\r\n        ret.push(marker1);  \r\n    }                   \r\n    return ret;\r\n}\r\n\r\nexport function buildTextIcon(icon,iconColor,markerColor,text)\r\n{\r\n    return  L.AwesomeMarkers.icon({\r\n        icon: icon,\r\n        markerColor: markerColor,\r\n        iconColor : iconColor,\r\n        prefix: 'fa',\r\n        html: text,\r\n    });\r\n}\r\nfunction buildBoatIcon(fillColor,borderColor,opacity)\r\n{\r\n    const MARKER = encodeURIComponent(`<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\r\n    <!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\r\n    <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 14 14\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xml:space=\"preserve\" style=\"fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;\">\r\n    <path d=\"M4.784,13.635c0,0 -0.106,-2.924 0.006,-4.379c0.115,-1.502 0.318,-3.151 0.686,-4.632c0.163,-0.654 0.45,-1.623 0.755,-2.44c0.202,-0.54 0.407,-1.021 0.554,-1.352c0.038,-0.085 0.122,-0.139 0.215,-0.139c0.092,0 0.176,0.054 0.214,0.139c0.151,0.342 0.361,0.835 0.555,1.352c0.305,0.817 0.592,1.786 0.755,2.44c0.368,1.481 0.571,3.13 0.686,4.632c0.112,1.455 0.006,4.379 0.006,4.379l-4.432,0Z\" style=\"fill:` +\r\n    borderColor + `;\"/><path d=\"M5.481,12.731c0,0 -0.073,-3.048 0.003,-4.22c0.06,-0.909 0.886,-3.522 1.293,-4.764c0.03,-0.098 0.121,-0.165 0.223,-0.165c0.103,0 0.193,0.067 0.224,0.164c0.406,1.243 1.232,3.856 1.292,4.765c0.076,1.172 0.003,4.22 0.003,4.22l-3.038,0Z\" style=\"fill:`+\r\n    fillColor+`;fill-opacity:`+ opacity +`;\"/> </svg>`);   \r\n\r\n    const MARKER_ICON_URL = `data:image/svg+xml;utf8,${MARKER}`;\r\n    \r\n    return L.icon({\r\n        iconUrl: MARKER_ICON_URL,\r\n        iconSize: [24, 24],\r\n        iconAnchor: [12, 12],\r\n        popupAnchor: [0, -2],\r\n    });\r\n}\r\n\r\nexport function buildCircle( pos, layer,trackcolor,size,opacity,title)\r\n{\r\n    let ret = [];\r\n    for(let i=0;i<pos.length;i++)\r\n    {\r\n        const circleMark = L.circleMarker(pos[i],\r\n            {radius : size,\r\n            color: trackcolor,\r\n            fillColor: trackcolor,\r\n            fillOpacity: opacity\r\n        });\r\n        if(title && title != '')\r\n        {\r\n            circleMark.bindPopup(title);    \r\n            circleMark.on('mouseover', function(e){\r\n                e.target.bindPopup(title).openPopup();\r\n                });        \r\n            \r\n            circleMark.on('mouseout', function(e){  \r\n                e.target.closePopup();\r\n            \r\n            });\r\n        }\r\n        circleMark.addTo(layer);\r\n        ret.push(circleMark);      \r\n    }            \r\n    return ret;\r\n}\r\n\r\nexport function buildCircleEndRace(pos, layer, trackcolor, size)\r\n{\r\n    let ret = [];\r\n    for(let i=0;i<pos.length;i++)\r\n    {\r\n        const circleMark = L.circle(pos[i], {\r\n            color: trackcolor,\r\n            weight: 2,\r\n            fill: false,\r\n            radius: size,\r\n        });        \r\n        circleMark.addTo(layer);\r\n        ret.push(circleMark);\r\n    }            \r\n    return ret;\r\n}\r\n\r\nexport function buildTrace (tpath,layer,pointsContainer, color,weight,opacity,dashArray,dashOffset,mode=true) {\r\n\r\n    let nbTrackLine = 0;\r\n    let trackLine = [];\r\n    for(let i=0;i<tpath.length;i++)\r\n    {\r\n        let path = [];\r\n        path[0] = [];\r\n        path[1] = [];\r\n        path[2] = [];\r\n        \r\n        for(var j=0;j<tpath[i].length;j++)\r\n        {\r\n            const pos = buildPt2(tpath[i][j].lat,tpath[i][j].lng);\r\n            path[0].push(pos[0]);\r\n            path[1].push(pos[1]);\r\n            path[2].push(pos[2]);\r\n            pointsContainer.push(pos[1]);\r\n        }\r\n        for(j=0;j<path.length;j++)\r\n        {\r\n            var trackLineP;\r\n            if(mode)\r\n            {\r\n                trackLineP = L.geodesic(path[j],\r\n                    {\r\n                        color: color,\r\n                        opacity: opacity,\r\n                        weight: weight,\r\n                        wrap:false\r\n                    });\r\n            } else\r\n            {\r\n                trackLineP = L.polyline(path[j],\r\n                    {\r\n                        color: color,\r\n                        opacity: opacity,\r\n                        weight: weight,\r\n                        wrap:false\r\n                    });                \r\n            }\r\n            if(dashArray) trackLineP.options.dashArray = dashArray;\r\n            if(dashOffset) trackLineP.options.dashOffset = dashOffset;\r\n            trackLineP.on('mouseover', function() {\r\n                trackLineP.setStyle({\r\n                    weight: opacity*2,\r\n                });\r\n            });\r\n        \r\n            trackLineP.on('mouseout', function() {\r\n                trackLineP.setStyle({\r\n                    weight: opacity,\r\n                });\r\n            });\r\n            trackLine[nbTrackLine] = trackLineP;\r\n            trackLine[nbTrackLine].addTo(layer);\r\n            nbTrackLine++;\r\n        }\r\n    }\r\n    return trackLine;\r\n}\r\n\r\n\r\nfunction buildPt(lat,lon)\r\n{\r\n    if(!lat) lat = 0;\r\n    if(!lon) lon = 0;\r\n    return L.latLng(lat,lon);\r\n}\r\n\r\n\r\nexport function buildPt2(lat,lon)\r\n{\r\n\r\n    if(!lat) lat = 0;\r\n    if(!lon) lon = 0;\r\n    let ret = [];\r\n    ret[0] =  L.latLng(lat,lon-360,true);\r\n    ret[1] =  L.latLng(lat,lon);\r\n    ret[2] =  L.latLng(lat,lon+360,true);\r\n    return ret;\r\n}\r\n\r\nfunction buildPath(pathEntry,initLat,initLng,finishLat,finshLng)\r\n{\r\n\r\n    let cpath = [];\r\n    let cpathNum = 0;\r\n    cpath[cpathNum] = [];\r\n    let pos;\r\n    if(!pathEntry )    return cpath;\r\n    let path = [];\r\n    if(initLat && initLng)\r\n    {\r\n        path.push({lat:initLat,lon:initLng});\r\n    }\r\n    \r\n    for(const pts of pathEntry)\r\n    {\r\n        path.push(pts);\r\n    }\r\n    if(finishLat && finshLng)\r\n    {\r\n        path.push({lat:finishLat,lon:finshLng});\r\n    }\r\n    let paths = convertLng0To360(path);\r\n    pos= buildPt(paths[0].lat, (paths[0].lon?paths[0].lon:paths[0].lng));\r\n    cpath[cpathNum].push(pos);\r\n\r\n    if(paths.length >1)\r\n        for (let i = 1; i < paths.length; i++) {\r\n            const lon = (paths[i].lon?paths[i].lon:paths[i].lng);\r\n            const lat = paths[i].lat;\r\n            pos = buildPt(lat, lon);\r\n            cpath[cpathNum].push(pos);\r\n        }\r\n    return cpath;\r\n}\r\n\r\nconst convertLng0To360 = (coordinates) => {\r\n    const coordinatesWithOffset = [];\r\n    let offset = 0;\r\n  \r\n    for (const point of coordinates) {\r\n      const previousPoint =\r\n        coordinatesWithOffset[coordinatesWithOffset.length - 1];\r\n      const lon = point.lon?point.lon:point.lng;\r\n      const lonp = previousPoint?(previousPoint.lon?previousPoint.lon:previousPoint.lng):null;\r\n      \r\n      if (previousPoint && lon > 90 && lonp < -90) {\r\n        offset = -360;\r\n      } else if (previousPoint && lonp > 90 && lon < -90) {\r\n        offset = 360;\r\n      }\r\n      if(point.lon) point.lon += offset; else point.lng += offset;\r\n      coordinatesWithOffset.push(point);\r\n    }\r\n  \r\n    return coordinatesWithOffset;\r\n  };\r\n\r\nexport function buildPath_bspline(pathEntry,initLat,initLng,finishLat,finshLng)\r\n {\r\n\r\n    let cpath = [];\r\n    let cpathNum = 0;\r\n    cpath[cpathNum] = [];\r\n    if(!pathEntry )    return cpath;\r\n    let path = [];\r\n    if(initLat && initLng)\r\n    {\r\n        path.push({lat:initLat,lon:initLng});\r\n    }\r\n    for(const pts of pathEntry)\r\n    {\r\n        path.push(pts);\r\n    }\r\n    if(finishLat && finshLng)\r\n    {\r\n        path.push({lat:finishLat,lon:finshLng});\r\n    }\r\n\r\n    const paths = convertLng0To360(path);\r\n    cpath[cpathNum].push(buildPt(paths[0].lat, (paths[0].lon?paths[0].lon:paths[0].lng)));\r\n\r\n    if(path.length >1)\r\n    {\r\n        for (let i = 2; i < paths.length - 1; i++) {\r\n            for (let t = 0; t < 1; t += 0.1) {\r\n                const  ax = (-paths[i - 2].lat + 3 * paths[i - 1].lat - 3 * paths[i].lat + paths[i + 1].lat) / 6;\r\n                const  ay = (-paths[i - 2].lon + 3 * paths[i - 1].lon - 3 * paths[i].lon + paths[i + 1].lon) / 6;\r\n                const  bx = (paths[i - 2].lat - 2 * paths[i - 1].lat + paths[i].lat) / 2;\r\n                const  by = (paths[i - 2].lon - 2 * paths[i - 1].lon + paths[i].lon) / 2;\r\n                const  cx = (-paths[i - 2].lat + paths[i].lat) / 2;\r\n                const  cy = (-paths[i - 2].lon + paths[i].lon) / 2;\r\n                const  dx = (paths[i - 2].lat + 4 * paths[i - 1].lat + paths[i].lat) / 6;\r\n                const  dy = (paths[i - 2].lon + 4 * paths[i - 1].lon + paths[i].lon) / 6;\r\n                const lat = ax * Math.pow(t + 0.1, 3) + bx * Math.pow(t + 0.1, 2) + cx * (t + 0.1) + dx;\r\n                const lon = ay * Math.pow(t + 0.1, 3) + by * Math.pow(t + 0.1, 2) + cy * (t + 0.1) + dy;\r\n                pos = buildPt(lat, lon);\r\n                cpath[cpathNum].push(pos);\r\n            }\r\n        }\r\n    }\r\n    return cpath;\r\n}\r\n\r\n\r\n\r\nfunction createProjectionPoint(ts,lat,lon)\r\n{\r\n    return  {\r\n        timeStamp : ts,\r\n        lat : lat,\r\n        lon : lon\r\n    };\r\n}\r\n\r\n","\r\nimport {buildPt2, buildCircle,buildTrace} from './map-utils.js'\r\nimport {getUserPrefs} from '../../../common/userPrefs.js'\r\nimport { mapState } from './map-race.js';\r\n\r\nfunction computeNextPos(pos,hdg,speed,time) {\r\n    var dist5 = speed*time/(3600*60);\r\n    var alpha = 360 - ( hdg - 90);\r\n    var lat5 = pos.lat;\r\n    var lng5 = pos.lng;\r\n    var latrad1 = Util.toRad(lat5);\r\n    var latrad2;\r\n    var phi;\r\n\r\n    lat5 += dist5*Math.sin(Util.toRad(alpha));\r\n    latrad2 = Util.toRad(lat5);\r\n    phi = Math.cos((latrad1+latrad2)/2);\r\n    lng5 += (dist5*Math.cos(Util.toRad(alpha))) / phi ;\r\n    if(lng5 > 180) {\r\n        lng5 = lng5 - 360;\r\n    }\r\n    if(lng5 < -180) {\r\n        lng5 = lng5 + 360;\r\n    }\r\n\r\n    return buildPt2(lat5, lng5);\r\n\r\n}\r\n\r\nexport function drawProjectionLine(pos,hdg,speed) {\r\n\r\n    if(!hdg || !speed) return;\r\n    if(!mapState|| !mapState.map || !mapState.gdiv) return;\r\n    \r\n    const userPrefs = getUserPrefs();\r\n    const map = mapState.map;\r\n\r\n    if(mapState.me_PlLayer) map.removeLayer(mapState.me_PlLayer);\r\n    mapState.me_PlLayer = L.layerGroup(); \r\n\r\n    let tpath = [];\r\n\r\n    tpath.push(pos[1]);\r\n\r\n    for(var i=0;i<userPrefs.map.projectionLineLenght/2;i++)\r\n    {\r\n        pos = computeNextPos(pos[1],hdg,speed,2*60);\r\n        tpath.push(pos[1]);\r\n        const title = 2*(i+1)+\"min\";\r\n        buildCircle(pos,layer,userPrefs.map.projectionColor, 1.5,1,title); \r\n    }  \r\n    buildTrace(buildPath(tpath) ,mapState.me_PlLayer, mapState.refPoints,userPrefs.map.projectionColor,1,0.4,'10, 10','5');\r\n    layer.addTo(map); \r\n\r\n}\r\n\r\n\r\n","\r\nimport {getUserPrefs} from '../../../common/userPrefs.js'\r\nimport {applyBoundsForCurrentMode, buildPolarCRS, createArcticWMS, computeComfortView} from './map-core.js'\r\nimport {initButtonToCenterViewMap,enableCoordinateCopyingWithShortcut} from './map-shortcuts.js'\r\nimport {buildPt2, buildMarker,\r\n    buildTextIcon,buildCircleEndRace,\r\n    buildPath_bspline,buildTrace,\r\n    yellowRLIconP, yellowRRIconP, yellowRLIcon, yellowRRIcon,\r\n    redRLIconP, redRLIcon, greenRRIconP, greenRRIcon\r\n} from './map-utils.js'\r\nimport {formatPosition,formatShortDate,formatTimestampToReadableDate,formatDHMS\r\n} from '../common.js';\r\n\r\nimport {sailNames} from \"../constant.js\"\r\n\r\nimport {getConnectedPlayerId,\r\n        getRaceInfo,\r\n        getLegPlayerInfos,\r\n        getLegFleetInfos,\r\n        getLegPlayersTracksFleet,\r\n        getLegPlayersTrackLeader,\r\n} from '../../app/memoData.js'\r\n\r\nimport { gcDistance, roundTo} from '../../../common/utils.js';\r\n\r\nimport {drawProjectionLine} from './map-proj.js'\r\n\r\nexport const mapState = {\r\n    raceId: null,       // id de la course actuellement affich√©e\r\n    map: null,          // instance Leaflet\r\n    refPoints: [],      // points pour fitBounds\r\n    refLayer: null,     // layerGroup pour traits de c√¥te / ice / RZ\r\n    route: [],          // routes import√©es (importRoute / showRoute / hideRoute)\r\n    bounds: null,\r\n    resetUserZoom: 0,\r\n    userZoom: false,\r\n    // couches optionnelles, cr√©√©es √† la demande :\r\n    checkPointLayer: null,\r\n    fleetLayer: null,\r\n    fleetLayerMarkers: null,\r\n    fleetLayerTracks: null,\r\n    wayPointLayer: null,\r\n    meLayer: null,\r\n    meLayerMarkers: null,\r\n    meBoatLayer: null,\r\n    leaderLayer: null,\r\n    leaderMeLayer: null,\r\n    \r\n};\r\nconst MAP_CONTAINER_ID = 'lMap';\r\n\r\nfunction updateBounds()\r\n{\r\n    if (!mapState.map) return;\r\n    mapState.bounds = L.latLngBounds(mapState.refPoints);\r\n    mapState.map.fitBounds(mapState.bounds);\r\n}\r\n\r\nfunction updateMapCheckpoints(raceInfo,playerIte) {\r\n\r\n   if (!mapState.map) return;\r\n    \r\n    const map = mapState.map;\r\n    \r\n    // checkpoints\r\n    if (!raceInfo || !map) return;\r\n\r\n    if(mapState.checkPointLayer)\r\n    {\r\n        map.removeLayer(mapState.checkPointLayer);\r\n    }\r\n    mapState.checkPointLayer = L.layerGroup();\r\n    const userPrefs = getUserPrefs();\r\n    const showInvisibleDoors = userPrefs.map.invisibleBuoy;\r\n\r\n    if (Array.isArray(raceInfo.checkpoints)) {\r\n        for (const cp of raceInfo.checkpoints) {\r\n            if (cp.display == \"none\" && !showInvisibleDoors) {\r\n                continue;\r\n            }\r\n            let cpType = (cp.display && cp.display !== 'none') ? cp.display : 'Invisible';\r\n            cpType = cpType.charAt(0).toUpperCase() + cpType.slice(1);\r\n\r\n            const position_s = buildPt2(cp.start.lat, cp.start.lon);\r\n            const position_e = buildPt2(cp.end.lat, cp.end.lon);\r\n            const passed = (playerIte?.ite?.gateGroupCounters && playerIte.ite.gateGroupCounters[cp.group - 1]) ? true : false;\r\n\r\n            let op = 1.0;\r\n            if(passed) op = 0.6;\r\n            const label_g = (passed ? \"<div class='tagGatePassed'>PASSED</div>\" : \"\") \r\n                + \"Checkpoint \" + cp.group + \".\" + cp.id +  \": <b>\" + cp.name + \"</b><br>\";\r\n            const label_g_more = \"<br>Type: <b>\" + cpType + \"</b> | Engine: \" + cp.engine;\r\n            const side_s =  (cp.side == \"stbd\") ? \"Starboard\" : \"Port\";\r\n            const side_e = (cp.side == \"stbd\") ? \"Port\" : \"Starboard\";\r\n            const label_s = label_g + formatPosition(cp.start.lat, cp.start.lon) + label_g_more + \" | Side: \" + side_s;\r\n            const label_e = label_g + formatPosition(cp.end.lat, cp.end.lon) + label_g_more + \" | Side: \" + side_e;\r\n\r\n            if (cp.display == \"buoy\" || cp.side == \"stbd\") {\r\n                const iconStart = (cp.side == \"stbd\")?(passed?greenRRIconP:greenRRIcon):(passed?redRLIconP:redRLIcon);\r\n                const iconEnd = (cp.side == \"stbd\")?(passed?redRLIconP:redRLIcon):(passed?greenRRIconP:greenRRIcon);\r\n                buildMarker(position_s, mapState.checkPointLayer, iconStart, label_s, 8, op,0);\r\n                buildMarker(position_e, mapState.checkPointLayer, iconEnd, label_e, 8, op,0);\r\n            } else {\r\n                const iconStart = (cp.side == \"stbd\")?(passed?yellowRRIconP:yellowRRIcon):(passed?yellowRLIconP:yellowRLIcon)\r\n                buildMarker(position_s, mapState.checkPointLayer, iconStart, label_s, 8, op,0);\r\n            }\r\n            mapState.refPoints.push(position_e[1]);\r\n            mapState.refPoints.push(position_s[1]);\r\n            const pathColor = passed?\"green\":\"yellow\";\r\n            const tpath = [];\r\n            tpath.push(position_e[1]);\r\n            tpath.push(position_s[1]);\r\n            buildTrace(buildPath(tpath),mapState.checkPointLayer,mapState.refPoints,pathColor,1,op,'20, 20','10');               \r\n        }\r\n    }\r\n    mapState.checkPointLayer.addTo(map); \r\n    if(!mapState.userZoom) updateBounds();\r\n}\r\n\r\nfunction updateMapWaypoints(playerIte) {\r\n    const raceOrder = getLegPlayersOrder();\r\n    if (!mapState || !mapState.map || !mapState.gdiv) return;\r\n    const map = mapState.map;\r\n\r\n    if (!playerIte) return; // current position unknown\r\n    if(!raceOrder && raceOrder[0].action.type !== \"wp\") return; //last order not wp\r\n\r\n    if(mapState.wayPointLayer)\r\n    {\r\n        map.removeLayer(mapState.wayPointLayer);\r\n    }\r\n    mapState.wayPointLayer = L.layerGroup();\r\n\r\n    const wpOrder = raceOrder[0].action.action;  \r\n    const lastWpIdx = playerIte.lastWpIdx;\r\n    const currPos = playerIte.pos;\r\n    \r\n    // Waypoint lines already passed\r\n    let wpPts = [];\r\n    wpOrder.forEach(({ lat, lon, idx }) => {\r\n        if(idx <= lastWpIdx) wpPts.push({lat,lon});\r\n    });\r\n    let cpath = buildPath(wpPts,null,null,currPos.lat, currPos.lon);\r\n    buildTrace(cpath,mapState.wayPointLayer,mapState.refPoints,\"#FF00FF\",1.5,0.7,[0,1,0,1]);\r\n\r\n    // Waypoint lines    \r\n    wpPts = [];\r\n    wpOrder.forEach(({ lat, lon, idx }) => {\r\n        if(idx > lastWpIdx) wpPts.push({lat,lon});\r\n    });\r\n    \r\n    cpath = buildPath(wpOrder,currPos.lat, currPos.lon);\r\n    buildTrace(cpath,mapState.wayPointLayer,mapState.refPoints,\"#FF00FF\",1.5,0.7);\r\n    // Waypoint markers\r\n    wpOrder.forEach(({ lat, lon, idx }) => {\r\n        const pos = buildPt2(lat, lon);\r\n        const title = formatPosition(lat, lon);\r\n        buildCircle(pos,mapState.wayPointLayer,\"#FF00FF\", 2,1, title);\r\n        mapState.refPoints.push(pos[1]);\r\n    });     \r\n    mapState.wayPointLayer.addTo(map); \r\n    if(!mapState.userZoom) updateBounds();\r\n}\r\n\r\nfunction updateMapMe(connectedPlayerId,playerIte) {\r\n    const trackFleet = getLegPlayersTracksFleet();\r\n    const userPrefs = getUserPrefs();\r\n    const localTimes = userPrefs.global.localTime;\r\n    const displayMarkers = userPrefs.map.showMarkers;\r\n\r\n    if (!mapState|| !mapState.map || !mapState.gdiv || !trackFleet || !trackFleet[connectedPlayerId]) return;\r\n    \r\n    const map = mapState.map;\r\n    const myTrack = trackFleet[connectedPlayerId].track;\r\n\r\n    if(!mapState.meLayer) mapState.meLayer  = L.layerGroup();\r\n    if(!mapState.meBoatLayer) mapState.meBoatLayer  = L.layerGroup();\r\n    if(!mapState.meLayerMarkers) mapState.meLayerMarkers  = L.layerGroup();\r\n\r\n    if(mapState.meLayer) map.removeLayer(mapState.meLayer);\r\n    if(mapState.meLayerMarkers) map.removeLayer(mapState.meLayerMarkers);\r\n    if(mapState.meBoatLayer) map.removeLayer(mapState.meBoatLayer);\r\n    mapState.meLayer  = L.layerGroup();\r\n    mapState.meLayerMarkers  = L.layerGroup();\r\n    mapState.meBoatLayer  = L.layerGroup();\r\n    \r\n    const myPos = {lat :playerIte.pos.lat, lon:playerIte.pos.lon}\r\n    let myTrackPts = [];\r\n    let isFirst = false;\r\n    let prevPt = null;\r\n    myTrack.forEach(({ lat, lon, ts,tag}) => {\r\n        myTrackPts.push({lat,lon});\r\n        if(isFirst)\r\n        {\r\n            const title =  \"Me \" \r\n                        + \"<br><b>\" \r\n                        + formatShortDate(ts,undefined,localTimes) \r\n                        + \"</b> | Speed: \" \r\n                        + roundTo(Math.abs(gcDistance(myPos, {lat, lon}) / ((ts -  prevPt.ts) / 1000) * 3600), 2) \r\n                        + \" kts<br>\" + formatPosition(lat, lon) \r\n                        + (tag ? \"<br>(Type: \" + tag + \")\" : \"\");\r\n            buildCircle({lat,lon}, mapState.meLayerMarkers,\"#b86dff\", 1.5 ,1, title);\r\n            mapState.refPoints.push({lat,lon});\r\n        }\r\n        isFirst = true;\r\n        prevPt = {lat:lat, lon:lon, ts:ts};\r\n    });\r\n    \r\n    if(displayMarkers) mapState.meLayerMarkers.addTo(map);\r\n\r\n    if(myPos.lat && myPos.lon)\r\n    {\r\n        const myTrackpath = buildPath(myTrackPts, undefined, undefined, myPos.lat, myPos.lon);\r\n        buildTrace(myTrackpath, mapState.meLayer, mapState.refPoints, \"#b86dff\", 1.5, 1);\r\n        mapState.meLayer.addTo(map);\r\n\r\n        const myPosPt = buildPt2(myPos.lat, myPos.lon);\r\n        const title = \"Me (Last position: \" \r\n                    + formatTimestampToReadableDate(playerIte.iteDate, 1) \r\n                    + \")<br>TWA: <b>\" + roundTo(playerIte.twa, 3) + \"¬∞</b>\"\r\n                    + \" | HDG: <b>\" + roundTo(playerIte.hdg, 2) + \"¬∞</b>\"\r\n                    + \"<br>Sail: \" + sailNames[playerIte.sail] + \" | Speed: \" + roundTo(playerIte.speed, 3) + \" kts\"\r\n                    + \"<br>TWS: \" + roundTo(playerIte.tws, 3) + \" kts | TWD: \" + roundTo(playerIte.twd, 3) + \"¬∞\";\r\n        buildMarker(myPosPt, mapState.meBoatLayer, buildBoatIcon(\"#b86dff\",\"#000000\",0.4), title,  200, 0.5,playerIte.hdg);\r\n        drawProjectionLine(myPosPt,playerIte.hdg,playerIte.speed) ;\r\n    }\r\n    mapState.meBoatLayer.addTo(map);\r\n\r\n    if(!mapState.userZoom) updateBounds();  \r\n}\r\n\r\nfunction updateMapLeader(playerIte) {\r\n    \r\n    if (!mapState|| !mapState.map || !mapState.gdiv) return;\r\n\r\n    if(mapState.leaderLayer) map.removeLayer(mapState.leaderLayer);\r\n    if(mapState.leaderMeLayer) map.removeLayer(mapState.leaderMeLayer);\r\n    mapState.leaderLayer = L.layerGroup(); \r\n    mapState.leaderMeLayer = L.layerGroup(); \r\n\r\n    const offset = playerIte?.startDate?(new Date() - playerIte.startDate):new Date();\r\n\r\n    const trackLeader = getLegPlayersTrackLeader();\r\n    if (trackLeader && trackLeader.track.length > 0) {\r\n        const playersList = getPlayersList();\r\n        const title = \"Leader: <b>\" + playersList[trackLeader.userId] + \"</b><br>Elapsed: \" + formatDHMS(offset);\r\n        addGhostTrack(trackLeader.track, title, offset, \"#FF8C00\", mapState.leaderLayer);\r\n    }\r\n\r\n    const trackGhost = getLegPlayersTrackLeader();\r\n    if (trackGhost && trackGhost.track.length > 0) {\r\n        const title = \"<b>Best Attempt</b><br>Elapsed: \" + formatDHMS(offset);\r\n        addGhostTrack(trackGhost.track, title, offset, \"#b86dff\", mapState.leaderMeLayer);\r\n    }\r\n\r\n}\r\n\r\nfunction addGhostTrack (ghostTrack, title, offset, color,layer) {\r\n    const userPrefs = getUserPrefs();\r\n    const displayMarkers = userPrefs.map.showMarkers;\r\n    \r\n    if (!ghostTrack || !mapState|| !mapState.map || !mapState.gdiv) return;\r\n    \r\n    const ghostStartTS = ghostTrack[0].ts;\r\n    const ghostPosTS = ghostStartTS + offset;\r\n    let ghostPos;\r\n\r\n    for (var i = 0; i < ghostTrack.length; i++) {\r\n        const pos = buildPt2(ghostTrack[i].lat, ghostTrack[i].lon);\r\n        mapState.refPoints.push(pos[1]);\r\n                \r\n        if (!ghostPos) {\r\n            if (ghostTrack[i].ts >= ghostPosTS) {\r\n                ghostPos = i;\r\n            }\r\n        }\r\n    }\r\n       \r\n    buildTrace(buildPath(ghostTrack),layer,mapState.refPoints, color,1,0.6,'10, 10','5');\r\n\r\n    if (ghostPos && displayMarkers) {\r\n        const lat1 = ghostTrack[ghostPos].lat;\r\n        const lon1 = ghostTrack[ghostPos].lon\r\n        const lat0 = ghostTrack[Math.max(ghostPos - 1, 0)].lat;\r\n        const lon0 = ghostTrack[Math.max(ghostPos - 1, 0)].lon;\r\n        const heading = Util.courseAngle(lat0, lon0, lat1, lon1) * 180 / Math.PI;\r\n        const d = (ghostPosTS - ghostTrack[ghostPos - 1].ts ) / (ghostTrack[ghostPos].ts - ghostTrack[ghostPos - 1].ts)\r\n        const lat = lat0 + (lat1-lat0) * d;\r\n        const lon = lon0 + (lon1-lon0) * d;\r\n        const pos = buildPt2(lat, lon);\r\n        buildMarker(pos,layer, buildBoatIcon(color,color,0.6), title,  20, 0.4,heading);\r\n    }\r\n\r\n    layer.addTo(mapState.map); \r\n    if(!mapState.userZoom) updateBounds();\r\n}\r\n\r\n\r\nfunction updateMapFleet(raceInfo, raceItesFleet, connectedPlayerId) {\r\n\r\n    if (!race || !mapState|| !mapState.map  || !mapState.gdiv) return;\r\n    \r\n    const map = mapState.map;\r\n    const userPrefs = getUserPrefs();\r\n    const trackFleet = getLegPlayersTracksFleet();\r\n\r\n    const displayMarkers = userPrefs.map.showMarkers;\r\n    const displayTracks = userPrefs.map.showTracks;\r\n    \r\n    if(mapState.fleetLayer) map.removeLayer(mapState.fleetLayer);\r\n    if(mapState.fleetLayerMarkers) map.removeLayer(mapState.fleetLayerMarkers);\r\n    if(mapState.fleetLayerTracks) map.removeLayer(mapState.fleetLayerTracks);\r\n\r\n    mapState.fleetLayer = L.layerGroup();\r\n    mapState.fleetLayerMarkers = L.layerGroup();\r\n    mapState.fleetLayerTracks = L.layerGroup();\r\n\r\n\r\n    Object.entries(raceItesFleet).map(([userId, playerFleetInfos]) => {\r\n\r\n\r\n        const playerIte = playerFleetInfos.ite;\r\n        if(playerIte && userId && userId != connectedPlayerId && isDisplayEnabled(playerIte, userId,connectedPlayerId))\r\n        {\r\n            let zi;\r\n            /*if (key == currentId){\r\n                zi = 50;    // Me\r\n                drawProjectionLine(race.lMap.me_PlLayer,pos,elem.heading,elem.speed) ;   \r\n            } else*/ \r\n            if (playerIte.type == \"top\") {\r\n                zi = 49;    // Top VSR\r\n            } else if (playerIte.team) {\r\n                zi = 48;    // Team\r\n            } else if (playerIte.followed == true || playerIte.isFollowed == true) {\r\n                zi = 47;    // Friend\r\n            } else if ( playerIte.type == \"sponsor\") {\r\n                zi = 46;    // Color Sponsor\r\n            } else {\r\n                zi = 44;    // Real   // Opponent\r\n            }\r\n            const pos = buildPt2(playerIte.pos.lat, playerIte.pos.lon);\r\n         \r\n            // Add names to real skippers if data exists\r\n            let skipperName = playerIte.displayName;\r\n            if (playerIte.extendedInfos?.skipperName) \r\n                skipperName += '<span class=\"txtUpper\">' \r\n                            + playerIte.extendedInfos.boatName \r\n                            + '</span><br><b>' \r\n                            + playerIte.extendedInfos.skipperName + '</b>';\r\n\r\n            let info = '';\r\n            if (playerIte.type == 'real') {\r\n                info = skipperName + \"<br>HDG: <b>\" + roundTo(playerIte.hdg, 2) + \"¬∞</b> | Speed: \" + roundTo(playerIte.speed, 3) + \" kts\";\r\n                if (playerIte.twa > 0) info += \"<br>TWA: <b>\" + roundTo(playerIte.twa, 3) + \"¬∞</b>\";\r\n                if (playerIte.sail != \"-\") info += \" | Sail: \" + sailNames[playerIte];\r\n                if (playerIte.tws > 0) info += \"<br>TWS: \" + roundTo(playerIte.tws, 3) + \" kts\";\r\n                if (playerIte.twd > 0) info += \" | TWD: \" + roundTo(playerIte.twd, 3) + \"¬∞\";\r\n            }\r\n            else {\r\n                info = skipperName \r\n                    + \"<br>TWA: <b>\" \r\n                    + roundTo(playerIte.twa, 3) \r\n                    + \"¬∞</b> | HDG: <b>\" \r\n                    + roundTo(playerIte.heading, 2) \r\n                    + \"¬∞</b><br>Sail: \" \r\n                    + sailNames[playerIte] || \"-\" \r\n                    + \" | Speed: \" \r\n                    + roundTo(playerIte.speed, 3) \r\n                    + \" kts<br>TWS: \" \r\n                    + roundTo(playerIte.tws, 3) + \" kts | TWD: \" \r\n                    + roundTo(playerIte.twd, 3) + \"¬∞\";\r\n            }\r\n\r\n            \r\n            if(raceInfo.type == \"record\") {\r\n                info += \"<br>Elapsed: <b>\" + formatDHMS(playerIte.iteDate - playerIte.startDate) + \"</b>\";\r\n            }\r\n\r\n            const categoryIdx = category.indexOf(playerIte.type);\r\n            const nameStyle = (userId == connectedPlayerId)?\"color: #b86dff; font-weight: bold; \"\r\n                            :((userPrefs.theme==\"dark\")?categoryStyleDark[categoryIdx]:categoryStyle[categoryIdx]);\r\n            \r\n            const sailStyle = sailColors[playerIte.sail];\r\n            buildMarker(pos, mapState.fleetLayer,buildBoatIcon(nameStyle,sailStyle,0.8), info,  zi, 0.8,playerIte.hdg);\r\n\r\n\r\n            // track\r\n            if (trackFleet[userId].track && trackFleet[userId].length != 0) {\r\n\r\n                const myPos = {lat :playerIte.pos.lat, lon:playerIte.pos.lon}\r\n                let playerTrackPts = [];\r\n                let isFirst = false;\r\n                let prevPt = null;\r\n                trackFleet[userId].track.forEach(({ lat, lon, ts,tag}) => {\r\n                    playerTrackPts.push({lat,lon});\r\n                    if(isFirst)\r\n                    {\r\n                        const title =  skipperName \r\n                            + \"<br><b>\" \r\n                            + formatShortDate(ts,undefined,localTimes) \r\n                            + \"</b> | Speed: \" \r\n                            + roundTo(Math.abs(gcDistance(playerPos, {lat, lon}) / ((ts -  prevPt.ts) / 1000) * 3600), 2) \r\n                            + \" kts<br>\" + formatPosition(lat, lon) \r\n                            + (tag ? \"<br>(Type: \" + tag + \")\" : \"\");\r\n                \r\n                        buildCircle(pos2,mapState.fleetLayerMarkers,nameStyle, 1.5,1,title);\r\n                        mapState.refPoints.push({lat,lon});\r\n                    }\r\n                    isFirst = true;\r\n                    prevPt = {lat:lat, lon:lon, ts:ts};\r\n                });\r\n            \r\n                if(playerPos.lat && playerPos.lon)\r\n                {\r\n                    const myTrackpath = buildPath(playerTrackPts, undefined, undefined, playerPos.lat, playerPos.lon);\r\n                    buildTrace(myTrackpath, mapState.fleetLayerTracks, mapState.refPoints, nameStyle, 1.5, 1);\r\n                    mapState.fleetLayerTracks.addTo(map);\r\n                }\r\n            }\r\n        }\r\n                \r\n    });\r\n\r\n    mapState.fleetLayer.addTo(map); \r\n    if(displayMarkers)\r\n        mapState.fleetLayerMarkers.addTo(map); \r\n    if(displayTracks)\r\n        mapState.fleetLayerTracks.addTo(map); \r\n\r\n    if(!mapState.userZoom) updateBounds();\r\n\r\n}\r\n\r\nfunction cleanMap() {\r\n    // on cache juste le conteneur global\r\n    const existingMap = document.getElementById(MAP_CONTAINER_ID);\r\n    if (existingMap) {\r\n        existingMap.style.visibility = \"hidden\";\r\n        existingMap.style.height = \"0px\";\r\n        existingMap.style.width = \"0px\";\r\n    }\r\n\r\n    // l'√©tat Leaflet reste en m√©moire ; si tu veux vraiment tout purger, tu peux faire :\r\n    if (mapState.map) {\r\n        mapState.map.off();\r\n        mapState.map.remove();\r\n    }\r\n    mapState.map = null;\r\n    mapState.raceId = null;\r\n}\r\n\r\nfunction getOrCreateMapContainer() {\r\n    const tab = document.getElementById(\"tab-content3\");\r\n    if (!tab) return null;\r\n\r\n    let divMap = document.getElementById(MAP_CONTAINER_ID);\r\n    if (!divMap) {\r\n        divMap = document.createElement('div');\r\n        divMap.id = MAP_CONTAINER_ID;\r\n        divMap.style.height = \"100%\";\r\n        divMap.style.display = \"flex\";\r\n        divMap.style.width = \"90%\";\r\n        tab.appendChild(divMap);\r\n    }\r\n\r\n    // on le (re)rend visible\r\n    divMap.style.visibility = \"visible\";\r\n    divMap.style.height = \"100%\";\r\n    divMap.style.width = \"90%\";\r\n\r\n    return divMap;\r\n}\r\n\r\nexport async function initializeMap()\r\n{\r\n    function set_userCustomZoom(e)\r\n    {\r\n        if(mapState.resetUserZoom > 0)\r\n            mapState.userZoom = true;\r\n        else    mapState.resetUserZoom += 1;\r\n        \r\n        if(e && e.target) if(e.target._zoom > 5 ) \r\n        {\r\n            const mapcenter = mapState.map.getCenter();\r\n            const lon = mapcenter.lng; \r\n//            EX.loadBorder(race,mapcenter.lat,lon);\r\n        }\r\n    }\r\n\r\n    const tab = document.getElementById(\"tab-content3\");\r\n    if (!tab) return;\r\n    if (getComputedStyle(tab).display === \"none\") {\r\n        // onglet masqu√© : on ne fait rien (√©vite les soucis de taille initiale)\r\n        return;\r\n    }\r\n\r\n    const raceInfo = getRaceInfo();\r\n    const playerItes = getLegPlayerInfos();\r\n    const raceItesFleet    = getLegFleetInfos();\r\n    const connectedPlayerId = getConnectedPlayerId();\r\n    \r\n    if (playerItes && playerItes.ites && playerItes.ites.length > 0) {\r\n        playerItes.ite = playerItes.ites[0];\r\n    }\r\n\r\n    const rid = raceInfo.raceId+\"_\"+raceInfo.legNum;\r\n\r\n    const divMap = getOrCreateMapContainer();\r\n    if (!divMap) return;\r\n    if(!raceInfo || raceInfo?.length == 0 ) return;\r\n    if (mapState.map && mapState.raceId === rid) {\r\n        mapState.map.invalidateSize();\r\n        applyBoundsForCurrentMode(mapState.map);\r\n\r\n        // couches dynamiques\r\n        updateBounds();\r\n        updateMapCheckpoints(raceInfo, playerItes.ite);\r\n        updateMapWaypoints(playerItes.ite);\r\n        updateMapMe(connectedPlayerId,playerItes.ite);\r\n        updateMapLeader(playerItes.ite);\r\n        updateMapFleet(raceInfo, raceItesFleet, connectedPlayerId);\r\n        initButtonToCenterViewMap(playerItes.ite.pos.lat, playerItes.ite.pos.lon, mapState.map);\r\n        enableCoordinateCopyingWithShortcut();\r\n        return;\r\n    }\r\n\r\n    if (mapState.map) {\r\n        mapState.map.off();\r\n        mapState.map.remove();\r\n        mapState.map = null;\r\n    }\r\n\r\n    mapState.refPoints = [];\r\n    mapState.refLayer = L.layerGroup();\r\n    // mapState.route : on peut d√©cider de le conserver par course dans une Map si tu veux,\r\n    // mais pour l‚Äôinstant on le repart √† z√©ro :\r\n    //mapState.route = {};\r\n\r\n    mapState.resetUserZoom = 0;\r\n    mapState.userZoom = false;\r\n    mapState.raceId = race.id;\r\n\r\n    let mapTileColorFilterDarkMode = [\r\n        'invert:100%',\r\n        'bright:106%',\r\n        'contrast:121%',\r\n        'hue:195deg',\r\n        'saturate:43%'\r\n    ];\r\n\r\n    const Esri_WorldImagery = L.tileLayer(\r\n        'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\r\n        {\r\n            minZoom: 2, maxZoom: 40, maxNativeZoom: 40,\r\n            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, ' +\r\n                         'AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'\r\n        }\r\n    );\r\n\r\n    const OSM_Layer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n        minZoom: 2, maxZoom: 40, maxNativeZoom: 40,\r\n        attribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\r\n    });\r\n\r\n    const OSM_DarkLayer = L.tileLayer.colorFilter('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n        minZoom: 2, maxZoom: 40, maxNativeZoom: 40,\r\n        attribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors',\r\n        filter: mapTileColorFilterDarkMode                \r\n    });\r\n\r\n    const Arctic_WMS = createArcticWMS();\r\n\r\n    const baseLayers = {\r\n        \"Carte\": OSM_Layer,\r\n        \"Dark\": OSM_DarkLayer,\r\n        \"Satellite\": Esri_WorldImagery\r\n    };\r\n    if (Arctic_WMS) {\r\n        baseLayers[\"Arctic (EPSG:3413)\"] = Arctic_WMS;\r\n    }\r\n\r\n    const userPrefs = getUserPrefs();\r\n    const userBaseMap = userPrefs.map.selectBaseMap;\r\n\r\n    let selectBaseMap = OSM_Layer;\r\n    if (userBaseMap === \"Dark\") selectBaseMap = OSM_DarkLayer;\r\n    else if (userBaseMap === \"Satellite\") selectBaseMap = Esri_WorldImagery;\r\n    else if (userBaseMap === \"Arctic (EPSG:3413)\" && Arctic_WMS) selectBaseMap = Arctic_WMS;\r\n\r\n    const usingPolar = (selectBaseMap === Arctic_WMS) && !!POLAR.crs;\r\n    POLAR.enabled = usingPolar;\r\n\r\n    let map = L.map(MAP_CONTAINER_ID, {\r\n        layers: [selectBaseMap],\r\n        crs: usingPolar ? POLAR.crs : L.CRS.EPSG3857\r\n    });\r\n\r\n    mapState.map = map; \r\n\r\n    \r\n    const layerControl = L.control.layers(baseLayers, null, { position: 'topright' });\r\n    layerControl.addTo(map);\r\n    ensureLayerControlClickable(layerControl);\r\n\r\n    async function onBaseLayerChange(e) {\r\n        await saveLocal(\"selectBaseMap\", e.name);\r\n\r\n        const isArctic = (e.layer === Arctic_WMS);\r\n        const wasArctic = !!POLAR.enabled;\r\n\r\n        if (hasProj4Leaflet() && (isArctic !== wasArctic)) {\r\n            const center = map.getCenter();\r\n            const zoom   = map.getZoom();\r\n\r\n            map.off('baselayerchange', onBaseLayerChange);\r\n            map.off('zoomend', set_userCustomZoom);\r\n            map.remove();\r\n\r\n            POLAR.enabled = isArctic;\r\n\r\n            const activeBase = isArctic\r\n                ? Arctic_WMS\r\n                : (e.name === 'Dark'\r\n                    ? OSM_DarkLayer\r\n                    : (e.name === 'Satellite' ? Esri_WorldImagery : OSM_Layer));\r\n\r\n            const newMap = L.map(MAP_CONTAINER_ID, {\r\n                crs: isArctic ? (POLAR.crs || buildPolarCRS()) : L.CRS.EPSG3857,\r\n                layers: [activeBase],\r\n                zoomAnimation: false,\r\n                fadeAnimation: false\r\n            });\r\n\r\n            mapState.map = newMap;\r\n            map = newMap;\r\n\r\n            newMap.once('load', () => newMap.invalidateSize());\r\n            const comfy = computeComfortView(isArctic, center, zoom);\r\n            requestAnimationFrame(() => {\r\n                newMap.setView(comfy.center, comfy.zoom, { animate: false });\r\n                newMap.invalidateSize();\r\n                setTimeout(() => newMap.invalidateSize(), 0);\r\n            });\r\n\r\n            const newBaseLayers = {\r\n                \"Carte\": OSM_Layer,\r\n                \"Dark\": OSM_DarkLayer,\r\n                \"Satellite\": Esri_WorldImagery\r\n            };\r\n            if (Arctic_WMS) newBaseLayers[\"Arctic (EPSG:3413)\"] = Arctic_WMS;\r\n            const newLayerControl = L.control.layers(newBaseLayers);\r\n            newLayerControl.addTo(newMap);\r\n            ensureLayerControlClickable(newLayerControl);\r\n\r\n            newMap.addControl(new L.Control.ScaleNautic({\r\n                metric: true,\r\n                imperial: false,\r\n                nautic: true\r\n            }));\r\n\r\n            const optionsRuler = {\r\n                position: 'topleft',\r\n                maxPoints: 2,\r\n                lengthUnit: {\r\n                    factor: 0.539956803,\r\n                    display: 'nm',\r\n                    decimal: 2,\r\n                    label: 'Distance:'\r\n                },\r\n            };\r\n            L.control.ruler(optionsRuler).addTo(newMap);\r\n\r\n            L.control.coordinates({\r\n                useDMS: true,\r\n                labelTemplateLat: \"Lat: {y}\",\r\n                labelTemplateLng: \" Lng: {x}\",\r\n                useLatLngOrder: true,\r\n                labelFormatterLat: function (lat) {\r\n                    let latFormatted = L.NumberFormatter.toDMS(lat);\r\n                    latFormatted = latFormatted.replace(/''$/, '\"') + (latFormatted.startsWith('-') ? ' S' : ' N');\r\n                    return latFormatted.replace(/^-/, '');\r\n                },\r\n                labelFormatterLng: function (lng) {\r\n                    let lngFormatted = L.NumberFormatter.toDMS(lng);\r\n                    lngFormatted = lngFormatted.replace(/''$/, '\"') + (lngFormatted.startsWith('-') ? ' W' : ' E');\r\n                    return '<span class=\"labelGeo\">' + lngFormatted.replace(/^-/, '') + '</span>';\r\n                },\r\n            }).addTo(newMap);\r\n\r\n            if (mapState.refLayer) mapState.refLayer.addTo(newMap);\r\n\r\n            applyBoundsForCurrentMode(newMap);\r\n\r\n            newMap.on('zoomend', set_userCustomZoom);\r\n            newMap.on('baselayerchange', onBaseLayerChange);\r\n\r\n            // re-appliquer les couches dynamiques pour la course courante\r\n            const raceInfo = getRaceInfo();\r\n            const playerItes = getLegPlayerInfos();\r\n            const raceItesFleet    = getLegFleetInfos();\r\n            const connectedPlayerId = getConnectedPlayerId();\r\n    \r\n            if (playerItes && playerItes.ites && playerItes.ites.length > 0) {\r\n                playerItes.ite = playerItes.ites[0];\r\n            }\r\n            updateBounds(raceInfo);\r\n            updateMapCheckpoints(raceInfo, playerItes.ite); \r\n            updateMapWaypoints(playerItes.ite);\r\n            updateMapMe(connectedPlayerId,playerItes.ite);\r\n            updateMapFleet(raceInfo, raceItesFleet, connectedPlayerId);\r\n            updateMapLeader(playerItes.ite);\r\n            return;\r\n        }\r\n\r\n        POLAR.enabled = isArctic;\r\n        applyBoundsForCurrentMode(map);\r\n    }\r\n\r\n    map.addControl(new L.Control.ScaleNautic({\r\n        metric: true,\r\n        imperial: false,\r\n        nautic: true\r\n    }));\r\n\r\n    const optionsRuler = {\r\n        position: 'topleft',\r\n        maxPoints: 2,\r\n        lengthUnit: {\r\n            factor: 0.539956803,\r\n            display: 'nm',\r\n            decimal: 2,\r\n            label: 'Distance:'\r\n        },\r\n    };\r\n    L.control.ruler(optionsRuler).addTo(map);\r\n\r\n    L.control.coordinates({\r\n        useDMS: true,\r\n        labelTemplateLat: \"Lat: {y}\",\r\n        labelTemplateLng: \" Lng: {x}\",\r\n        useLatLngOrder: true,\r\n        labelFormatterLat: function (lat) {\r\n            let latFormatted = L.NumberFormatter.toDMS(lat);\r\n            latFormatted = latFormatted.replace(/''$/, '\"') + (latFormatted.startsWith('-') ? ' S' : ' N');\r\n            return latFormatted.replace(/^-/, '');\r\n        },\r\n        labelFormatterLng: function (lng) {\r\n            let lngFormatted = L.NumberFormatter.toDMS(lng);\r\n            lngFormatted = lngFormatted.replace(/''$/, '\"') + (lngFormatted.startsWith('-') ? ' W' : ' E');\r\n            return '<span class=\"labelGeo\">' + lngFormatted.replace(/^-/, '') + '</span>';\r\n        },\r\n    }).addTo(map);\r\n\r\n    map.attributionControl.addAttribution('&copy;SkipperDuMad / Trait de cotes &copy;Kurun56');\r\n\r\n    mapState.refLayer = L.layerGroup();\r\n\r\n    //start end\r\n    const title1 = \"Start: <b>\" + raceInfo.start.name + \"</b><br>\"\r\n                + formatPosition(raceInfo.start.lat, raceInfo.start.lon);\r\n    \r\n    const latlng = buildPt2(raceInfo.start.lat, raceInfo.start.lon);\r\n    buildMarker(latlng,mapState.refLayer,buildTextIcon('','white','blue',\"S\"),title1,0);\r\n    mapState.refPoints.push(latlng[1]);\r\n    \r\n    title1 =  \"Finish: <b>\" + raceInfo.end.name  + \"</b><br>\"\r\n        + formatPosition(raceInfo.end.lat, raceInfo.end.lon);\r\n    latlng = buildPt2(raceInfo.end.lat,raceInfo.end.lon);\r\n    buildMarker(latlng,mapState.refLayer,buildTextIcon('','yellow','red',\"F\"),title1,0);\r\n    mapState.refPoints.push(latlng[1]);\r\n    \r\n    buildCircleEndRace(latlng,mapState.refLayer, 'red', raceInfo.end.radius * 1852.0);\r\n    \r\n    // course\r\n    const cpath = buildPath_bspline(raceInfo.course,raceInfo.start.lat,raceInfo.start.lon,raceInfo.end.lat,raceInfo.end.lon);\r\n    const raceLine = buildTrace(cpath,mapState.refLayer,mapState.refPoints,\"white\",1,0.5);\r\n    for(var i=0;i<raceLine.length;i++) \r\n    {\r\n        L.polylineDecorator(raceLine[i], {\r\n            patterns: [\r\n                {offset: '5%', repeat: '10%', symbol: L.Symbol.arrowHead({pixelSize: 15, pathOptions: {fillOpacity: 0.5, weight: 1, color :'white'}})}\r\n            ]\r\n        }).addTo(mapState.refLayer);\r\n    }\r\n\r\n    //  Ice limits\r\n    const south = raceInfo?.ice_limits?.south;\r\n    if (Array.isArray(south) && south.length !== 0) \r\n    {\r\n        const isDummy = (south.length === 5\r\n        && south[0].lat === -90 && south[0].lon === -180\r\n        && south[2].lat === -90 && south[2].lon === 0\r\n        && south[4].lat === -90 && south[4].lon === 180);\r\n\r\n        if(!isDummy)\r\n        {\r\n            const iceDataMiddleIndex = Math.ceil(iceData.length / 2);\r\n            const iceDataFirstHalf = iceData.slice(0, iceDataMiddleIndex);\r\n            const iceDataSecondHalf = iceData.slice(iceDataMiddleIndex);\r\n            buildTrace(buildPath(iceDataFirstHalf),mapState.refLayer,mapState.refPoints,\"#FF0000\",1.5,0.5,false);\r\n            buildTrace(buildPath(iceDataSecondHalf),mapState.refLayer,mapState.refPoints,\"#FF0000\",1.5,0.5,false);\r\n            if (Util.isOdd(iceData.length)) buildTrace(buildPath([iceDataFirstHalf[iceDataFirstHalf.length - 1], iceDataSecondHalf[0]]),mapState.refLayer,mapState.refPoints,\"#FF0000\",1.5,0.5,false);    \r\n        }\r\n    }\r\n    const rz = raceInfo?.restrictedZones;\r\n    if (Array.isArray(rz) && rz.length !== 0) {\r\n        for (const z of rz) {\r\n            let polygonPts0 = [];\r\n            let polygonPts1 = [];\r\n            let polygonPts2 = [];\r\n            let restrictedZoneColor = \"red\";\r\n            if(z.color) restrictedZoneColor = z.color;\r\n            for (const p of (z.vertices || [])) {\r\n                polygonPts0.push([p.lat, p.lon]);\r\n                polygonPts1.push([p.lat, p.lon-360]);\r\n                polygonPts2.push([p.lat, p.lon+360]);\r\n            }\r\n            L.polygon(polygonPts0,\r\n            {\r\n                color: restrictedZoneColor,\r\n                stroke : 0.35,\r\n                weight : 1,\r\n            }).addTo(mapState.refLayer);\r\n            L.polygon(polygonPts1,\r\n            {\r\n                color: restrictedZoneColor,\r\n                stroke : 0.35,\r\n                weight : 1,\r\n            }).addTo(mapState.refLayer);\r\n            L.polygon(polygonPts2,\r\n            {\r\n                color: restrictedZoneColor,\r\n                stroke : 0.35,\r\n                weight : 1,\r\n            }).addTo(mapState.refLayer);\r\n\r\n        }\r\n    }\r\n    mapState.refLayer.addTo(map);\r\n    updateBounds(raceInfo);\r\n    updateMapCheckpoints(raceInfo, playerItes.ite);\r\n    updateMapFleet(raceInfo, raceItesFleet, connectedPlayerId);\r\n\r\n    if(mapState.route[rid] && mapState.route[rid].length !==0) {\r\n        Object.keys(mapState.route[rid]).forEach(function (name) {\r\n            var lMapRoute = mapState.route[rid][name];\r\n            var map = mapState.map;\r\n            if(lMapRoute.displayed)\r\n            {\r\n                if(lMapRoute.traceLayer) lMapRoute.traceLayer.addTo(map);\r\n                if(lMapRoute.markersLayer && document.getElementById('sel_showMarkersLmap').checked) lMapRoute.markersLayer.addTo(map);\r\n            }\r\n        });\r\n    }\r\n\r\n    updateMapWaypoints(playerItes.ite);\r\n    updateMapLeader(playerItes.ite);\r\n    updateMapMe(connectedPlayerId,playerItes.ite);\r\n\r\n    set_userCustomZoom(false);\r\n    applyBoundsForCurrentMode(map);\r\n\r\n    map.on('baselayerchange', onBaseLayerChange);\r\n    map.on('zoomend',set_userCustomZoom);\r\n\r\n    mapState.map = map;\r\n    initButtonToCenterViewMap(playerItes.ite.pos.lat, playerItes.ite.pos.lon, mapState.map);\r\n    enableCoordinateCopyingWithShortcut();\r\n    \r\n}\r\n\r\n\r\n","\r\n\r\nlet activeTab = 1;\r\nimport {display_selbox} from \"../ui/common.js\"\r\nimport {buildRaceLogHtml} from '../ui/raceLog.js'\r\nimport {buildRaceFleetHtml} from '../ui/raceFleet.js'\r\nimport {buildRaceBookHtml} from '../ui/raceBook.js'\r\nimport {initializeMap} from '../ui/map/map-race.js'\r\nexport const tabList = Object.freeze({\r\n    1 : \"raceLog\",\r\n    2 : \"raceFleet\",\r\n    3 : \"raceMap\",\r\n    4 : \"raceBook\",\r\n    5 : \"raceGraph\",\r\n    9 : \"raceAnalyse\",\r\n    6 : \"notif\",\r\n    7 : \"config\",\r\n    8 : \"rawLog\",\r\n  });\r\n\r\n  \r\nexport function getActiveTabId()\r\n{\r\n    return activeTab;\r\n}\r\nexport function tabSwitch(tabId = null)\r\n{\r\n    if(tabId == null)\r\n    {\r\n        if(activeTab) tabId = activeTab;    //redraw management\r\n        else return\r\n    } \r\n\r\n    activeTab = tabId;\r\n\r\n    display_selbox(\"hidden\");\r\n\r\n    for (const [key, value] of Object.entries(tabList)) {\r\n        if(value == \"raceMap\")\r\n            document.getElementById(\"tab-content\" + key).style.display = (tabId == key ? \"flex\" : \"none\");\r\n        else document.getElementById(\"tab-content\" + key).style.display = (tabId == key ? \"block\" : \"none\");\r\n    }\r\n\r\n    const tabName = tabList[tabId];\r\n\r\n    switch(tabName) {\r\n        case \"config\":\r\n        case \"rawLog\":\r\n            break;\r\n        case \"raceLog\":\r\n            buildRaceLogHtml();\r\n            break;\r\n        case \"raceFleet\":\r\n            display_selbox(\"visible\");\r\n            buildRaceFleetHtml();\r\n            break;\r\n        case \"raceMap\":\r\n            initializeMap();\r\n            display_selbox(\"visible\");\r\n            \r\n            break;\r\n        case \"raceBook\":\r\n            buildRaceBookHtml();            \r\n            break;\r\n        case \"raceGraph\":\r\n            \r\n            break;\r\n        case \"raceAnalyse\":\r\n//            document.getElementById('ityc_frame').src = getITYCFullExtra(getITYCFull(\"https://ityc.fr/polarDash.html\" + getITYCBoat(selRace.value),selRace.value),selRace.value)  ;    \r\n            break;\r\n        case \"notif\":\r\n            \r\n            break;\r\n    }\r\n/*\r\n    if (tabsel) {\r\n        // Tab-Selection\r\n        originClick= rmatch ;\r\n     //   EX.extraRoute(\"hidden\");\r\n        for (let t = 1; t <= nbTabs; t++) {\r\n            if(t==3)\r\n                document.getElementById(\"tab-content\" + t).style.display = (rmatch == t ? \"flex\" : \"none\");\r\n            else document.getElementById(\"tab-content\" + t).style.display = (rmatch == t ? \"block\" : \"none\");\r\n        }\r\n        if (rmatch == 2) {\r\n            \r\n            updateFleetHTML(raceFleetMap.get(selRace.value));\r\n            display_selbox(\"visible\");\r\n        } else if (rmatch == 3) {\r\n            var race = races.get(selRace.value);\r\n            rt.updateFleet(race,raceFleetMap);\r\n            initializeMap(race);\r\n            EX.extraRoute(\"visible\");\r\n            display_selbox(\"visible\");\r\n        } else if (rmatch == 4) {\r\n            buildlogBookHTML(races.get(selRace.value));\r\n        } else if (rmatch == 5) {\r\n            var race = races.get(selRace.value);\r\n            if(race && race.recordedData) {\r\n                gr.upDateGraph(race.recordedData);\r\n            }\r\n        } else if (rmatch == 6) {\r\n            nf.showList();\r\n        } else if (rmatch == 8) {\r\n//                 updateUserConfigHTML();\r\n        }  else if (rmatch == 9) {\r\n            document.getElementById('ityc_frame').src = getITYCFullExtra(getITYCFull(\"https://ityc.fr/polarDash.html\" + getITYCBoat(selRace.value),selRace.value),selRace.value)  ;\r\n        } \r\n    }*/\r\n}","import {tabSwitch} from \"./tab.js\"\r\nimport {changeState} from '../ui/common.js'\r\n\r\nexport function clickManager(ev)\r\n{\r\n\r\n\r\n    const ev_lbl = ev.target.id;\r\n    //sort management\r\n\r\n    var dosort = true;\r\n\r\n    //type of click\r\n    let call_rt = false;\r\n    let call_wi = false;\r\n    let call_pl = false;\r\n    let call_ityc = false;\r\n    let call_cp = false;\r\n    let call_vrzen = false;\r\n    let friend = false;\r\n    let tabsel = false;\r\n    let cbox = false;\r\n    let delNotif = false;\r\n    let rmatch = null;\r\n    const re_rtsp = new RegExp(\"^rt:(.+)\"); // Call-Router\r\n    const re_polr = new RegExp(\"^pl:(.+)\"); // Call-Polars\r\n    const re_wisp = new RegExp(\"^wi:(.+)\"); // Weather-Info\r\n    const re_ityc = new RegExp(\"^ityc:(.+)\"); // ITYC\r\n    const re_vrzen = new RegExp(\"^vrz:(.+)\"); // Call-Vrzen\r\n    const re_rsel = new RegExp(\"^rs:(.+)\"); // Race-Selection\r\n    const re_usel = new RegExp(\"^ui:(.+)\"); // User-Selection\r\n    const re_tsel = new RegExp(\"^ts:(.+)\"); // Tab-Selection\r\n    const re_cbox = new RegExp(\"^sel_(.+)\"); // Checkbox-Selection\r\n    const re_cpsp = new RegExp(\"^cp:(.+)\"); // Call-Compass\r\n    const re_ntdel = new RegExp(\"^notif_delete_(.+)\"); // Notif delete button\r\n\r\n    for (let node = ev.target; node; node = node.parentNode) {\r\n        const id = node.id;\r\n        let match;\r\n        if (re_rtsp.exec(id)) {\r\n            call_rt = true;\r\n        } else if (re_polr.exec(id)) {\r\n            call_pl = true;\r\n        } else if (re_wisp.exec(id)) {\r\n            call_wi = true;\r\n        } else if (re_ityc.exec(id)) {\r\n            call_ityc = true;\r\n        } else if (re_cpsp.exec(id)) {\r\n            call_cp = true;\r\n        } else if (re_vrzen.exec(id)) {\r\n            call_vrzen = true;  \r\n        } else if (match = re_rsel.exec(id)) {\r\n            rmatch = match[1];\r\n        } else if (match = re_usel.exec(id)) {\r\n            rmatch = match[1];\r\n            friend = true;\r\n        } else if (match = re_tsel.exec(id)) {\r\n            rmatch = match[1];\r\n            tabsel = true;\r\n        } else if (match = re_cbox.exec(id)) {\r\n            rmatch = match[1];\r\n            cbox = true;\r\n        } else if (match = re_ntdel.exec(id)) {\r\n            delNotif = true;\r\n            rmatch = id;\r\n        }\r\n    }\r\n    if(!rmatch) return;\r\n\r\n    if(tabsel) tabSwitch(rmatch); \r\n//    else if(friend) //Click line fleet\r\n    else if(cbox) {\r\n        changeState(ev_lbl);\r\n        tabSwitch();\r\n    }\r\n/*    else if(delNotif)\r\n        nf.deleteNotif(rmatch);\r\n    else if(call_rt) {\r\n        if(friend) callRouter(selRace.value, rmatch, false,\"zezo\");\r\n        else callRouter(rmatch, currentUserId, false,\"zezo\");\r\n    } else if(call_vrzen) {\r\n        if(friend) callRouter(selRace.value, rmatch, false,\"vrzen\");\r\n        else callRouter(rmatch, currentUserId, false,\"vrzen\");\r\n    } else if (call_wi) callWindy(rmatch, 0); // weather\r\n    else if (call_pl) callPolars(rmatch);\r\n    else if (call_ityc) callITYC(rmatch);\r\n    else if (call_cp) callCompass(selRace.value,currentUserId);\r\n*/    \r\n\r\n\r\n}\r\n/*\r\nfunction tableClick(ev) {\r\n    var call_rt = false;\r\n    var call_wi = false;\r\n    var call_pl = false;\r\n    var call_ityc = false;\r\n    var call_cp = false;\r\n    var call_vrzen = false;\r\n    var friend = false;\r\n    var tabsel = false;\r\n    var cbox = false;\r\n    var dosort = true;\r\n    var rmatch;\r\n    var re_rtsp = new RegExp(\"^rt:(.+)\"); // Call-Router\r\n    var re_polr = new RegExp(\"^pl:(.+)\"); // Call-Polars\r\n    var re_wisp = new RegExp(\"^wi:(.+)\"); // Weather-Info\r\n    var re_ityc = new RegExp(\"^ityc:(.+)\"); // ITYC\r\n    var re_vrzen = new RegExp(\"^vrz:(.+)\"); // Call-Vrzen\r\n    var re_rsel = new RegExp(\"^rs:(.+)\"); // Race-Selection\r\n    var re_usel = new RegExp(\"^ui:(.+)\"); // User-Selection\r\n    var re_tsel = new RegExp(\"^ts:(.+)\"); // Tab-Selection\r\n    var re_cbox = new RegExp(\"^sel_(.+)\"); // Checkbox-Selection\r\n    var re_cpsp = new RegExp(\"^cp:(.+)\"); // Call-Compass\r\n    var re_ntdel = new RegExp(\"^notif_delete_(.+)\"); // Notif delete button\r\n\r\n    var ev_lbl = ev.target.id;\r\n    switch (ev_lbl) {\r\n        case \"th_name\":\r\n            Util.set_sortField(\"displayName\");\r\n            break;\r\n        case \"th_teamname\":\r\n            Util.set_sortField(\"teamname\");\r\n            break;\r\n        case \"th_rank\":\r\n        case \"th_gap\":\r\n        case \"th_total\":   \r\n        Util.set_sortField(\"rank\");\r\n            break;\r\n        case \"th_gender\":\r\n            Util.set_sortField(\"genderType\");\r\n            break;    \r\n        case \"th_teamsize\":\r\n            Util.set_sortField(\"teamsize\");\r\n            break;\r\n        case \"th_skipper\":\r\n            Util.set_sortField(\"racing\");\r\n            break;\r\n        case \"th_raceRank\":\r\n            Util.set_sortField(\"raceRank\");\r\n            break;\r\n        case \"th_xOptions\":\r\n            Util.set_sortField(\"xOptions\");\r\n            break;               \r\n        case \"th_rankcategory\" :\r\n            Util.set_sortField(\"rankingCategory\");\r\n            break;               \r\n        case \"th_type\":\r\n            Util.set_sortField(\"type\");\r\n            break;                \r\n        case \"th_teamid\":\r\n            Util.set_sortField(\"teamId\");\r\n            break; \r\n\r\n        case \"th_lu\":\r\n            Util.set_sortField(\"lastCalcDate\");\r\n            break;\r\n        case \"th_sd\":\r\n            Util.set_sortField(\"startDate\");\r\n            break;\r\n        case \"th_racetime\":\r\n            Util.set_sortField(\"raceTime\");\r\n            break;\r\n        case \"th_eRT\":\r\n            Util.set_sortField(\"eRT\");\r\n            break;\r\n        case \"th_avgspeed\":\r\n            Util.set_sortField(\"avgSpeed\");\r\n            break;\r\n        case \"th_dtf\":\r\n            Util.set_sortField(\"dtf\");\r\n            break;\r\n        case \"th_dtu\":\r\n            Util.set_sortField(\"distanceToUs\");\r\n            break;\r\n        case \"th_state\":\r\n            Util.set_sortField(\"state\");\r\n            break;\r\n        case \"th_hdg\":\r\n            Util.set_sortField(\"heading\");\r\n            break;\r\n        case \"th_twa\":\r\n            Util.set_sortField(\"twa\");\r\n            break;\r\n        case \"th_tws\":\r\n            Util.set_sortField(\"tws\");\r\n            break;\r\n        case \"th_twd\":\r\n            Util.set_sortField(\"twd\");\r\n            break;\r\n        case \"th_speed\":\r\n            Util.set_sortField(\"speed\");\r\n            break;\r\n        case \"th_vmg\":\r\n            Util.set_sortField(\"vmg\");\r\n            break;\r\n        case \"th_sail\":\r\n            Util.set_sortField(\"sail\");\r\n            break;\r\n        case \"th_factor\":\r\n            Util.set_sortField(\"xfactor\");\r\n            break;\r\n        case \"th_foils\":\r\n            Util.set_sortField(\"xoption_foils\");\r\n            break;\r\n        case \"th_flag\":\r\n            Util.set_sortField(\"country\");\r\n            break;                \r\n        case \"th_options\":\r\n            Util.set_sortField(\"xoption_options\");\r\n            break;\r\n        case \"th_stamina\":\r\n            Util.set_sortField(\"stamina\");\r\n            break;\r\n        case \"th_brg\":\r\n        //case \"th_psn\":\r\n        //case \"th_foils\":\r\n            Util.set_sortField(\"none\");\r\n            break;\r\n        default:\r\n            dosort = false;\r\n    }\r\n\r\n    // Sort friends table\r\n    if (dosort) {\r\n        if (Util.sortField == currentSortField) {\r\n            Util.set_currentSortOrder(1 - Util.currentSortOrder);\r\n        } else {\r\n            currentSortField = Util.sortField;\r\n            Util.set_currentSortOrder(0);\r\n        }            \r\n        if (originClick == 2) {\r\n            updateFleetHTML(raceFleetMap.get(selRace.value));\r\n        } \r\n\r\n    }\r\n\r\n    for (var node = ev.target; node; node = node.parentNode) {\r\n        var id = node.id;\r\n        var match;\r\n        if (re_rtsp.exec(id)) {\r\n            call_rt = true;\r\n        } else if (re_polr.exec(id)) {\r\n            call_pl = true;\r\n        } else if (re_wisp.exec(id)) {\r\n            call_wi = true;\r\n        } else if (re_ityc.exec(id)) {\r\n            call_ityc = true;\r\n        } else if (re_cpsp.exec(id)) {\r\n            call_cp = true;\r\n        } else if (re_vrzen.exec(id)) {\r\n            call_vrzen = true;  \r\n        } else if (match = re_rsel.exec(id)) {\r\n            rmatch = match[1];\r\n        } else if (match = re_usel.exec(id)) {\r\n            rmatch = match[1];\r\n            friend = true;\r\n        } else if (match = re_tsel.exec(id)) {\r\n            rmatch = match[1];\r\n            tabsel = true;\r\n        } else if (match = re_cbox.exec(id)) {\r\n            rmatch = match[1];\r\n            cbox = true;\r\n        } else if (match = re_ntdel.exec(id)) {\r\n            nf.deleteNotif(id);\r\n        }\r\n\r\n    }\r\n    if (rmatch) {\r\n        if (tabsel) {\r\n            // Tab-Selection\r\n            originClick= rmatch ;\r\n         //   EX.extraRoute(\"hidden\");\r\n            display_selbox(\"hidden\");\r\n            for (var t = 1; t <= nbTabs; t++) {\r\n                if(t==3)\r\n                    document.getElementById(\"tab-content\" + t).style.display = (rmatch == t ? \"flex\" : \"none\");\r\n                else document.getElementById(\"tab-content\" + t).style.display = (rmatch == t ? \"block\" : \"none\");\r\n            }\r\n            if (rmatch == 2) {\r\n                \r\n                updateFleetHTML(raceFleetMap.get(selRace.value));\r\n                display_selbox(\"visible\");\r\n            } else if (rmatch == 3) {\r\n                var race = races.get(selRace.value);\r\n                rt.updateFleet(race,raceFleetMap);\r\n                initializeMap(race);\r\n                EX.extraRoute(\"visible\");\r\n                display_selbox(\"visible\");\r\n            } else if (rmatch == 4) {\r\n                buildlogBookHTML(races.get(selRace.value));\r\n            } else if (rmatch == 5) {\r\n                var race = races.get(selRace.value);\r\n                if(race && race.recordedData) {\r\n                    gr.upDateGraph(race.recordedData);\r\n                }\r\n            } else if (rmatch == 6) {\r\n                nf.showList();\r\n            } else if (rmatch == 8) {\r\n//                 updateUserConfigHTML();\r\n            }  else if (rmatch == 9) {\r\n                document.getElementById('ityc_frame').src = getITYCFullExtra(getITYCFull(\"https://ityc.fr/polarDash.html\" + getITYCBoat(selRace.value),selRace.value),selRace.value)  ;\r\n            } \r\n        } else if (friend) {\r\n            // Friend-Routing\r\n            if (call_rt) callRouter(selRace.value, rmatch, false,\"zezo\");\r\n            else if (call_vrzen) callRouter(selRace.value, rmatch, false,\"vrzen\");\r\n        } else if (cbox) {\r\n            // Skippers-Choice\r\n            if(ev_lbl == \"sel_ExportFleet\") {onFleetInCpyClipBoard();return;}\r\n            changeState(ev_lbl);\r\n        } else if (call_wi) callWindy(rmatch, 0); // weather\r\n        else if (call_rt) callRouter(rmatch, currentUserId, false,\"zezo\");\r\n        else if (call_pl) callPolars(rmatch);\r\n        else if (call_ityc) callITYC(rmatch);\r\n        else if (call_cp) callCompass(selRace.value,currentUserId);\r\n        else if (call_vrzen) callRouter(rmatch, currentUserId, false,\"vrzen\");\r\n\r\n        else\r\n        {\r\n\r\n            // Race-Switching\r\n            enableRace(rmatch, true);\r\n            changeRace(rmatch);\r\n        }\r\n    }\r\n}\r\n\r\n*/\r\n\r\n\r\n","\r\nimport {getUserPrefs, saveUserPrefs} from \"../../common/userPrefs.js\"\r\n\r\nimport {switchTheme} from \"../ui/common.js\"\r\nimport {clickManager} from './clickManager.js'\r\n\r\n\r\n/**\r\n * Initialise des √©l√©ments UI avec gestion automatique des events et init\r\n * @param {Object[]} items - Liste de configuration\r\n * @param {string} items[].selector - S√©lecteur CSS de l'√©l√©ment\r\n * @param {(value: any, el: HTMLElement) => void} items[].onChange - Callback d√©clench√© sur changement ou clic\r\n * @param {(value: any, el: HTMLElement) => void} [items[].onInit] - Callback d√©clench√© √† l'initialisation\r\n */\r\nfunction initUIBindings(items) {\r\n  items.forEach(({ selector, onChange, onInit }) => {\r\n    const el = document.querySelector(selector);\r\n    if (!el) {\r\n      console.warn(`‚ö†Ô∏è √âl√©ment non trouv√© pour ${selector}`);\r\n      return;\r\n    }\r\n\r\n    // --- D√©termine le type d'√©v√©nement √† √©couter ---\r\n    let eventType = 'change';\r\n    if (el.tagName === 'BUTTON' || el.tagName === 'IMG') {\r\n      eventType = 'click';\r\n    } else if (el.tagName === 'INPUT') {\r\n      const type = el.getAttribute('type') || 'text';\r\n      if (['button', 'submit', 'image'].includes(type)) eventType = 'click';\r\n      else if (['number', 'text', 'range'].includes(type)) eventType = 'input';\r\n      else eventType = 'change';\r\n    }\r\n\r\n    // --- Fonction pour extraire la valeur coh√©rente ---\r\n    const getValue = () => {\r\n      if (el.tagName === 'IMG') return el.src;\r\n      if (el.tagName === 'SELECT') return el.value;\r\n      if (el.tagName === 'BUTTON') return el.value || el.textContent;\r\n      if (el.tagName === 'INPUT') {\r\n        switch (el.type) {\r\n          case 'checkbox': return el.checked;\r\n          case 'number': return parseFloat(el.value);\r\n          default: return el.value;\r\n        }\r\n      }\r\n      return null;\r\n    };\r\n\r\n    // --- Ajout du listener ---\r\n    el.addEventListener(eventType, () => {\r\n      const val = getValue();\r\n      onChange?.(val, el);\r\n    });\r\n\r\n    // --- Ex√©cution du callback d'init ---\r\n    if (typeof onInit === 'function') {\r\n      onInit(getValue(), el);\r\n    }\r\n  });\r\n}\r\n\r\nexport function uiBindingInit() {\r\n  document.addEventListener(\"click\", clickManager);\r\n  initUIBindings([\r\n    {\r\n      selector: '#sel_race',\r\n      onChange: (value) => {/*'internal', 'lastOpennedRace')*/},\r\n      onInit: (value, el) => { el.value = 0;}\r\n    },\r\n/*    {\r\n      selector: '#sel_lang',\r\n      onChange: (value) => {const userPrefs = getUserPrefs(); userPrefs.lang = value;saveUserPrefs(userPrefs);},\r\n      onInit: (value, el) => {const userPrefs = getUserPrefs();  el.value = userPrefs.lang}\r\n    },*/\r\n    {\r\n      selector: '#auto_router',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.router.auto = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.router.auto }\r\n    },\r\n    {\r\n      selector: '#sel_router',\r\n      onChange: (value) => {const userPrefs = getUserPrefs(); userPrefs.router.sel = value;saveUserPrefs(userPrefs);},\r\n      onInit: (value, el) => {const userPrefs = getUserPrefs();  el.value = userPrefs.router.sel}\r\n    },\r\n    {\r\n      selector: '#nmea_output',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.nmea.enable = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.nmea.enable }\r\n    },\r\n    {\r\n      selector: '#sel_nmeaport',\r\n      onChange: (value) => {const userPrefs = getUserPrefs(); userPrefs.nmea.port = value;saveUserPrefs(userPrefs);},\r\n      onInit: (value, el) => {const userPrefs = getUserPrefs();  el.value = userPrefs.nmea.port}\r\n    },\r\n    {\r\n      selector: '#color_theme',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.theme = checked?\"dark\":\"light\";saveUserPrefs(userPrefs);switchTheme(userPrefs.theme);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.theme==\"dark\" }\r\n    },\r\n    {\r\n      selector: '#reuse_tab',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.global.reuseTab = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.global.reuseTab }\r\n    },\r\n    {\r\n      selector: '#local_time',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.global.localTime = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.global.localTime }\r\n    },\r\n    {\r\n      selector: '#uiFilterMode',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.global.alternateFilter = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.global.alternateFilter }\r\n    },\r\n    {\r\n      selector: '#vrzenPositionFormat',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.global.separatorPos = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.global.separatorPos }\r\n    },\r\n    {\r\n      selector: '#ITYC_record',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.global.ITYCSend = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.global.ITYCSend }\r\n    },\r\n    {\r\n      selector: '#sel_polarSite',\r\n      onChange: (value) => {const userPrefs = getUserPrefs(); userPrefs.global.polarSite = value;saveUserPrefs(userPrefs);},\r\n      onInit: (value, el) => {const userPrefs = getUserPrefs();  el.value = userPrefs.global.polarSite}\r\n    },\r\n    {\r\n      selector: '#fullScreen_Size',\r\n      onChange: (value) => {const userPrefs = getUserPrefs(); userPrefs.drawing.ratio = value;saveUserPrefs(userPrefs);},\r\n      onInit: (value, el) => {const userPrefs = getUserPrefs();  el.value = userPrefs.drawing.ratio}\r\n    },\r\n    {\r\n      selector: '#fullScreen_Game',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.drawing.fullScreen = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.drawing.fullScreen }\r\n    },\r\n    {\r\n      selector: '#showBVMGSpeed',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceData.VMGSpeed = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceData.VMGSpeed }\r\n    },\r\n    {\r\n      selector: '#with_LastCommand',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceData.lastCmd = checked;saveUserPrefs(userPrefs);},//todo add racestatus redraw\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceData.lastCmd }\r\n    },\r\n    {\r\n      selector: '#hideCommandsLines',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.hideLastCmd = checked;saveUserPrefs(userPrefs);},//todo add racelog redraw\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.hideLastCmd }\r\n    },\r\n    {\r\n      selector: '#racelog_rank',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.column.rank = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.column.rank }\r\n    },\r\n    {\r\n      selector: '#racelog_dtl',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.column.DTL = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.column.DTL }\r\n    },\r\n    {\r\n      selector: '#racelog_dtf',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.column.DTF = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.column.DTF }\r\n    },\r\n    {\r\n      selector: '#racelog_reportedSpeed',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.column.vR = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.column.vR }\r\n    },\r\n    {\r\n      selector: '#racelog_calcSpeed',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.column.vC = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.column.vC }\r\n    },\r\n    {\r\n      selector: '#racelog_foils',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.column.foil = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.column.foil }\r\n    },\r\n\r\n    {\r\n      selector: '#racelog_factor',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.column.factor = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.column.factor }\r\n    },\r\n\r\n    {\r\n      selector: '#racelog_stamina',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.column.stamina = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.column.stamina }\r\n    },\r\n    {\r\n      selector: '#racelog_deltaDistance',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.column.deltaD = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.column.deltaD }\r\n    },\r\n    {\r\n      selector: '#racelog_deltaTime',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.column.deltaT = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.column.deltaT }\r\n    },\r\n    {\r\n      selector: '#racelog_position',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.raceLog.column.position = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.raceLog.column.position }\r\n    },\r\n    {\r\n      selector: '#track_infos',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.map.trace = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.map.trace }\r\n    },    \r\n    {\r\n      selector: '#projectionLine_Size',\r\n      onChange: (value) => {const userPrefs = getUserPrefs(); userPrefs.map.projectionLineLenght = value;saveUserPrefs(userPrefs);},\r\n      onInit: (value, el) => {const userPrefs = getUserPrefs();  el.value = userPrefs.map.projectionLineLenght}\r\n    },\r\n    {\r\n      selector: '#view_InvisibleDoors',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.map.invisibleBuoy = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.map.invisibleBuoy }\r\n    },\r\n    {\r\n      selector: '#sel_showMarkersLmap',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.map.showMarkers = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.map.showMarkers }\r\n    },\r\n    {\r\n      selector: '#sel_showTracksLmap',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.map.showTracks = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.map.showTracks }\r\n    },  \r\n    {\r\n      selector: '#sel_borderColorLmap',\r\n      onChange: (value) => {const userPrefs = getUserPrefs(); userPrefs.map.borderColor = value;saveUserPrefs(userPrefs);},\r\n      onInit: (value, el) => {const userPrefs = getUserPrefs();  el.value = userPrefs.map.borderColor}\r\n    },  \r\n    {\r\n      selector: '#sel_projectionColorLmap',\r\n      onChange: (value) => {const userPrefs = getUserPrefs(); userPrefs.map.projectionColor = value;saveUserPrefs(userPrefs);},\r\n      onInit: (value, el) => {const userPrefs = getUserPrefs();  el.value = userPrefs.map.projectionColor}\r\n    },\r\n    {\r\n      selector: '#abbreviatedOption',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.shortOption = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.shortOption }\r\n    },\r\n    {\r\n      selector: '#auto_clean',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.cleaning = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.cleaning }\r\n    },  \r\n    {\r\n      selector: '#auto_cleanInterval',\r\n      onChange: (value) => {const userPrefs = getUserPrefs(); userPrefs.map.cleaningInterval = value;saveUserPrefs(userPrefs);},\r\n      onInit: (value, el) => {const userPrefs = getUserPrefs();  el.value = userPrefs.map.cleaningInterval}\r\n    },\r\n    {\r\n      selector: '#sailRankRaceId',\r\n      onChange: (value) => {const userPrefs = getUserPrefs(); userPrefs.map.sailRankId = value;saveUserPrefs(userPrefs);},\r\n      onInit: (value, el) => {const userPrefs = getUserPrefs();  el.value = userPrefs.map.sailRankId}\r\n    },\r\n    {\r\n      selector: '#fleet_team',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.team = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.team }\r\n    },  \r\n    {\r\n      selector: '#fleet_rank',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.rank = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.rank }\r\n    },  \r\n    {\r\n      selector: '#fleet_racetime',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.raceTime = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.raceTime }\r\n    },  \r\n    {\r\n      selector: '#fleet_dtu',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.DTU = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.DTU }\r\n    },  \r\n    {\r\n      selector: '#fleet_dtf',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.DTF = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.DTF }\r\n    },  \r\n    {\r\n      selector: '#fleet_twd',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.TWD = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.TWD }\r\n    },  \r\n    {\r\n      selector: '#fleet_tws',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.TWS = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.TWS }\r\n    },  \r\n    {\r\n      selector: '#fleet_twa',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.TWA = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.TWA }\r\n    },  \r\n    {\r\n      selector: '#fleet_hdg',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.HDG = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.HDG }\r\n    },  \r\n    {\r\n      selector: '#fleet_speed',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.speed = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.speed }\r\n    },  \r\n    {\r\n      selector: '#fleet_vmg',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.VMG = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.VMG }\r\n    },\r\n    {\r\n      selector: '#fleet_sail',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.sail = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.sail }\r\n    },  \r\n    {\r\n      selector: '#fleet_factor',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.factor = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.factor }\r\n    },  \r\n    {\r\n      selector: '#fleet_foils',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.foil = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.foil }\r\n    },  \r\n    {\r\n      selector: '#fleet_position',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.position = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.position }\r\n    },  \r\n    {\r\n      selector: '#fleet_options',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.option = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.option }\r\n    },  \r\n    {\r\n      selector: '#fleet_state',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.state = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.state }\r\n    },  \r\n    {\r\n      selector: '#fleet_remove',\r\n      onChange: (checked) => {const userPrefs = getUserPrefs(); userPrefs.fleet.column.select = checked;saveUserPrefs(userPrefs);},\r\n      onInit: (checked, el) => {const userPrefs = getUserPrefs();  el.checked = userPrefs.fleet.column.select }\r\n    },   \r\n    {\r\n      selector: '#sel_Seperator',\r\n      onChange: (value) => {const userPrefs = getUserPrefs(); userPrefs.separator = value;saveUserPrefs(userPrefs);},\r\n      onInit: (value, el) => {const userPrefs = getUserPrefs();  el.value = userPrefs.separator}\r\n    },\r\n    {\r\n      selector: '#bt_router',\r\n      onChange: () => {/*todo call routerPage*/}\r\n    },\r\n\r\n  ]);\r\n}\r\n","\r\nimport './css/style.css';\r\n\r\nimport {createKeyChangeListener} from '../common/dbOpes.js';\r\n\r\nimport {getConnectedPlayerId,setConnectedPlayerId,updateConnectedPlayerInfos,\r\ngetLegListUpdate, setLegListUpdate, updateLegList,\r\ngetPlayersUpdate, setPlayersUpdate, updatePlayersList,\r\ngetTeamsUpdate, setTeamsUpdate, updateTeamsList,\r\ngetPolarsUpdate, setPolarsUpdate, updatePolar,\r\ngetLegPlayersInfosUpdate, setLegPlayersInfosUpdate, updateLegPlayerInfos,\r\ngetLegPlayersOrderUpdate, setLegPlayersOrderUpdate, updateLegPlayersOrder,\r\ngetLegFleetInfosUpdate, setLegFleetInfosUpdate, updateLegFleetInfos,\r\ngetLegPlayersOptionsUpdate, setLegPlayersOptionsUpdate, updateLegPlayersOptions,\r\ngetOpenedRaceId, setOpenedRaceId, updateOpenedRaceId,\r\ninitMemo\r\n\r\n} from './app/memoData.js'\r\nimport {loadUserPrefs, getUserPrefs} from '../common/userPrefs.js'\r\nimport {onPlayerConnect, updateRaceListDisplay,onRaceOpen} from './ui/header.js'\r\nimport {buildRaceStatusHtml} from './ui/raceStatus.js'\r\nimport {uiBindingInit} from'./app/binding.js'\r\nimport {tabSwitch} from'./app/tab.js'\r\n\r\n\r\nlet initDone = null;\r\nlet upDateDisplay =false;\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n    console.log('‚úÖ DOM start !');\r\n    await loadUserPrefs();\r\n    await initMemo();\r\n    onPlayerConnect();\r\n    doDbListener();\r\n    updateRaceListDisplay(); \r\n    uiBindingInit();\r\n    buildRaceStatusHtml();\r\n    tabSwitch();\r\n    onRaceOpen();\r\n    initDone = true;\r\n    const repeater = startRepeating(() => {\r\n        if(upDateDisplay)\r\n        {\r\n            tabSwitch();\r\n            upDateDisplay = false;\r\n          console.log(\"‚è∞ Display update \", new Date().toLocaleTimeString());\r\n        }\r\n    }, 5000);\r\n\r\n// Pour l‚Äôarr√™ter plus tard :\r\nsetTimeout(() => repeater.stop(), 20000); // stop apr√®s 20s\r\n});\r\n\r\nfunction doDbListener() \r\n{\r\n    const connectedUserListener = createKeyChangeListener('internal', 'lastLoggedUser');\r\n\r\nconnectedUserListener.start({\r\n    referenceValue: {loggedUser : getConnectedPlayerId()},\r\n    onChange: async ({ oldValue, newValue }) => {\r\n        if(newValue.loggedUser && initDone) {\r\n            setConnectedPlayerId(newValue.loggedUser);\r\n            await updatePlayersList();\r\n            await updateTeamsList();\r\n            await updateConnectedPlayerInfos();\r\n            await updateLegPlayerInfos();\r\n            await updateLegPlayersOrder();\r\n\r\n            onPlayerConnect();    \r\n        }\r\n    }\r\n});\r\n\r\nconst connectedLeglistListener = createKeyChangeListener('internal', 'legListUpdate');\r\nconnectedLeglistListener.start({\r\n    referenceValue: {ts : getLegListUpdate()},\r\n    onChange: async ({ oldValue, newValue }) => {\r\n        if(newValue?.ts != getLegListUpdate() && initDone)\r\n        {   //updated infos\r\n            setLegListUpdate(newValue.ts);\r\n            await updateLegList();\r\n            await updatePolar();\r\n            updateRaceListDisplay(); \r\n            //update display map, fleet racestatus,, race book \r\n            buildRaceStatusHtml();\r\n            tabSwitch();\r\n        }\r\n    }\r\n});\r\nconst connectedPlayersListener = createKeyChangeListener('internal', 'playersUpdate');\r\nconnectedPlayersListener.start({\r\n    referenceValue: {ts : getPlayersUpdate()},\r\n    onChange: async ({ oldValue, newValue }) => {\r\n        if(newValue?.ts != getPlayersUpdate() && initDone)\r\n        {   //updated infos\r\n            setPlayersUpdate(newValue.ts);\r\n            await updatePlayersList();\r\n            await updateTeamsList();\r\n            await updateConnectedPlayerInfos();\r\n            await updateLegFleetInfos();\r\n            await updateLegPlayerInfos();\r\n            await updateLegPlayersOrder();\r\n            tabSwitch();\r\n            //update display connectedUser Fleet\r\n        }\r\n    }\r\n});\r\n\r\nconst teamsListener = createKeyChangeListener('internal', 'teamsUpdate');\r\nteamsListener.start({\r\n    referenceValue: {ts : getTeamsUpdate()},\r\n    onChange: async ({ oldValue, newValue }) => {\r\n        if(newValue?.ts != getTeamsUpdate() && initDone)\r\n        {   //updated infos\r\n            setTeamsUpdate(newValue.ts);\r\n            await updateTeamsList();\r\n            await updateConnectedPlayerInfos();\r\n            await updateLegFleetInfos();\r\n            await updateLegPlayerInfos();\r\n            await updateLegPlayersOrder();\r\n            tabSwitch();\r\n            //update display connectedUser Fleet\r\n        }\r\n    }\r\n});\r\n\r\n\r\nconst polarListener = createKeyChangeListener('internal', 'polarsUpdate');\r\npolarListener.start({\r\n    referenceValue: {ts : getPolarsUpdate()},\r\n    onChange: async ({ oldValue, newValue }) => {\r\n        if(newValue?.ts != getPolarsUpdate() && initDone)\r\n        {   //updated infos\r\n            setPolarsUpdate(newValue.ts);\r\n            await updatePolar();\r\n            tabSwitch();\r\n            //update display connectedUser Fleet polar page\r\n        }\r\n    }\r\n});\r\n\r\nconst legPlayerInfosListener = createKeyChangeListener('internal', 'legPlayersInfosDashUpdate');\r\nlegPlayerInfosListener.start({\r\n    referenceValue: {ts : getLegPlayersInfosUpdate()},\r\n    onChange: async ({ oldValue, newValue }) => {\r\n        if(newValue?.ts != getLegPlayersInfosUpdate() && initDone)\r\n        {   //updated infos\r\n            setLegPlayersInfosUpdate(newValue.ts);\r\n            await updateLegPlayerInfos();\r\n            await updateLegPlayersOrder();      \r\n            buildRaceStatusHtml();\r\n            tabSwitch();\r\n            //update display Fleet\r\n        }\r\n    }\r\n});\r\n\r\nconst legFleetInfosListener = createKeyChangeListener('internal', 'legFleetInfosDashUpdate');\r\nlegFleetInfosListener.start({\r\n    referenceValue: {ts : getLegFleetInfosUpdate()},\r\n    onChange: async ({ oldValue, newValue }) => {\r\n        if(newValue?.ts != getLegFleetInfosUpdate() && initDone)\r\n        {   //updated infos\r\n            setLegFleetInfosUpdate(newValue.ts);\r\n            await updateLegFleetInfos();\r\n            //update display Fleet\r\n            buildRaceStatusHtml();\r\n            tabSwitch();\r\n        }\r\n    }\r\n});\r\n\r\nconst legPlayersOptionsListener = createKeyChangeListener('internal', 'legPlayersOptionsUpdate');\r\nlegPlayersOptionsListener.start({\r\n    referenceValue: {ts : getLegPlayersOptionsUpdate()},\r\n    onChange: async ({ oldValue, newValue }) => {\r\n        if(newValue?.ts != getLegPlayersOptionsUpdate() && initDone)\r\n        {   //updated infos\r\n            setLegPlayersOptionsUpdate(newValue.ts);\r\n            await updateLegPlayersOptions();\r\n            tabSwitch();\r\n//            await updateLegPlayerInfos();\r\n//            await updateLegPlayersOrder();\r\n//            await updateLegFleetInfos();\r\n            //update display Fleet\r\n        }\r\n    }\r\n});\r\n\r\nconst legPlayersOrdersListener = createKeyChangeListener('internal', 'legPlayersOrderUpdate');\r\nlegPlayersOrdersListener.start({\r\n    referenceValue: {ts : getLegPlayersOrderUpdate()},\r\n\r\n  onChange: async ({ oldValue, newValue }) => {\r\n    if(newValue?.ts != getLegPlayersOptionsUpdate() && initDone)\r\n    {   //updated infos\r\n        await updateLegPlayersOrder();\r\n        buildRaceStatusHtml();\r\n        tabSwitch();\r\n        //update display raceLog map,raceStatus\r\n    }\r\n  },\r\n});\r\n\r\nconst connectedRaceListener = createKeyChangeListener('internal', 'lastOpennedRace');\r\nconnectedRaceListener.start({\r\n  referenceValue: (() => {\r\n    const opened = getOpenedRaceId?.();\r\n    return {\r\n      raceId: opened?.raceId ?? null,\r\n      legNum: opened?.legNum ?? null,\r\n    };\r\n  })(),\r\n\r\n  onChange: async ({ oldValue, newValue }) => {\r\n    const openedRace = getOpenedRaceId?.();\r\n\r\n    const sameRace =\r\n      newValue?.raceId === openedRace?.raceId &&\r\n      newValue?.legNum === openedRace?.legNum;\r\n\r\n    if (!sameRace && initDone) {\r\n      // üîÑ Mise √† jour des infos de course\r\n      setOpenedRaceId(newValue?.raceId, newValue?.legNum);\r\n      await updateOpenedRaceId();\r\n      await updatePolar();\r\n      await updateLegPlayersOptions();\r\n      await updateLegFleetInfos();\r\n      await updateLegPlayerInfos();\r\n      await updateLegPlayersOrder();\r\n      onRaceOpen();\r\n      buildRaceStatusHtml();\r\n      tabSwitch();\r\n    }\r\n  },\r\n});\r\n}\r\n/* */\r\n//updateRaceList\r\n\r\nfunction startRepeating(callback, interval = 5000) {\r\n  // Lancer imm√©diatement la premi√®re ex√©cution (facultatif)\r\n  callback();\r\n\r\n  // Puis toutes les 5 secondes\r\n  const id = setInterval(callback, interval);\r\n\r\n  return {\r\n    stop() {\r\n      clearInterval(id);\r\n      console.log(\"‚èπÔ∏è Interval stopped\");\r\n    }\r\n  };\r\n}\r\n\r\n"],"names":["map","getLegPlayersOrder","raceInfo","raceList","openedRaceIdHistory","legPlayerInfosHistory","paramStamina","iteDash","isDisplayEnabled","sortField","connectedPlayerId","category","categoryStyleDark","categoryStyle","sailColors","localTimes","r","_a","hasProj4Leaflet","lat","lon","pos","layer","buildCircle","playersList","optionsRuler","playerItes","raceItesFleet"],"mappings":"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"}