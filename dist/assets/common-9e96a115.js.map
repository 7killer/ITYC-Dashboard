{"version":3,"file":"common-9e96a115.js","sources":["../../node_modules/.pnpm/idb@7.1.1/node_modules/idb/build/wrap-idb-value.js","../../node_modules/.pnpm/idb@7.1.1/node_modules/idb/build/index.js","../../src/common/paramStamina.js","../../src/common/dbOpes.js","../../src/common/userPrefs.js","../../src/common/utils.js","../../src/dashboard/ui/constant.js","../../src/dashboard/ui/common.js"],"sourcesContent":["const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n","import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n","export const paramStamina = {\r\n\t\"recovery\":{\r\n\t\t\"points\":1,\r\n\t\t\"loWind\":0,\r\n\t\t\"hiWind\":30,\r\n\t\t\"loTime\":5,\r\n\t\t\"hiTime\":15\r\n\t},\r\n\t\"tiredness\":[20,50],\r\n\t\"consumption\":{\r\n\t\t\"points\":{\r\n\t\t\t\"tack\":10,\r\n\t\t\t\"gybe\":10,\r\n\t\t\t\"sail\":20\r\n\t\t},\r\n\t\t\"winds\":{\r\n\t\t\t\"0\":1,\r\n\t\t\t\"10\":1.2,\r\n\t\t\t\"20\":1.5,\r\n\t\t\t\"30\":2\r\n\t\t},\r\n\t\t\"boats\":{\r\n\t\t\t\"0\":1,\r\n\t\t\t\"5\":1.2,\r\n\t\t\t\"15\":1.5,\r\n\t\t\t\"50\":2\r\n\t\t}\r\n\t},\r\n\t\"impact\":{\r\n\t\t\"0\":2,\r\n\t\t\"100\":0.5\r\n\t\t}\r\n\t}\r\n\t","import { openDB, deleteDB } from 'idb';\r\nimport { paramStamina } from'./paramStamina.js';\r\nimport cfg from '@/config.json';\r\n\r\n\r\nconst DB_NAME = 'VRDashboardDB3';\r\nconst DB_VERSION = 5;\r\n\r\nexport async function openDatabase() {\r\n    try {\r\n        return await openDB(DB_NAME, DB_VERSION, {\r\n            upgrade(db) {\r\n                if (!db.objectStoreNames.contains('internal')) {\r\n                    const store = db.createObjectStore('internal', { keyPath: 'id' });\r\n                    if(cfg.debugDB) console.log('Created \"internal\" object store');\r\n              \r\n                    store.add({\r\n//                      key: \"paramStamina\",\r\n                      id: \"paramStamina\",\r\n                      paramStamina: paramStamina\r\n                    }) ;\r\n                    store.add({\r\n                        id : 'lastLoggedUser',\r\n                        loggedUser : null\r\n                    });\r\n                    store.add({\r\n                        id : 'lastOpennedRace',\r\n                        raceId : null,\r\n                        legNum : null,\r\n                        lastOpennedRace : null\r\n                    });\r\n                    store.add({\r\n                        id: \"playersUpdate\",\r\n                        ts: Date.now()\r\n                    });\r\n                    store.add({\r\n                        id: \"teamsUpdate\",\r\n                        ts: Date.now()\r\n                    });\r\n                    store.add({\r\n                        id: \"polarsUpdate\",\r\n                        ts: Date.now()\r\n                    });\r\n                    store.add({\r\n                        id: \"legListUpdate\",\r\n                        ts: Date.now()\r\n                    });\r\n                    store.add({\r\n                        id: \"legFleetInfosUpdate\",\r\n                        ts: Date.now()\r\n                    });\r\n                    store.add({\r\n                        id: \"legPlayersInfosUpdate\",\r\n                        ts: Date.now()\r\n                    });\r\n                    store.add({\r\n                        id: \"legFleetInfosDashUpdate\",\r\n                        ts: Date.now()\r\n                    });\r\n                    store.add({\r\n                        id: \"legPlayersInfosDashUpdate\",\r\n                        ts: Date.now()\r\n                    });\r\n                    store.add({\r\n                        id: \"legPlayersOptionsUpdate\",\r\n                        ts: Date.now()\r\n                    });\r\n                    store.add({\r\n                        id: \"legPlayersOrderUpdate\",\r\n                        ts: Date.now()\r\n                    });\r\n                    store.add({\r\n                        id: \"state\",\r\n                        state: 'dashInstalled'\r\n                    });\r\n                }\r\n                if (!db.objectStoreNames.contains('players')) {\r\n                    db.createObjectStore('players', { keyPath: 'id' });\r\n                    if(cfg.debugDB) console.log('Created \"players\" object store');\r\n                }\r\n                if (!db.objectStoreNames.contains('teams')) {\r\n                    db.createObjectStore('teams', { keyPath: 'id' });\r\n                    if(cfg.debugDB) console.log('Created \"teams\" object store');\r\n                }\r\n                if (!db.objectStoreNames.contains('polars')) {\r\n                    db.createObjectStore('polars', { keyPath: 'id' });\r\n                    if(cfg.debugDB) console.log('Created \"polars\" object store');\r\n                }\r\n                if (!db.objectStoreNames.contains('legList')) {\r\n                    const store = db.createObjectStore('legList', {\r\n                         keyPath: ['raceId', 'legNum']  });\r\n                    if(cfg.debugDB) console.log('Created \"legList\" object store');\r\n                }\r\n                if (!db.objectStoreNames.contains('legFleetInfos')) {\r\n                    const store = db.createObjectStore('legFleetInfos', {\r\n                         keyPath: ['raceId', 'legNum', 'userId', 'iteDate']  });\r\n                    store.createIndex('byTriplet', ['raceId', 'legNum', 'userId'], { unique: false });\r\n                    if(cfg.debugDB) console.log('Created \"legFleetInfos\" object store');\r\n                }\r\n                if (!db.objectStoreNames.contains('legPlayersInfos')) {\r\n                    const store = db.createObjectStore('legPlayersInfos', {\r\n                         keyPath: ['raceId', 'legNum', 'userId', 'iteDate']  });\r\n                    store.createIndex('byTriplet', ['raceId', 'legNum', 'userId'], { unique: false });\r\n                    if(cfg.debugDB) console.log('Created \"legPlayersInfos\" object store');\r\n                }\r\n                if (!db.objectStoreNames.contains('legPlayersOrder')) {\r\n                    const store = db.createObjectStore('legPlayersOrder', {\r\n                         keyPath: ['raceId', 'legNum', 'userId', 'iteDate']  });\r\n                    store.createIndex('byTriplet', ['raceId', 'legNum', 'userId'], { unique: false });\r\n                    if(cfg.debugDB) console.log('Created \"legPlayersOrder\" object store');\r\n                }\r\n                if (!db.objectStoreNames.contains('legPlayersOptions')) {\r\n                    const store = db.createObjectStore('legPlayersOptions', {\r\n                         keyPath: ['raceId', 'legNum', 'userId']  });\r\n                    store.createIndex('byTriplet', ['raceId', 'legNum', 'userId'], { unique: false });\r\n                    store.createIndex('byRaceLeg', ['raceId', 'legNum'], { unique: false }); \r\n                    if(cfg.debugDB) console.log('Created \"legPlayersOptions\" object store');\r\n                }\r\n                \r\n\r\n\r\n            }\r\n        });\r\n    } catch (error) {\r\n        if(cfg.debugDBErr) console.error('Error opening database:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function putData(storeName, data) {\r\n    try {\r\n        const db = await openDatabase();\r\n        const tx = db.transaction(storeName, 'readwrite');\r\n        const store = tx.objectStore(storeName);\r\n        \r\n        await store.put(data);\r\n        await tx.done;\r\n        db.close();\r\n        \r\n        if(cfg.debugDB) console.log(`Data successfully added to ${storeName}:`, data);\r\n    } catch (error) {\r\n        if(cfg.debugDBErr) console.error(`Error adding data to ${storeName}:`, error);\r\n        throw error;\r\n    }\r\n}\r\nexport async function putOrUpdate(storeName, data, key) {\r\n    try {\r\n        const db = await openDatabase();\r\n        const tx = db.transaction(storeName, 'readwrite');\r\n        const store = tx.objectStore(storeName);\r\n        const hasInlineKey = !!store.keyPath;\r\n\r\n        // üß© Cas 1 : cl√© inline (keyPath d√©fini)\r\n        if (hasInlineKey) {\r\n        const keyPath = store.keyPath;\r\n\r\n        // V√©rifie que la cl√© existe dans l'objet\r\n        if (typeof keyPath === 'string' && (data[keyPath] === undefined || data[keyPath] === null)) {\r\n            throw new Error(\r\n            `putOrUpdate error: store \"${storeName}\" utilise keyPath=\"${keyPath}\" mais data.${keyPath} est manquant`\r\n            );\r\n        }\r\n\r\n        const recordKey = typeof keyPath === 'string' ? data[keyPath] : undefined;\r\n        const existingItem = recordKey ? await store.get(recordKey) : null;\r\n\r\n        if (existingItem) {\r\n            await store.put({ ...existingItem, ...data });\r\n            if(cfg.debugDB) console.log(`üü° Updated item in ${storeName} (inline key):`, recordKey);\r\n        } else {\r\n            await store.put(data);\r\n            if(cfg.debugDB) console.log(`üü¢ Added new item to ${storeName} (inline key):`, recordKey);\r\n        }\r\n\r\n        // üß© Cas 2 : cl√© externe (pas de keyPath)\r\n        } else {\r\n        if (key === undefined || key === null) {\r\n            throw new Error(`putOrUpdate error: missing 'key' for store \"${storeName}\" (no keyPath defined)`);\r\n        }\r\n\r\n        const existingItem = await store.get(key);\r\n\r\n        if (existingItem) {\r\n            await store.put({ ...existingItem, ...data }, key);\r\n            if(cfg.debugDB) console.log(`üü° Updated item in ${storeName} (explicit key):`, key);\r\n        } else {\r\n            await store.put(data, key);\r\n            if(cfg.debugDB) console.log(`üü¢ Added new item to ${storeName} (explicit key):`, key);\r\n        }\r\n        }\r\n\r\n        await tx.done;\r\n        db.close();\r\n\r\n    } catch (error) {\r\n        if(cfg.debugDBErr) console.error(`‚ùå putOrUpdate error in ${storeName}:`, error);\r\n        throw error;\r\n    }\r\n}\r\n  \r\n\r\nexport async function getData(storeName, key) {\r\n    try {\r\n        if (key === undefined || key === null) {\r\n            throw new Error(\r\n                `put error: missing 'key' parameter for store ${storeName}`\r\n            );\r\n        }\r\n        const db = await openDatabase();\r\n        const tx = db.transaction(storeName, 'readonly');\r\n        const store = tx.objectStore(storeName);\r\n        \r\n        const result = await store.get(key);\r\n        await tx.done;\r\n        db.close();\r\n        \r\n        if (result === undefined) {\r\n            if(cfg.debugDB) console.warn(`No data found in ${storeName} for key:`, key);\r\n        } else {\r\n            if(cfg.debugDB) console.log(`Data retrieved from ${storeName} for key ${key}:`, result);\r\n        }\r\n        \r\n        return result;\r\n    } catch (error) {\r\n        if(cfg.debugDBErr) console.error(`Error getting data from ${storeName}:`, error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function getAllData(storeName) {\r\n  let db;\r\n  try {\r\n    db = await openDatabase();\r\n    const tx = db.transaction(storeName, 'readonly');\r\n    const store = tx.objectStore(storeName);\r\n\r\n    const result = await store.getAll();\r\n    await tx.done;\r\n\r\n    if (cfg.debugDB) console.log(`Retrieved all data from ${storeName}:`, result);\r\n    return result;\r\n  } catch (error) {\r\n    if (cfg.debugDBErr) console.error(`Error getting all data from ${storeName}:`, error);\r\n    throw error;\r\n  } finally {\r\n    try { db?.close(); } catch {}\r\n  }\r\n}\r\n\r\n\r\nexport async function deleteData(storeName, key) {\r\n    try {\r\n        if (key === undefined || key === null) {\r\n            throw new Error(\r\n                `delete error: missing 'key' parameter for store ${storeName}`\r\n            );\r\n        }\r\n        const db = await openDatabase();\r\n        const tx = db.transaction(storeName, 'readwrite');\r\n        const store = tx.objectStore(storeName);\r\n        \r\n        await store.delete(key);\r\n        await tx.done;\r\n        db.close();\r\n        \r\n        if(cfg.debugDB) console.log(`Data with key ${key} deleted from ${storeName}`);\r\n    } catch (error) {\r\n        if(cfg.debugDBErr) console.error(`Error deleting data from ${storeName}:`, error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n\r\nexport async function saveData(storeName, data, key, options = {}) {\r\n    const { updateIfExists = false } = options;\r\n  \r\n    try {\r\n      const db = await openDatabase();\r\n      const tx = db.transaction(storeName, 'readwrite');\r\n      const store = tx.objectStore(storeName);\r\n      const hasInlineKey = !!store.keyPath;\r\n  \r\n      // Helper: calcule/valide la cl√© inline √† partir du keyPath\r\n      const resolveInlineKey = () => {\r\n        const kp = store.keyPath;\r\n        if (!kp) return undefined;\r\n  \r\n        if (typeof kp === 'string') {\r\n          const v = data?.[kp];\r\n          if (v === undefined || v === null) {\r\n            throw new Error(`saveData: store \"${storeName}\" utilise keyPath=\"${kp}\" mais data.${kp} est manquant`);\r\n          }\r\n          return v;\r\n        }\r\n  \r\n        // keyPath compos√© (array)\r\n        if (Array.isArray(kp)) {\r\n          const arr = kp.map(k => {\r\n            const v = data?.[k];\r\n            if (v === undefined || v === null) {\r\n              throw new Error(`saveData: store \"${storeName}\" keyPath compos√© ${JSON.stringify(kp)} ‚Üí data.${k} manquant`);\r\n            }\r\n            return v;\r\n          });\r\n          return arr;\r\n        }\r\n  \r\n        // Types exotiques non g√©r√©s\r\n        throw new Error(`saveData: keyPath non support√© pour le store \"${storeName}\"`);\r\n      };\r\n  \r\n      if (hasInlineKey) {\r\n        // üîí Cl√© inline: on n'utilise PAS le param√®tre key\r\n        if (key !== undefined) {\r\n          if(cfg.debugDB) console.warn(`[${storeName}] keyPath d√©fini (${store.keyPath}) ‚Üí param \"key\" ignor√©`);\r\n        }\r\n  \r\n        const recordKey = resolveInlineKey();\r\n  \r\n        if (updateIfExists) {\r\n          const existing = await store.get(recordKey);\r\n          if (existing) {\r\n            await store.put({ ...existing, ...data }); // pas de 2e arg\r\n            if(cfg.debugDB) console.log(`üü° Updated (inline) in ${storeName}:`, recordKey);\r\n          } else {\r\n            await store.put(data);\r\n            if(cfg.debugDB) console.log(`üü¢ Insert (inline) in ${storeName}:`, recordKey);\r\n          }\r\n        } else {\r\n          await store.put(data);\r\n          if(cfg.debugDB) console.log(`üíæ Saved (inline) in ${storeName}:`, recordKey);\r\n        }\r\n  \r\n      } else {\r\n        // üîì Cl√© externe (pas de keyPath)\r\n        // Si autoIncrement, la key peut √™tre omise\r\n        const needsKey = !store.autoIncrement && (key === undefined || key === null);\r\n        if (needsKey) {\r\n          throw new Error(`saveData: store \"${storeName}\" sans keyPath et sans autoIncrement ‚Üí \"key\" requis`);\r\n        }\r\n  \r\n        if (updateIfExists) {\r\n          const existing = (key !== undefined && key !== null) ? await store.get(key) : null;\r\n          if (existing) {\r\n            (key !== undefined && key !== null)\r\n              ? await store.put({ ...existing, ...data }, key)\r\n              : await store.put({ ...existing, ...data }); // autoIncrement\r\n            if(cfg.debugDB) console.log(`üü° Updated (explicit) in ${storeName}:`, key ?? '(autoIncrement)');\r\n          } else {\r\n            (key !== undefined && key !== null)\r\n              ? await store.put(data, key)\r\n              : await store.put(data); // autoIncrement\r\n            if(cfg.debugDB) console.log(`üü¢ Insert (explicit) in ${storeName}:`, key ?? '(autoIncrement)');\r\n          }\r\n        } else {\r\n          (key !== undefined && key !== null)\r\n            ? await store.put(data, key)\r\n            : await store.put(data); // autoIncrement\r\n          if(cfg.debugDB) console.log(`üíæ Saved (explicit) in ${storeName}:`, key ?? '(autoIncrement)');\r\n        }\r\n      }\r\n  \r\n      await tx.done;\r\n      db.close();\r\n    } catch (error) {\r\n      if(cfg.debugDBErr) console.error(`‚ùå Error saving data to ${storeName}:`, error);\r\n      throw error;\r\n    }\r\n}\r\n  \r\n\r\n\r\nexport function handleIndexedDBError(error, context = 'IndexedDB Operation') {\r\n    if(cfg.debugDB) console.group(`‚ùå ${context} Error`);\r\n    if(cfg.debugDBErr) console.error('Error Name:', error.name);\r\n    if(cfg.debugDBErr) console.error('Error Message:', error.message);\r\n    \r\n    switch (error.name) {\r\n        case 'AbortError':\r\n            if(cfg.debugDB) console.warn('Transaction was aborted. This might be due to a constraint violation.');\r\n            break;\r\n        case 'ConstraintError':\r\n            if(cfg.debugDB) console.warn('A constraint was violated. Check your key paths and indexes.');\r\n            break;\r\n        case 'QuotaExceededError':\r\n            if(cfg.debugDB) console.warn('The database storage quota has been exceeded.');\r\n            break;\r\n        case 'UnknownError':\r\n            if(cfg.debugDB) console.warn('An unknown error occurred. This might require further investigation.');\r\n            break;\r\n    }\r\n    \r\n    if(cfg.debugDB) console.trace('Error Stack Trace');\r\n    if(cfg.debugDB) console.groupEnd();\r\n}\r\n\r\nexport function processDBOperations(dbOperations) {\r\n    dbOperations.forEach(operation => {\r\n        const { type, ...stores } = operation; // R√©cup√®re le type d'op√©ration et les stores concern√©s\r\n\r\n        Object.entries(stores).forEach(([storeName, records]) => {\r\n            if (Array.isArray(records)) {\r\n                records.forEach(record => {\r\n                    executeDBOperation(type, storeName, record);\r\n                });\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nexport async function executeDBOperation(operation, storeName, data, callback = null) {\r\n    try {\r\n        switch (operation) {\r\n            case \"put\":\r\n                await saveData(storeName, data,data.key);\r\n                break;\r\n\r\n            case \"get\":\r\n                const result = await getData(storeName, $data.key);\r\n                if (callback) callback(result);\r\n                return result;\r\n\r\n            case \"putOrUpdate\":\r\n                await saveData(storeName, data,data.key,{ updateIfExists: true });\r\n                break;\r\n\r\n            default:\r\n                if(cfg.debugDBErr) console.error(\"Op√©ration non reconnue :\", operation);\r\n                throw new Error(`Op√©ration non reconnue : ${operation}`);\r\n        }\r\n    } catch (error) {\r\n        if(cfg.debugDBErr) console.error(`Erreur lors de l'op√©ration ${operation} sur ${storeName}:`, error);\r\n        handleIndexedDBError(error, `DB Operation: ${operation}`);\r\n        \r\n        // Si un callback d'erreur est n√©cessaire\r\n        if (callback && typeof callback === 'function') {\r\n            callback(null, error);\r\n        }\r\n        \r\n        throw error;\r\n    }\r\n}\r\nexport function createKeyChangeListener(storeName, key, options = {}) {\r\n    const {\r\n        timeout = 500,\r\n        maxAttempts = 0\r\n    } = options;\r\n\r\n    const listener = {\r\n        db: null,\r\n        initialValue: null,\r\n        attempts: 0,\r\n        intervalId: null,\r\n        isRunning: false,\r\n        onChangeCallback: null,\r\n\r\n        async readCurrentValue() {\r\n            if (!this.db) return;\r\n\r\n            try {\r\n                const tx = this.db.transaction(storeName, 'readonly');\r\n                const store = tx.objectStore(storeName);\r\n                const currentValue = await store.get(key);\r\n\r\n                if (JSON.stringify(currentValue) !== JSON.stringify(this.initialValue)) {\r\n                    const payload = {\r\n                        newValue: currentValue,\r\n                        oldValue: this.initialValue\r\n                    };\r\n\r\n                    console.log('üîÅ Changement d√©tect√© :', payload);\r\n\r\n                    if (typeof this.onChangeCallback === 'function') {\r\n                        this.onChangeCallback(payload);\r\n                    }\r\n\r\n                    this.initialValue = currentValue;\r\n                }\r\n\r\n                await tx.done;\r\n            } catch (err) {\r\n                if(cfg.debugDBErr) console.error('üí• Erreur lors de la lecture dans readCurrentValue :', err);\r\n            }\r\n        },\r\n\r\n        async start({ referenceValue = null, onChange = null } = {}) {\r\n            if (this.isRunning) return;\r\n\r\n            try {\r\n                this.db = await openDatabase();\r\n                this.onChangeCallback = onChange || null;\r\n\r\n                const tx = this.db.transaction(storeName, 'readonly');\r\n                const store = tx.objectStore(storeName);\r\n                const currentValue = await store.get(key);\r\n                await tx.done;\r\n\r\n                if (referenceValue !== null) {\r\n                    const isDifferent = JSON.stringify(currentValue) !== JSON.stringify(referenceValue);\r\n\r\n                    if (isDifferent && typeof this.onChangeCallback === 'function') {\r\n                        this.onChangeCallback({\r\n                            oldValue: referenceValue,\r\n                            newValue: currentValue\r\n                        });\r\n                    }\r\n                }\r\n\r\n                this.initialValue = currentValue;\r\n                this.isRunning = true;\r\n                this.attempts = 0;\r\n\r\n                this.intervalId = setInterval(() => {\r\n                    this.attempts++;\r\n                    this.readCurrentValue();\r\n\r\n                    if (this.attempts >= maxAttempts && maxAttempts !== 0) {\r\n                        this.stop();\r\n                        console.warn('‚è±Ô∏è Timeout atteint sans changement.');\r\n                    }\r\n                }, timeout);\r\n\r\n            } catch (error) {\r\n                this.stop();\r\n                if(cfg.debugDBErr) console.error('üí• Erreur lors du d√©marrage :', error);\r\n            }\r\n        },\r\n\r\n        stop() {\r\n            if (this.intervalId) {\r\n                clearInterval(this.intervalId);\r\n                this.intervalId = null;\r\n            }\r\n\r\n            if (this.db) {\r\n                this.db.close();\r\n                this.db = null;\r\n            }\r\n\r\n            this.isRunning = false;\r\n            this.attempts = 0;\r\n            this.onChangeCallback = null;\r\n        },\r\n\r\n        interrupt() {\r\n            this.stop();\r\n            if(cfg.debugDB)console.warn('üîå Listener interrompu manuellement.');\r\n        }\r\n    };\r\n\r\n    return listener;\r\n}\r\n\r\n\r\nexport async function getLatestEntriesPerUser(\r\n    raceId,\r\n    legNum,\r\n    {\r\n      timeout = 5000,\r\n      since = Date.now() - 10 * 60 * 1000,\r\n      until = Number.MAX_SAFE_INTEGER,\r\n      maxUsers = 0,\r\n      storeName = 'legPlayersInfos'\r\n    } = {}\r\n  ) {\r\n    const r = Number(raceId);\r\n    const l = Number(legNum);\r\n    if (!Number.isFinite(r) || !Number.isFinite(l)) {\r\n      if(cfg?.debugDBIteErr) console.error('[getLatestEntriesPerUser] Invalid arguments', { raceId, legNum });\r\n      return { items: null, meta: { usersScanned: 0, usersTaken: 0, timedOut: false, reason: 'invalid-args', elapsedMs: 0, since, until } };\r\n    }\r\n  \r\n    let db, tx;\r\n    const t0 = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n  \r\n    const job = (async () => {\r\n      db = await openDatabase();\r\n      tx = db.transaction(storeName, 'readonly');\r\n      const store = tx.objectStore(storeName);\r\n  \r\n      if (!store.indexNames.contains('byTriplet')) {\r\n        throw new Error(`[getLatestEntriesPerUser] Missing index 'byTriplet' on ${storeName}`);\r\n      }\r\n      const byTriplet = store.index('byTriplet');\r\n  \r\n      const userRange = IDBKeyRange.bound([r, l, ''], [r, l, '\\uffff']);\r\n  \r\n      const mapByUser = Object.create(null);\r\n      let usersScanned = 0;\r\n      let reason = 'done';\r\n  \r\n      let uCursor = await byTriplet.openKeyCursor(userRange, 'nextunique');\r\n      while (uCursor) {\r\n        usersScanned++;\r\n        const u = uCursor.key?.[2];\r\n  \r\n        const lower = [r, l, u, Math.max(0, Number(since) || 0)];\r\n        const upper = [r, l, u, Math.min(Number.MAX_SAFE_INTEGER, Number(until) || Number.MAX_SAFE_INTEGER)];\r\n        const range = IDBKeyRange.bound(lower, upper);\r\n  \r\n        let sCursor = await store.openCursor(range, 'prev');\r\n        if (sCursor) {\r\n          // le premier en 'prev' dans la fen√™tre = derni√®re entr√©e dans [since, until]\r\n          mapByUser[u] = sCursor.value;\r\n        }\r\n  \r\n        if (maxUsers && Object.keys(mapByUser).length >= maxUsers) {\r\n          reason = 'max-users-reached';\r\n          break;\r\n        }\r\n  \r\n        uCursor = await uCursor.continue();\r\n      }\r\n  \r\n      await tx.done;\r\n      db.close?.();\r\n  \r\n      const t1 = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n      const meta = {\r\n        usersScanned,\r\n        usersTaken: Object.keys(mapByUser).length,\r\n        timedOut: false,\r\n        reason,\r\n        elapsedMs: Math.max(0, t1 - t0),\r\n        since: Math.max(0, Number(since) || 0),\r\n        until: Math.min(Number.MAX_SAFE_INTEGER, Number(until) || Number.MAX_SAFE_INTEGER)\r\n      };\r\n  \r\n      if(cfg?.debugDBIte) console.debug('[getLatestEntriesPerUser] done', { leg: [r, l], meta });\r\n  \r\n      return { items: mapByUser, meta };\r\n    })();\r\n  \r\n    try {\r\n      return await withTimeout(job, timeout, () => {\r\n        try { tx?.abort?.(); } catch {}\r\n        try { db?.close?.(); } catch {}\r\n      });\r\n    } catch (err) {\r\n      const t1 = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n      if (String(err?.message || '').includes('Timeout')) {\r\n        const meta = { usersScanned: 0, usersTaken: 0, timedOut: true, reason: 'timeout', elapsedMs: Math.max(0, t1 - t0), since, until };\r\n        if(cfg?.debugDBIte) console.warn(`[getLatestEntriesPerUser] timeout after ${timeout}ms`, { leg: [r, l], meta });\r\n        return { items: null, meta };\r\n      }\r\n      const meta = { usersScanned: 0, usersTaken: 0, timedOut: false, reason: 'error', elapsedMs: Math.max(0, t1 - t0), since, until };\r\n      if(cfg?.debugDBIteErr) console.error('[getLatestEntriesPerUser] error:', err, { leg: [r, l], meta });\r\n      return { items: null, meta };\r\n    }\r\n}\r\n\r\n/**\r\n * Utility: fail a promise after ms (with optional best-effort cleanup).\r\n */\r\nfunction withTimeout(promise, ms, onTimeout) {\r\n    return new Promise((resolve, reject) => {\r\n      const timer = setTimeout(() => {\r\n        try { onTimeout?.(); } catch (_) {}\r\n        reject(new Error(`Timeout after ${ms}ms`));\r\n      }, ms);\r\n      promise.then(\r\n        (v) => { clearTimeout(timer); resolve(v); },\r\n        (e) => { clearTimeout(timer); reject(e); }\r\n      );\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Retourne les entr√©es compl√®tes d'un triplet tri√©es du plus r√©cent au plus ancien,\r\n   * born√©es temporellement (par d√©faut: DERNI√àRES 10 MINUTES).\r\n   *\r\n   * @param {number} raceId\r\n   * @param {number} legNum\r\n   * @param {string} userId\r\n   * @param {object} [options]\r\n   * @param {number} [options.limit=0]         - 0 = pas de limite (hormis la fen√™tre temporelle)\r\n   * @param {number} [options.timeout=5000]    - timeout en ms (retournera items=null si d√©pass√©)\r\n   * @param {number} [options.since]           - borne basse epoch ms (par d√©faut: now - 10min)\r\n   * @param {number} [options.until]           - borne haute epoch ms (par d√©faut: +‚àû)\r\n   * @param {string} [options.storeName='legPlayersInfos']\r\n   * @returns {Promise<{items: Array<Object>|null, meta: {\r\n   *   scanned:number, taken:number, timedOut:boolean, reason:string,\r\n   *   elapsedMs:number, since:number, until:number\r\n   * }}>}\r\n   */\r\n  export async function getEntriesForTriplet(\r\n    raceId,\r\n    legNum,\r\n    userId,\r\n    {\r\n      limit = 0,\r\n      timeout = 5000,\r\n      since = Date.now() - 10 * 60 * 1000,         // üëâ derni√®re 10 minutes par d√©faut\r\n      until = Number.MAX_SAFE_INTEGER,              // üëâ pas de plafond par d√©faut\r\n      storeName = 'legPlayersInfos'\r\n    } = {}\r\n  ) {\r\n    const r = Number(raceId);\r\n    const l = Number(legNum);\r\n    const u = String(userId ?? '').trim();\r\n    if (!Number.isFinite(r) || !Number.isFinite(l) || !u) {\r\n      const msg = '[getEntriesForTriplet] Invalid arguments';\r\n      if(cfg?.debugDBIteErr) console.error(msg, { raceId, legNum, userId });\r\n      return { items: null, meta: { scanned: 0, taken: 0, timedOut: false, reason: 'invalid-args', elapsedMs: 0, since, until } };\r\n    }\r\n  \r\n    let db, tx;\r\n    const t0 = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n  \r\n    const job = (async () => {\r\n      db = await openDatabase();\r\n      tx = db.transaction(storeName, 'readonly');\r\n      const store = tx.objectStore(storeName);\r\n  \r\n      // Plage born√©e sur la cl√© primaire ['raceId','legNum','userId','iteDate']\r\n      const lower = [r, l, u, Math.max(0, Number(since) || 0)];\r\n      const upper = [r, l, u, Math.min(Number.MAX_SAFE_INTEGER, Number(until) || Number.MAX_SAFE_INTEGER)];\r\n      const range = IDBKeyRange.bound(lower, upper);\r\n  \r\n      const results = [];\r\n      let scanned = 0;\r\n      let reason = 'done';\r\n  \r\n      // Parcours d√©croissant ‚Üí plus r√©cent d'abord\r\n      let cursor = await store.openCursor(range, 'prev');\r\n      while (cursor) {\r\n        scanned++;\r\n        const value = cursor.value;\r\n        const iteDate = value?.iteDate ?? cursor.key?.[3];\r\n  \r\n        // Comme on est en desc, si on est d√©j√† < since, on peut stopper net.\r\n        if (iteDate < lower[3]) {\r\n          reason = 'stopped-too-old';\r\n          break;\r\n        }\r\n  \r\n        results.push(value);\r\n  \r\n        if (limit && results.length >= limit) {\r\n          reason = 'limit-reached';\r\n          break;\r\n        }\r\n  \r\n        cursor = await cursor.continue();\r\n      }\r\n  \r\n      await tx.done;\r\n      db.close?.();\r\n  \r\n      const t1 = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n      const meta = {\r\n        scanned,\r\n        taken: results.length,\r\n        timedOut: false,\r\n        reason,\r\n        elapsedMs: Math.max(0, t1 - t0),\r\n        since: lower[3],\r\n        until: upper[3]\r\n      };\r\n  \r\n      // Log d‚Äôobservabilit√©\r\n      if(cfg?.debugDBIte) console.debug('[getEntriesForTriplet] done', { storeName:storeName,triplet: [r, l, u], meta });\r\n  \r\n      return { items: results, meta };\r\n    })();\r\n  \r\n    try {\r\n      return await withTimeout(job, timeout, () => {\r\n        try { tx?.abort?.(); } catch (_) {}\r\n        try { db?.close?.(); } catch (_) {}\r\n      });\r\n    } catch (err) {\r\n      const t1 = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n      if (String(err?.message || '').includes('Timeout')) {\r\n        const meta = {\r\n          scanned: 0,\r\n          taken: 0,\r\n          timedOut: true,\r\n          reason: 'timeout',\r\n          elapsedMs: Math.max(0, t1 - t0),\r\n          since,\r\n          until\r\n        };\r\n        if(cfg?.debugDBIte) console.warn(`[getEntriesForTriplet] timeout after ${timeout}ms`, {storeName:storeName, triplet: [r, l, u], meta });\r\n        return { items: null, meta };\r\n      }\r\n      const meta = {\r\n        scanned: 0,\r\n        taken: 0,\r\n        timedOut: false,\r\n        reason: 'error',\r\n        elapsedMs: Math.max(0, t1 - t0),\r\n        since,\r\n        until\r\n      };\r\n      if(cfg?.debugDBIteErr) console.error('[getEntriesForTriplet] error:', err, { storeName:storeName,triplet: [r, l, u], meta });\r\n      return { items: null, meta };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Raccourci: { latest, previous } sur la m√™me fen√™tre temporelle (10 min par d√©faut).\r\n   * Si timeout/erreur ‚Üí { latest:null, previous:null } + meta renvoy√©e aussi pour debug.\r\n   */\r\n  export async function getLatestAndPreviousByTriplet(\r\n    raceId,\r\n    legNum,\r\n    userId,\r\n    opts = {}\r\n  ) {\r\n    const { items, meta } = await getEntriesForTriplet(raceId, legNum, userId, { ...opts, limit: 2 });\r\n    const latest = items?.[0] ?? null;\r\n    const previous = items?.[1] ?? null;\r\n    return { latest, previous, meta };\r\n  }\r\n\r\n/**\r\n * R√©cup√®re toutes les options joueurs pour un couple (raceId, legNum).\r\n * @param {number|string} raceId\r\n * @param {number|string} legNum\r\n * @param {{ asMap?: boolean }} [options]  - asMap=true => { [userId]: entry }\r\n * @returns {Promise<Array|Object>}        - tableau d‚Äôentr√©es ou map par userId\r\n */\r\nexport async function getLegPlayersOptionsByRaceLeg(raceId, legNum, options = {}) {\r\n  const { asMap = true } = options;\r\n  const db = await openDatabase();\r\n  try {\r\n    const tx = db.transaction('legPlayersOptions', 'readonly');\r\n    const store = tx.objectStore('legPlayersOptions');\r\n\r\n    let items = [];\r\n\r\n    // ‚úÖ chemin optimis√© si l‚Äôindex existe\r\n    if (store.indexNames.contains('byRaceLeg')) {\r\n      const idx = store.index('byRaceLeg');\r\n      items = await idx.getAll([raceId, legNum]);\r\n    } else {\r\n      // üîÅ fallback sans r√©-init DB : range prefix sur byTriplet\r\n      // [raceId, legNum] ‚Ä¶ [raceId, legNum, '\\uffff'] pour couvrir tous les userId (string)\r\n      const idx = store.index('byTriplet');\r\n      const range = IDBKeyRange.bound([raceId, legNum], [raceId, legNum, '\\uffff']);\r\n      items = await idx.getAll(range);\r\n    }\r\n\r\n    await tx.done;\r\n    if (!asMap) return items;\r\n\r\n    // { [userId]: entr√©e compl√®te }\r\n    return items.reduce((acc, it) => {\r\n      if (it?.userId != null) acc[it.userId] = it;\r\n      return acc;\r\n    }, {});\r\n  } finally {\r\n    db.close();\r\n  }\r\n}\r\n","\r\nimport {getData,saveData} from './dbOpes.js';\r\n\r\n\r\n\r\nexport const userPrefsDefault =\r\n{\r\n/**/    router :\r\n/**/    {\r\n/**/        auto : true,\r\n/**/        sel : \"zezo\", /*Zezo VRzen Les deux\"*/\r\n/**/    },\r\n/**/    nmea :\r\n/**/    {\r\n/**/        enable : false,\r\n/**/        port : 8081, /*801 8082 8083 8084*/\r\n/**/    },\r\n/**/    theme : \"dark\", /*dark light */\r\n/**/    lang : \"fr\", /*fr en*/\r\n    global : \r\n    {\r\n        separatorPos : false , /* - dans pos*/\r\n        alternateFilter : true,\r\n        reuseTab : true,\r\n        localTime : true,\r\n        polarSite : \"INC\", /* toxxct inc lsv */\r\n        ITYCSend : true \r\n    },\r\n    drawing : \r\n    {\r\n        fullScreen : false,\r\n        ratio : 80\r\n    },\r\n    raceData :\r\n    {\r\n        lastCmd : false,\r\n        VMGSpeed : false\r\n    },\r\n    raceLog :\r\n    {\r\n        hideLastCmd : false,\r\n        column : {\r\n            rank : true,\r\n            DTL  : true,\r\n            DTF : true,\r\n            vR : true,\r\n            vC  : true,\r\n            foil : true,\r\n            factor : true,\r\n            stamina : true,\r\n            deltaD : true,\r\n            deltaT : true,\r\n            position : true\r\n        }\r\n    },\r\n    map : {\r\n        trace : false,\r\n        projectionLineLenght : 20,\r\n        invisibleBuoy : false,\r\n        showMarkers : false,\r\n        showTracks : false,\r\n        borderColor :\"#0000FF\",\r\n        projectionColor :\"#B56AFB\"\r\n    },\r\n    fleet : {\r\n        shortOption : true,\r\n        cleaning : true,\r\n        cleaningInterval : 5,\r\n        column : {\r\n            team : true,\r\n            rank : true,\r\n            raceTime : true,\r\n            DTU : true,\r\n            DTF : true,\r\n            TWD : true,\r\n            TWS  : true,\r\n            TWS  : true,\r\n            TWA  : true,\r\n            HDG  : true,\r\n            speed  : true,\r\n            VMG  : true,\r\n            sail  : true,\r\n            factor : true,\r\n            foil : true,\r\n            position : true,\r\n            option  : true,\r\n            state : true,\r\n            select : true\r\n        }\r\n    },\r\n    sailRankId : \"\",\r\n    separator : \"sep_1\" /* EU ; US , SailRank Tabs */,\r\n    filters: {\r\n        friends : true,\r\n        opponents : false,\r\n        certified : true,\r\n        team : true,\r\n        top : true,\r\n        real :false,\r\n        sponsors : true,\r\n        inRace : false,\r\n        selected :true\r\n    }\r\n}\r\n\r\n\r\n\r\nlet userPrefs = userPrefsDefault;\r\n\r\n\r\n\r\nexport async function loadUserPrefs()\r\n{\r\n    const dbUserPrefs = await getData(\"internal\",\"userPrefs\")\r\n                            .catch(error => {console.error(\"getuserPrefs error :\", error);});\r\n    if (dbUserPrefs?.prefs == null)\r\n    {\r\n        userPrefs = userPrefsDefault;\r\n        await saveUserPrefs(userPrefsDefault);\r\n    } else\r\n        userPrefs = dbUserPrefs.prefs;\r\n    if(!userPrefs.filters)\r\n    {\r\n        userPrefs.filters = {\r\n            friends : true,\r\n            opponents : false,\r\n            certified : true,\r\n            team : true,\r\n            top : true,\r\n            real :false,\r\n            sponsors : true,\r\n            inRace : false,\r\n            selected :true\r\n        };\r\n        \r\n        await saveUserPrefs(userPrefs);\r\n    }\r\n        \r\n}\r\nexport async function saveUserPrefs(prefs)\r\n{\r\n    await saveData('internal', {id: \"userPrefs\",prefs:prefs},null,{ updateIfExists: true });\r\n    userPrefs = prefs;\r\n\r\n}\r\n\r\nexport function getUserPrefs()\r\n{\r\n    return userPrefs;\r\n}","\r\n\r\n\r\nexport function roundTo(number, digits) {\r\n    if (number !== undefined && !isNaN(number)) {\r\n        var scale = Math.pow(10, digits);\r\n        return (Math.round(number * scale) / scale).toFixed(digits);\r\n    } else {\r\n        return \"-\";\r\n    }\r\n}\r\n\r\nexport function gcAngle(rlat0, rlon0, rlat1, rlon1) {\r\n    return Math.acos(Math.sin(rlat0) * Math.sin(rlat1) + Math.cos(rlat0) * Math.cos(rlat1) * Math.cos(rlon1 - rlon0));\r\n}\r\n\r\nexport function toRad(angle) {\r\n    return angle / 180 * Math.PI;\r\n}\r\nexport function toDeg(angle) {\r\n    return angle / Math.PI * 180;\r\n}\r\n\r\nexport function angle(h0, h1) {\r\n    return Math.abs(Math.PI - Math.abs(h1 - h0));\r\n}\r\n// Greate circle distance\r\nexport function gcDistance(pos0, pos1) {\r\n    // Earth radius in nm, 360*60/(2*Pi);\r\n    var radius = 3437.74683;\r\n    // e = r ¬∑ arccos(sin(œÜA) ¬∑ sin(œÜB) + cos(œÜA) ¬∑ cos(œÜB) ¬∑ cos(ŒªB ‚Äì ŒªA))\r\n    var rlat0 = toRad(pos0.lat);\r\n    var rlat1 = toRad(pos1.lat);\r\n    var rlon0 = toRad(pos0.lon);\r\n    var rlon1 = toRad(pos1.lon);\r\n    return radius * gcAngle(rlat0, rlon0, rlat1, rlon1);\r\n}\r\n\r\nexport function courseAngle(lat0, lon0, lat1, lon1) {\r\n\r\n    if(lon0 < lon1+0.00002 && lon0 > lon1-0.00002)\r\n    { // When heading in PI or 0 trigo fails ;)\r\n        if(lat0 <lat1) return 0; else return Math.PI;\r\n    }\r\n    var rlat0 = toRad(lat0);\r\n    var rlat1 = toRad(lat1);\r\n    var rlon0 = toRad(lon0);\r\n    var rlon1 = toRad(lon1);\r\n    var xi = gcAngle(rlat0, rlon0, rlat1, rlon1);\r\n    var a = Math.acos((Math.sin(rlat1) - Math.sin(rlat0) * Math.cos(xi)) / (Math.cos(rlat0) * Math.sin(xi)));\r\n    return (Math.sin(rlon1 - rlon0) > 0) ? a : (2 * Math.PI - a);\r\n}\r\n\r\nexport const guessOptionBits = {\r\n    \"hull\":  1,\r\n    \"winch\": 2,\r\n    \"foil\":  4,\r\n    \"light\": 8,\r\n    \"reach\": 16,\r\n    \"heavy\": 32,\r\n    \"hullDetected\":64,\r\n    \"foilDetected\":128,\r\n    \"winchDetected\":256,\r\n    \"hullActivated\":64+1,\r\n    \"foilActivated\":128+4,\r\n    \"winchActivated\":256+2,\r\n    \r\n    3:32, //stay\r\n    4:8,  //LJ\r\n    5:16,  //C0\r\n    6:32,  //HG\r\n    7:8,  //LG\r\n};\r\n\r\nexport function isBitSet(num, mask){\r\n    let a = num&mask;\r\n    if(a===0)\r\n        return false;\r\n    else\r\n        return true;\r\n}\r\n\r\nexport function calculateCOGLoxo(LatDebDd,LonDebDd,LatFinDd,LonFinDd,useMercator=true) {\r\n\t// Comme convention Marine & SHOM L=Lat et G=Lon\r\n\t// XM=Abscisse Mercator & YM=Ordonn√©e Mercator\r\n\t// HDG=Cap\r\n\tvar LdRad, GdRad, LfRad, GfRad, AbsDeltaG , AbsDeltaL ;\r\n\tvar XMd, XMf, YMd, YMf, deltaXM, deltaYM ;\r\n\tvar HDGLoxo, distLoxo ;\r\n\t\r\n\tconst RT = 6378.1370 / 1.852 ;\r\n\t\r\n\t// transformation en radians\r\n\tLdRad = toRad(LatDebDd);\r\n\tGdRad = toRad(LonDebDd);\r\n\tLfRad = toRad(LatFinDd);\r\n\tGfRad = toRad(LonFinDd);\r\n\t\r\n\t// Traitement de l'antim√©ridien et abscisses Mercator (Abscisse=longitude)\r\n\tAbsDeltaG = Math.abs (GdRad - GfRad)\r\n\tif (AbsDeltaG < Math.PI) {\r\n\t\tXMd = GdRad ;\r\n\t\tXMf = GfRad ;\r\n\t} else if (GdRad > GfRad) {\r\n\t\tXMd = GdRad - Math.PI ;\r\n\t\tXMf = GfRad + Math.PI ;\r\n\t} else {\r\n\t\tXMd = GdRad + Math.PI ;\r\n\t\tXMf = GfRad - Math.PI ;\r\n\t}\r\n\t\r\n    if(useMercator)\r\n    {\r\n\t// Calcul des ordonn√©es Mercator\r\n\t\tYMd = Math.log ( Math.tan (( Math.PI / 4 ) + (LdRad / 2))) ;\r\n\t\tYMf = Math.log ( Math.tan (( Math.PI / 4 ) + (LfRad / 2))) ;\r\n\t} else\r\n    {\r\n        YMd = LdRad;\r\n        YMf = LfRad;\r\n    }\t\r\n\t// Calcul des Deltas\r\n\t\tdeltaXM = XMf - XMd ;\r\n\t\tdeltaYM = YMf - YMd ;\r\n\t\t\t\r\n\t// Determiner Cap\t\t\t\r\n\t\t// Gestion des exceptions\r\n\t\t\t// Exception de Longitude\r\n\t\t\tif (deltaXM === 0 ) {\r\n\t\t\t\tif (YMf < YMd) {\r\n\t\t\t\t\tHDGLoxo = 180 ;\r\n\t\t\t\t} else if (YMf > YMd) {\r\n\t\t\t\t\tHDGLoxo = 0 ;\r\n\t\t\t\t} else if (deltaYM === 0) {\r\n\t\t\t\t\tHDGLoxo = \"#N/A\" ;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t} else if (XMd < XMf) {\r\n\t\t\t\tHDGLoxo = 90 - Math.atan(deltaYM / deltaXM) * 180 / Math.PI ;\r\n\t\t\t} else if (XMd > XMf) {\r\n\t\t\t\tHDGLoxo = 270 - Math.atan(deltaYM / deltaXM) * 180 / Math.PI ;\r\n\t\t\t}\r\n\t\r\n\t// Determiner Distance\r\n\t\tAbsDeltaL = Math.abs (LfRad - LdRad) ;\r\n\t\t\r\n\t\tdistLoxo = RT * AbsDeltaL / Math.cos( Math.tan(deltaXM / deltaYM)) ;\r\n\t\t\r\n\t// Sortie des Valeurs\r\n    return HDGLoxo;\r\n\t//\treturn [HDGLoxo, distLoxo];\r\n}\r\n\r\nexport function sign(x) {\r\n    return (x < 0) ? -1 : 1;\r\n}\r\n\r\n /**\r\n * V√©rifie qu'un objet ou un tableau contient toutes les cl√©s / index demand√©s.\r\n * @param {object|Array} target - L'objet ou le tableau √† tester.\r\n * @param {Array<string|number>} keys - Les cl√©s ou index √† v√©rifier.\r\n * @returns {boolean} true si toutes les cl√©s/index existent, sinon false.\r\n */\r\nexport function hasKeys(target, keys = []) {\r\n  if (target == null) return false;\r\n\r\n  // Cas tableau\r\n  if (Array.isArray(target)) {\r\n    return keys.every(idx => \r\n      Number.isInteger(+idx) && target[+idx] !== undefined\r\n    );\r\n  }\r\n\r\n  // Cas objet\r\n  if (typeof target === \"object\") {\r\n    return keys.every(key => key in target);\r\n  }\r\n\r\n  return false;\r\n}\r\nexport function isCurrent(timestamp) {\r\n    return (timestamp && (timestamp > raceIte.previousIteDate));\r\n}\r\n\r\n\r\n","export const sailNames = [0, \"Jib\", \"Spi\", \"Stay\", \"LJ\", \"C0\", \"HG\", \"LG\", 8, 9,\r\n                     // VR sends sailNo + 10 to indicate autoSail. We use sailNo mod 10 to find the sail name sans Auto indication.\r\n                     \"Auto\", \"Jib &#x24B6;\", \"Spi &#x24B6;\", \"Stay &#x24B6;\", \"LJ &#x24B6;\", \"C0 &#x24B6;\", \"HG &#x24B6;\", \"LG &#x24B6;\"];\r\nexport const sailColors = [\"#FFFFFF\", \"#FF6666\", \"#6666FF\", \"#66FF66\", \"#FFF266\", \"#66CCFF\", \"#FF66FF\", \"#FFC44D\", 8, 9,\r\n    // VR sends sailNo + 10 to indicate autoSail. We use sailNo mod 10 to find the sail name sans Auto indication.\r\n                    \"#FFFFFF\", \"#FF6666\", \"#6666FF\", \"#66FF66\", \"#FFF266\", \"#66CCFF;\", \"#FF66FF\", \"#FFC44D\"];\r\nexport const creditsMaxAwardedByPriceLevel = [8600, 7150, 5700, 4300, 2850, 1425];\r\n    \r\n                    \r\n\r\nexport const category = [\"real\", \"certified\", \"top\", \"sponsor\", \"normal\", \"pilotBoat\", \"team\"];\r\nexport const categoryStyle = [\r\n        // real\r\n        {nameStyle: \"color: Chocolate;\", bcolor: '#D2691E', bbcolor: '#000000'},\r\n        // certified\r\n        {nameStyle: \"color: Black;\", bcolor: '#1E90FF', bbcolor: '#000000'},\r\n        // top\r\n        {nameStyle: \"color: GoldenRod; font-weight: bold;\", bcolor: '#ffd700', bbcolor: '#000000'},\r\n        // \"sponsor\"\r\n        {nameStyle: \"color: Black;\", bcolor: '#D3D3D3', bbcolor: '#ffffff'},\r\n        // \"normal\"\r\n        {nameStyle: \"color: Black;\", bcolor: '#D3D3D3', bbcolor: '#000000'},\r\n        // \"normal\"\r\n        {nameStyle: \"color: Black;\", bcolor: '#000000'}\r\n    ];\r\nexport const categoryStyleDark = [\r\n        // real\r\n        {nameStyle: \"color: Chocolate;\", bcolor: '#D2691E', bbcolor: '#000000'},\r\n        // certified\r\n        {nameStyle: \"color: #a5a5a5;\", bcolor: '#1E90FF', bbcolor: '#000000'},\r\n        // top\r\n        {nameStyle: \"color: GoldenRod; font-weight: bold;\", bcolor: '#ffd700', bbcolor: '#000000'},\r\n        // \"sponsor\"\r\n        {nameStyle: \"color: #a5a5a5;\", bcolor: '#D3D3D3', bbcolor: '#ffffff'},\r\n        // \"normal\"\r\n        {nameStyle: \"color: #a5a5a5;\", bcolor: '#D3D3D3', bbcolor: '#000000'},\r\n        // \"normal\"\r\n        {nameStyle: \"color: #a5a5a5;\", bcolor: '#000000'}\r\n    ];\r\n\r\n","\r\n\r\nimport {getUserPrefs, saveUserPrefs} from \"../../common/userPrefs.js\"\r\nimport { roundTo ,sign,isCurrent} from \"../../common/utils.js\";\r\nimport {sailNames,sailColors} from \"./constant.js\"\r\n\r\nexport function switchTheme(theme)\r\n{\r\n\r\n    if(theme==\"dark\")\r\n    {\r\n        document.documentElement.setAttribute(\"data-theme\", \"dark\");\r\n        document.getElementById(\"rt_close_popupLmap\").src = \"./img/closedark.png\";\r\n        document.getElementsByClassName(\"popupCloseBt\").src = \"./img/closedark.png\";\r\n    }else\r\n    {\r\n        document.documentElement.setAttribute(\"data-theme\", \"light\");\r\n        document.getElementById(\"rt_close_popupLmap\").src = \"./img/close.png\";\r\n        document.getElementsByClassName(\"popupCloseBt\").src = \"./img/close.png\";\r\n    }\r\n    //TODO Redraw dash\r\n}\r\n\r\nexport function getBG(timestamp) {\r\n    return isCurrent(timestamp) ? ('style=\"background-color: ' + (darkTheme?\"darkred\":\"LightRed\") + ';\"') : \"\";\r\n}\r\n\r\nfunction pad0 (val, length=2, base=10) {\r\n    var result = val.toString(base)\r\n    while (result.length < length) result = '0' + result;\r\n    return result;\r\n}\r\n\r\nexport function formatHM (seconds) {\r\n    if (seconds === undefined || isNaN(seconds) || seconds < 0) {\r\n        return \"-\";\r\n    }\r\n\r\n    seconds = Math.floor(seconds / 1000);\r\n\r\n    var hours = Math.floor(seconds / 3600);\r\n    seconds -= 3600 * hours;\r\n\r\n    var minutes = Math.floor(seconds / 60);\r\n    seconds -= minutes * 60;\r\n\r\n    let ret;\r\n    if(hours!=0)\r\n    {\r\n        ret = pad0(hours,1)+ \"h\" + pad0(minutes) + \"m\";\r\n    } else\r\n    {\r\n        ret = pad0(minutes,1) + \"m\";    \r\n    }\r\n    return ret;\r\n}\r\nexport function formatTimeNotif(ts) {\r\n    var tsOptions = {\r\n        hour: \"numeric\",\r\n        minute: \"numeric\",\r\n        hour12: false\r\n    };\r\n    var d = (ts) ? (new Date(ts)) : (new Date());\r\n    return new Intl.DateTimeFormat(\"lookup\", tsOptions).format(d);\r\n}\r\n\r\nexport function formatTime(ts, format = 0) {\r\n    const userPrefs = getUserPrefs(); \r\n\r\n    let tsOptions = {\r\n            hour: \"numeric\",\r\n            minute: \"numeric\",\r\n            second: \"numeric\",\r\n            hour12: false\r\n    };\r\n    if (format == 1) {\r\n        tsOptions = {\r\n            hour: \"numeric\",\r\n            minute: \"numeric\",\r\n            hour12: false\r\n        };\r\n    }\r\n    const d = (ts) ? (new Date(ts)) : (new Date());\r\n    if (!userPrefs.global.localTime) {\r\n        tsOptions.timeZone = \"UTC\";\r\n    }\r\n    return new Intl.DateTimeFormat(\"lookup\", tsOptions).format(d);\r\n}\r\n\r\nexport function formatDHMS(seconds) {\r\n    if (seconds === undefined || isNaN(seconds) || seconds < 0) {\r\n        return \"-\";\r\n    }\r\n\r\n    seconds = Math.floor(seconds / 1000);\r\n\r\n    var days = Math.floor(seconds / 86400);\r\n    var hours = Math.floor(seconds / 3600) % 24;\r\n    var minutes = Math.floor(seconds / 60) % 60;\r\n    let retVal = \"\";\r\n    if(days!=0) retVal = pad0(days) + \"d \" + pad0(hours) + \"h \" + pad0(minutes) + \"m\";\r\n    else if(hours!=0) retVal = pad0(hours) + \"h \" + pad0(minutes) + \"m\";\r\n    else retVal = pad0(minutes) + \"m\"; \r\n\r\n    return retVal;\r\n}\r\n\r\nexport function formatShortDate(ts, dflt, timezone) {\r\n    if (!ts && dflt) return dflt;\r\n    if(ts=='-') return \"-\";\r\n    const date = new Date(ts);\r\n    var month, day, hours, minutes, utcDate;\r\n    if (!timezone) {\r\n        utcDate = new Date(Date.UTC(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds()));\r\n        month = (utcDate.getUTCMonth() + 1).toString().padStart(2, '0');\r\n        day = utcDate.getUTCDate().toString().padStart(2, '0');\r\n        hours = utcDate.getUTCHours().toString().padStart(2, '0');\r\n        minutes = utcDate.getUTCMinutes().toString().padStart(2, '0');\r\n    } else {\r\n        month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n        day = date.getDate().toString().padStart(2, '0');\r\n        hours = date.getHours().toString().padStart(2, '0');\r\n        minutes = date.getMinutes().toString().padStart(2, '0');\r\n    }\r\n    return `${day}/${month} ${hours}:${minutes}`;\r\n}\r\n\r\n\r\nexport function twaBackGround(currTwa,bestTwa)\r\n    {\r\n        var twaBG = \" \";\r\n        var currentTWA = Math.round(Math.abs(currTwa));\r\n        var bTwaUp =   Math.round(bestTwa.twaUp);\r\n        var bTwaDw =   Math.round(bestTwa.twaDown);\r\n        if((currentTWA == bTwaUp) || (currentTWA == bTwaDw))\r\n            twaBG =  ' background-color:lightgreen;';\r\n        else if((currentTWA < bTwaUp && currentTWA >= bTwaUp-2) \r\n                || (currentTWA > bTwaDw && currentTWA <= bTwaDw+2))\r\n                twaBG =  ' background-color:DarkOrange;';\r\n        else if((currentTWA < bTwaUp-2) \r\n            || (currentTWA > bTwaDw+2))\r\n            twaBG =  ' background-color:DarkRed;';\r\n        return twaBG;\r\n    }\r\nexport function gentdRacelog(className, name, style, title, value) {\r\n    const userPrefs = getUserPrefs(); \r\n    const checked = userPrefs?.racelog?.column[name];\r\n    if (!style || style === null) style = '';\r\n    if (checked == undefined || checked ) {\r\n        return '<td class=\"' + className + '\" ' \r\n            + style \r\n            + (title ? (' title=\"' + title + '\"') : \"\")\r\n            + ' >' + value + '</td>';\r\n    } else {\r\n        return \"\";\r\n    }\r\n}\r\nexport function genthRacelog(id, name, content, title) {\r\n    const userPrefs = getUserPrefs(); \r\n    const checked = userPrefs?.racelog?.column[name];\r\n    if (checked == undefined || checked ) {\r\n        return '<th id=\"' + id + '\"'\r\n            + (title ? (' title=\"' + title + '\"') : \"\")\r\n            + '>' + content + '</th>';\r\n    } else {\r\n        return \"\"\r\n    }\r\n}\r\n\r\nexport function genth(id, content, title, sortfield, sortmark) {\r\n    const userPrefs = getUserPrefs();\r\n    let checkboxId = '';\r\n    if (!content) {\r\n        const contentAlt = id.split(\"_\")[1];\r\n        checkboxId = id.split(\"_\")[1].toLowerCase();\r\n    } else\r\n        checkboxId = id;\r\n    const checked = userPrefs?.fleet?.column[checkboxId];\r\n    if (checked == undefined || checked ) {\r\n        if (sortfield && sortmark != undefined) {\r\n            content = content + \" \" + (sortmark ? \"&#x25b2;\" : \"&#x25bc;\");\r\n        }\r\n        var cspan = '';\r\n        if (id==\"th_twa\" || id==\"th_sail\") {\r\n            cspan = \"colspan = 2\";\r\n        }\r\n        return '<th ' + cspan + ' id=\"' + id + '\"'\r\n            + (sortfield ? ' style=\"background: DarkBlue;\"' : \"\")\r\n            + (title ? (' title=\"' + title + '\"') : \"\")\r\n            + '>' + content + '</th>';\r\n    } else {\r\n        return \"\"\r\n    }\r\n}\r\nexport function gentd(name, style,title, value) {\r\n    const userPrefs = getUserPrefs();\r\n    const checked = userPrefs?.fleet?.column[name];\r\n    if (checked == undefined || checked ) {\r\n        if (name == \"fleet_sailicon\") {\r\n            var checkBoxSail = document.getElementById('fleet_sail');\r\n            if (!checkBoxSail.checked) return \"\";\r\n        }\r\n        else if (name == \"fleet_twaicon\") {\r\n            var checkBoxTWA = document.getElementById('fleet_twa');\r\n            if (!checkBoxTWA.checked) return \"\";\r\n        }\r\n        return '<td class=\"' + name + '\" ' \r\n                            + style \r\n                            + (title ? (' title=\"' + title + '\"') : \"\")\r\n                            + ' >' + value + '</td>';\r\n    }    else {\r\n        return \"\"\r\n    }\r\n\r\n}\r\nexport function getxFactorStyle(raceIte)\r\n{\r\n    const iteDash= raceIte.metaDash;\r\n    const userPrefs = getUserPrefs();\r\n    const darkTheme = userPrefs.theme==\"dark\";\r\n    let xfactorStyle= 'style=\"color:' + ((iteDash.xplained) ? (darkTheme?\"#a5A5A5\" :\"black\") : \"red\") + ';\"'\r\n    if(!raceIte.speed  )\r\n        xfactorStyle = 'style=\"color:' + darkTheme?\"#a5A5A5\" :\"black\" + ';\"';\r\n    \r\n    if(iteDash.sailCoverage != 0 && iteDash.xplained) {\r\n        if(iteDash.sailCoverage > 1.2 || (iteDash.sailCoverage<0 && Math.abs(iteDash.sailCoverage)<98))\r\n            xfactorStyle = 'style=\"color:red;\"';\r\n        else if(iteDash.sailCoverage > 0)\r\n            xfactorStyle = 'style=\"color:orange ;\"';\r\n    }\r\n    return xfactorStyle;\r\n}\r\n\r\n\r\nexport function dateUTCSmall() {\r\n    \r\n    const userPrefs = getUserPrefs();\r\n\r\n    const options = {\r\n        year: \"numeric\",\r\n        timeZoneName: \"short\"\r\n    };\r\n    \r\n    if (!userPrefs.global.localTime) {\r\n        options.timeZone = \"UTC\";\r\n    }\r\n    const str = new Intl.DateTimeFormat(\"lookup\", options).format(new Date());\r\n    const res = str.substring(5);\r\n    return '<span class=\"small\">&nbsp;(' + res + ')</span>';\r\n}\r\nexport function DateUTC(ts, format = 0) {\r\n    if (!ts) return;\r\n    // Format: MM/DD HH:MM:SS\r\n    let tsOptions = {\r\n            month: \"numeric\",\r\n            day: \"numeric\",\r\n            hour: \"numeric\",\r\n            minute: \"numeric\",\r\n            second: \"numeric\",\r\n            hour12: false\r\n    };\r\n    if (format == 1) {\r\n        // Format: MM/DD HH:MM\r\n        tsOptions = {\r\n            month: \"numeric\",\r\n            day: \"numeric\",\r\n            hour: \"numeric\",\r\n            minute: \"numeric\",\r\n            hour12: false\r\n        };\r\n    }\r\n    else if (format == 2) {\r\n        // Format: HH:MM:SS\r\n        tsOptions = {\r\n            hour: \"numeric\",\r\n            minute: \"numeric\",\r\n            second: \"numeric\",\r\n            hour12: false\r\n        };\r\n    }\r\n    const d = (ts) ? (new Date(ts)) : (new Date());\r\n    const dtUTCLocal = new Intl.DateTimeFormat(\"lookup\", tsOptions).format(d);\r\n    tsOptions.timeZone = \"UTC\";\r\n    const dtUTC = new Intl.DateTimeFormat(\"lookup\", tsOptions).format(d);\r\n    return '<span id=\"UTC\">' + dtUTC + '</span><span id=\"UTCLocal\">' + dtUTCLocal + '</span>';\r\n\r\n}\r\n\r\n\r\nexport function raceTableHeaders() {\r\n\r\n    return genthRacelog(\"th_rl_rank\", \"rank\", \"Rank\")\r\n        + genthRacelog(\"th_rl_dtl\", \"dtl\", \"DTL\", \"Distance To Leader\")\r\n        + genthRacelog(\"th_rl_dtf\", \"dtf\", \"DTF\", \"Distance To Finish\")\r\n        + genthRacelog(\"th_rl_twd\", \"twd\", \"TWD\", \"True Wind Direction\")\r\n        + genthRacelog(\"th_rl_tws\", \"tws\", \"TWS\", \"True Wind Speed\")\r\n        + genthRacelog(\"th_rl_twaLarge\", \"twa\", \"TWA\", \"True Wind Angle\")\r\n        + genthRacelog(\"th_rl_hdg\", \"hdg\", \"HDG\", \"Heading\");\r\n}\r\n\r\nexport function raceTableLines(ite,bestTwa,bestDTF) {\r\n    if(!ite)\r\n    {\r\n        return '<td class=\"rank\"></td>'\r\n        + '<td class=\"dtl\"></td>'\r\n        + '<td class=\"dtf\"></td>'\r\n        + '<td class=\"twd\"></td>'\r\n        + '<td class=\"tws\"></td>'\r\n        + '<td class=\"twa\" ></td>'\r\n        + '<td  class=\"hdg\" ></td>'\r\n    }\r\n    const userPrefs = getUserPrefs(); \r\n    let isTWAMode = ite.isRegulated;\r\n    let twaFG = (ite.twa < 0) ? \"red\" : \"green\";\r\n    let twaBold = isTWAMode ? \"font-weight: bold;\" : \"\";\r\n    let twaBG = \" \";\r\n    if(bestTwa)\r\n    {\r\n        twaBG = twaBackGround(ite.twa,bestTwa);\r\n    }\r\n    \r\n    var hdgFG = isTWAMode ? \"black\" : \"blue\";\r\n    var hdgBold = isTWAMode ? \"font-weight: normal;\" : \"font-weight: bold;\";\r\n    if(userPrefs.theme =='dark')\r\n        hdgFG = isTWAMode ? \"white\" : \"darkcyan\"; \r\n    \r\n    //TODO compute bestDTF saveit in raceList\r\n    return gentdRacelog(\"rank\", \"rank\", null, \"Rank\", (ite.rank ? ite.rank : \"-\"))\r\n        + gentdRacelog(\"dtl\", \"dtl\", null, \"DTL\", bestDTF?roundTo(ite.distanceToEnd - bestDTF, 3):'-')\r\n        + gentdRacelog(\"dtf\", \"dtf\", null, \"DTF\", roundTo(ite.distanceToEnd, 3))\r\n        + '<td class=\"twd\">' + roundTo(ite.twd, 3) + '</td>'\r\n        + '<td class=\"tws\">' + roundTo(ite.tws, 3) + '</td>'\r\n        + '<td class=\"twa\" style=\"color:' + twaFG + \";\" + twaBG + twaBold  + '\">' + roundTo(Math.abs(ite.twa), 3) + '</td>'\r\n        + '<td  class=\"hdg\" style=\"color:' + hdgFG + \";\" + hdgBold + '\">' + roundTo(ite.hdg, 3) + '</td>'\r\n}\r\nexport function infoSail(ite,short,extended = true) {\r\n    let sailInfo;\r\n    const userPrefs = getUserPrefs(); \r\n\r\n    if(short) {\r\n        sailInfo = sailNames[ite.sail % 10];\r\n    } else\r\n        sailInfo =  '<span ' + 'style=\"color:' + sailColors[ite.sail] + '\" padding: 0px 0px 0px 2px;\"' + '>&#x25e2&#x25e3  </span>'+ sailNames[ite.sail % 10];\r\n\r\n    if (ite.metaDash.isAutoSail) {\r\n        const autoSailTime = ite.metaDash.autoSailTime == 'inf' ? '‚àû' : formatHM(ite.metaDash.autoSailTime);\r\n        sailInfo = sailInfo + \" <span title='Auto Sails' class='cursorHelp'>&#x24B6;</span> \" + autoSailTime;\r\n    } else {\r\n        sailInfo = sailInfo + \" (Man)\";\r\n    }\r\n    \r\n    const sailNameBG = (userPrefs.theme =='dark')?(ite.badSail ? \"darkred\" : \"darkgreen\"):(ite.badSail ? \"lightred\" : \"lightgreen\");\r\n\r\n    if(ite.metaDash.deltaReceiveCompute > 900000)   sailNameBG = 'red' ;\r\n\r\n    let retVal = '<td class=\"asail\" style=\"background-color:' + sailNameBG + ';\">';\r\n    if(extended) {\r\n        const best = ite.metaDash.bVmg;\r\n        if(best.sailTWSMax != 0)\r\n        {\r\n            retVal +='<div class=\"\">'+ best.sailTWSMin +' - '+ best.sailTWSMax+' kts</div>';\r\n        }\r\n        retVal += '<div>'+sailInfo+'</div>';\r\n        if(best.sailTWAMax != 0)\r\n        {\r\n            retVal +='<div class=\"\">'+ best.sailTWAMin +' - '+ best.sailTWAMax+'¬∞</div>';\r\n        }\r\n    } else\r\n    {\r\n        retVal += sailInfo;\r\n    }\r\n    retVal +=\"</td>\";\r\n    return   retVal; \r\n\r\n}\r\n\r\nfunction toDMS(number) {\r\n    const u = sign(number);\r\n    number = Math.abs(number);\r\n    const g = Math.floor(number);\r\n    let frac = number - g;\r\n    const m = Math.floor(frac * 60);\r\n    frac = frac - m / 60;\r\n    let s = Math.floor(frac * 3600);\r\n    let cs = roundTo(360000 * (frac - s / 3600), 0);\r\n    while (cs >= 100) {\r\n        cs = cs - 100;\r\n        s = s + 1;\r\n    }\r\n    return {\r\n        \"u\": u,\r\n        \"g\": g,\r\n        \"m\": m,\r\n        \"s\": s,\r\n        \"cs\": cs\r\n    };\r\n}\r\n    \r\n\r\nexport function formatPosition(lat, lon,long=false) {\r\n    const latDMS = toDMS(lat);\r\n    const lonDMS = toDMS(lon);\r\n    const latString = latDMS.g + \"¬∞\" + pad0(latDMS.m) + \"'\" + pad0(latDMS.s) + \".\" + pad0(latDMS.cs, 2) + '\"';\r\n    const lonString = lonDMS.g + \"¬∞\" + pad0(lonDMS.m) + \"'\" + pad0(lonDMS.s) + \".\" + pad0(lonDMS.cs, 2) + '\"';\r\n    const userPrefs = getUserPrefs();\r\n\r\n    const separator = userPrefs.global.separatorPos?\" \":\" - \";\r\n    \r\n    let retVal = long?\"<p>\":\"\";\r\n    retVal += latString + ((latDMS.u == 1) ? \"N\" : \"S\");\r\n    retVal +=  long?\"</p><p>\":separator;\r\n    retVal += lonString + ((lonDMS.u == 1) ? \"E\" : \"W\");\r\n    retVal += long?\"<p>\":\"\";\r\n    return  retVal;\r\n\r\n}\r\n\r\n\r\n\r\nexport function formatSeconds(value) {\r\n    if (value < 0) {\r\n        return \"-\";\r\n    } else {\r\n        return roundTo(value / 1000, 0);\r\n    }\r\n}\r\n\r\n\r\nexport function changeState(lbl_tochange) {\r\n    const cbxlbl = lbl_tochange.replace(\"lbl_\", \"sel_\");\r\n    const selectedcbx = document.getElementById(cbxlbl);\r\n    if(selectedcbx) {\r\n        if (selectedcbx.checked) {\r\n            selectedcbx.checked = false;\r\n        } else {\r\n            selectedcbx.checked = true;\r\n        }\r\n    }\r\n    const name = lbl_tochange.replace(\"lbl_\", \"\");\r\n    const userPrefs = getUserPrefs();\r\n    const checked = userPrefs?.filters[name];\r\n    if (checked != undefined) {\r\n        userPrefs.filters[name] = selectedcbx.checked ;\r\n    }\r\n    saveUserPrefs(userPrefs);\r\n\r\n}\r\n\r\nexport function display_selbox(state) {\r\n    document.getElementById(\"sel_skippers\").style.visibility = state;\r\n    document.getElementById(\"sel_export\").style.visibility = state;\r\n}\r\n"],"names":["target","meta","angle","userPrefs","raceIte","darkTheme"],"mappings":"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","x_google_ignoreList":[0,1]}